var Ua=Object.defineProperty;var Ha=(t,e,s)=>e in t?Ua(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var St=(t,e,s)=>Ha(t,typeof e!="symbol"?e+"":e,s);import{j as o,S as ds,O as vr,C as wr,a as _r,T as jr,D as Sr,P as Xn,R as Qn,b as Zn,u as ue,c as bs,d as eo,e as X,f as Y,g as Nr,h as vs,i as ws,k as sr,l as to,W as za,m as qa,n as Va,o as Ga,p as Wa,F as Ja,q as Ka,r as Ya}from"./ui-_X73GvqJ.js";import{a as so,r as g,g as Xa,c as re,d as xe}from"./vendor-BpbxbJep.js";import{u as gt,a as ro,L as ns,b as Qa,B as Za,R as el,c as qe}from"./router-DfhNaIFb.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var no,dn=so;no=dn.createRoot,dn.hydrateRoot;/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),oo=(...t)=>t.filter((e,s,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===s).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sl={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=g.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:n="",children:i,iconNode:a,...l},c)=>g.createElement("svg",{ref:c,...sl,width:e,height:e,stroke:t,strokeWidth:r?Number(s)*24/Number(e):s,className:oo("lucide",n),...l},[...a.map(([d,u])=>g.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=(t,e)=>{const s=g.forwardRef(({className:r,...n},i)=>g.createElement(rl,{ref:i,iconNode:e,className:oo(`lucide-${tl(t)}`,r),...n}));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=H("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=H("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=H("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=H("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ll=H("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=H("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=H("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=H("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=H("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=H("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=H("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=H("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=H("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=H("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=H("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=H("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=H("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=H("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=H("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=H("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=H("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=H("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=H("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=H("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=H("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=H("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=H("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function uo(t){var e,s,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(s=uo(t[e]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s);return r}function ho(){for(var t,e,s=0,r="",n=arguments.length;s<n;s++)(t=arguments[s])&&(e=uo(t))&&(r&&(r+=" "),r+=e);return r}const fn=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,mn=ho,js=(t,e)=>s=>{var r;if((e==null?void 0:e.variants)==null)return mn(t,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:n,defaultVariants:i}=e,a=Object.keys(n).map(d=>{const u=s==null?void 0:s[d],f=i==null?void 0:i[d];if(u===null)return null;const m=fn(u)||fn(f);return n[d][m]}),l=s&&Object.entries(s).reduce((d,u)=>{let[f,m]=u;return m===void 0||(d[f]=m),d},{}),c=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((d,u)=>{let{class:f,className:m,...h}=u;return Object.entries(h).every(p=>{let[y,x]=p;return Array.isArray(x)?x.includes({...i,...l}[y]):{...i,...l}[y]===x})?[...d,f,m]:d},[]);return mn(t,a,c,s==null?void 0:s.class,s==null?void 0:s.className)},Pr="-",yl=t=>{const e=bl(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:a=>{const l=a.split(Pr);return l[0]===""&&l.length!==1&&l.shift(),fo(l,e)||xl(a)},getConflictingClassGroupIds:(a,l)=>{const c=s[a]||[];return l&&r[a]?[...c,...r[a]]:c}}},fo=(t,e)=>{var a;if(t.length===0)return e.classGroupId;const s=t[0],r=e.nextPart.get(s),n=r?fo(t.slice(1),r):void 0;if(n)return n;if(e.validators.length===0)return;const i=t.join(Pr);return(a=e.validators.find(({validator:l})=>l(i)))==null?void 0:a.classGroupId},pn=/^\[(.+)\]$/,xl=t=>{if(pn.test(t)){const e=pn.exec(t)[1],s=e==null?void 0:e.substring(0,e.indexOf(":"));if(s)return"arbitrary.."+s}},bl=t=>{const{theme:e,prefix:s}=t,r={nextPart:new Map,validators:[]};return wl(Object.entries(t.classGroups),s).forEach(([i,a])=>{rr(a,r,i,e)}),r},rr=(t,e,s,r)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?e:gn(e,n);i.classGroupId=s;return}if(typeof n=="function"){if(vl(n)){rr(n(r),e,s,r);return}e.validators.push({validator:n,classGroupId:s});return}Object.entries(n).forEach(([i,a])=>{rr(a,gn(e,i),s,r)})})},gn=(t,e)=>{let s=t;return e.split(Pr).forEach(r=>{s.nextPart.has(r)||s.nextPart.set(r,{nextPart:new Map,validators:[]}),s=s.nextPart.get(r)}),s},vl=t=>t.isThemeGetter,wl=(t,e)=>e?t.map(([s,r])=>{const n=r.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([a,l])=>[e+a,l])):i);return[s,n]}):t,_l=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,s=new Map,r=new Map;const n=(i,a)=>{s.set(i,a),e++,e>t&&(e=0,r=s,s=new Map)};return{get(i){let a=s.get(i);if(a!==void 0)return a;if((a=r.get(i))!==void 0)return n(i,a),a},set(i,a){s.has(i)?s.set(i,a):n(i,a)}}},mo="!",jl=t=>{const{separator:e,experimentalParseClassName:s}=t,r=e.length===1,n=e[0],i=e.length,a=l=>{const c=[];let d=0,u=0,f;for(let x=0;x<l.length;x++){let b=l[x];if(d===0){if(b===n&&(r||l.slice(x,x+i)===e)){c.push(l.slice(u,x)),u=x+i;continue}if(b==="/"){f=x;continue}}b==="["?d++:b==="]"&&d--}const m=c.length===0?l:l.substring(u),h=m.startsWith(mo),p=h?m.substring(1):m,y=f&&f>u?f-u:void 0;return{modifiers:c,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:y}};return s?l=>s({className:l,parseClassName:a}):a},Sl=t=>{if(t.length<=1)return t;const e=[];let s=[];return t.forEach(r=>{r[0]==="["?(e.push(...s.sort(),r),s=[]):s.push(r)}),e.push(...s.sort()),e},Nl=t=>({cache:_l(t.cacheSize),parseClassName:jl(t),...yl(t)}),Cl=/\s+/,kl=(t,e)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:n}=e,i=[],a=t.trim().split(Cl);let l="";for(let c=a.length-1;c>=0;c-=1){const d=a[c],{modifiers:u,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:h}=s(d);let p=!!h,y=r(p?m.substring(0,h):m);if(!y){if(!p){l=d+(l.length>0?" "+l:l);continue}if(y=r(m),!y){l=d+(l.length>0?" "+l:l);continue}p=!1}const x=Sl(u).join(":"),b=f?x+mo:x,v=b+y;if(i.includes(v))continue;i.push(v);const w=n(y,p);for(let _=0;_<w.length;++_){const j=w[_];i.push(b+j)}l=d+(l.length>0?" "+l:l)}return l};function Al(){let t=0,e,s,r="";for(;t<arguments.length;)(e=arguments[t++])&&(s=po(e))&&(r&&(r+=" "),r+=s);return r}const po=t=>{if(typeof t=="string")return t;let e,s="";for(let r=0;r<t.length;r++)t[r]&&(e=po(t[r]))&&(s&&(s+=" "),s+=e);return s};function Pl(t,...e){let s,r,n,i=a;function a(c){const d=e.reduce((u,f)=>f(u),t());return s=Nl(d),r=s.cache.get,n=s.cache.set,i=l,l(c)}function l(c){const d=r(c);if(d)return d;const u=kl(c,s);return n(c,u),u}return function(){return i(Al.apply(null,arguments))}}const V=t=>{const e=s=>s[t]||[];return e.isThemeGetter=!0,e},go=/^\[(?:([a-z-]+):)?(.+)\]$/i,El=/^\d+\/\d+$/,Ol=new Set(["px","full","screen"]),Tl=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Rl=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Il=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,$l=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Fl=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ye=t=>ot(t)||Ol.has(t)||El.test(t),ke=t=>yt(t,"length",ql),ot=t=>!!t&&!Number.isNaN(Number(t)),zs=t=>yt(t,"number",ot),Nt=t=>!!t&&Number.isInteger(Number(t)),Ml=t=>t.endsWith("%")&&ot(t.slice(0,-1)),R=t=>go.test(t),Ae=t=>Tl.test(t),Dl=new Set(["length","size","percentage"]),Ll=t=>yt(t,Dl,yo),Bl=t=>yt(t,"position",yo),Ul=new Set(["image","url"]),Hl=t=>yt(t,Ul,Gl),zl=t=>yt(t,"",Vl),Ct=()=>!0,yt=(t,e,s)=>{const r=go.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):s(r[2]):!1},ql=t=>Rl.test(t)&&!Il.test(t),yo=()=>!1,Vl=t=>$l.test(t),Gl=t=>Fl.test(t),Wl=()=>{const t=V("colors"),e=V("spacing"),s=V("blur"),r=V("brightness"),n=V("borderColor"),i=V("borderRadius"),a=V("borderSpacing"),l=V("borderWidth"),c=V("contrast"),d=V("grayscale"),u=V("hueRotate"),f=V("invert"),m=V("gap"),h=V("gradientColorStops"),p=V("gradientColorStopPositions"),y=V("inset"),x=V("margin"),b=V("opacity"),v=V("padding"),w=V("saturate"),_=V("scale"),j=V("sepia"),S=V("skew"),C=V("space"),k=V("translate"),N=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],O=()=>["auto",R,e],A=()=>[R,e],z=()=>["",ye,ke],B=()=>["auto",ot,R],W=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],F=()=>["solid","dashed","dotted","double","none"],T=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],P=()=>["start","end","center","between","around","evenly","stretch"],U=()=>["","0",R],K=()=>["auto","avoid","all","avoid-page","page","left","right","column"],G=()=>[ot,R];return{cacheSize:500,separator:":",theme:{colors:[Ct],spacing:[ye,ke],blur:["none","",Ae,R],brightness:G(),borderColor:[t],borderRadius:["none","","full",Ae,R],borderSpacing:A(),borderWidth:z(),contrast:G(),grayscale:U(),hueRotate:G(),invert:U(),gap:A(),gradientColorStops:[t],gradientColorStopPositions:[Ml,ke],inset:O(),margin:O(),opacity:G(),padding:A(),saturate:G(),scale:G(),sepia:U(),skew:G(),space:A(),translate:A()},classGroups:{aspect:[{aspect:["auto","square","video",R]}],container:["container"],columns:[{columns:[Ae]}],"break-after":[{"break-after":K()}],"break-before":[{"break-before":K()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...W(),R]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:N()}],"overscroll-x":[{"overscroll-x":N()}],"overscroll-y":[{"overscroll-y":N()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Nt,R]}],basis:[{basis:O()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",R]}],grow:[{grow:U()}],shrink:[{shrink:U()}],order:[{order:["first","last","none",Nt,R]}],"grid-cols":[{"grid-cols":[Ct]}],"col-start-end":[{col:["auto",{span:["full",Nt,R]},R]}],"col-start":[{"col-start":B()}],"col-end":[{"col-end":B()}],"grid-rows":[{"grid-rows":[Ct]}],"row-start-end":[{row:["auto",{span:[Nt,R]},R]}],"row-start":[{"row-start":B()}],"row-end":[{"row-end":B()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",R]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",R]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal",...P()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...P(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...P(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",R,e]}],"min-w":[{"min-w":[R,e,"min","max","fit"]}],"max-w":[{"max-w":[R,e,"none","full","min","max","fit","prose",{screen:[Ae]},Ae]}],h:[{h:[R,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[R,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[R,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[R,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ae,ke]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",zs]}],"font-family":[{font:[Ct]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",R]}],"line-clamp":[{"line-clamp":["none",ot,zs]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ye,R]}],"list-image":[{"list-image":["none",R]}],"list-style-type":[{list:["none","disc","decimal",R]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...F(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ye,ke]}],"underline-offset":[{"underline-offset":["auto",ye,R]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",R]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",R]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...W(),Bl]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Ll]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Hl]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...F(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:F()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...F()]}],"outline-offset":[{"outline-offset":[ye,R]}],"outline-w":[{outline:[ye,ke]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:z()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[ye,ke]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ae,zl]}],"shadow-color":[{shadow:[Ct]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...T(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":T()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ae,R]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[f]}],saturate:[{saturate:[w]}],sepia:[{sepia:[j]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[j]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",R]}],duration:[{duration:G()}],ease:[{ease:["linear","in","out","in-out",R]}],delay:[{delay:G()}],animate:[{animate:["none","spin","ping","pulse","bounce",R]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_]}],"scale-x":[{"scale-x":[_]}],"scale-y":[{"scale-y":[_]}],rotate:[{rotate:[Nt,R]}],"translate-x":[{"translate-x":[k]}],"translate-y":[{"translate-y":[k]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",R]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",R]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",R]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[ye,ke,zs]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Jl=Pl(Wl);function L(...t){return Jl(ho(t))}const Er=js("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),D=g.forwardRef(({className:t,variant:e,size:s,asChild:r=!1,...n},i)=>{const a=r?ds:"button";return o.jsx(a,{className:L(Er({variant:e,size:s,className:t})),ref:i,...n})});D.displayName="Button";const ve=g.forwardRef(({className:t,...e},s)=>o.jsx("div",{ref:s,className:L("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));ve.displayName="Card";const we=g.forwardRef(({className:t,...e},s)=>o.jsx("div",{ref:s,className:L("flex flex-col space-y-1.5 p-6",t),...e}));we.displayName="CardHeader";const _e=g.forwardRef(({className:t,...e},s)=>o.jsx("h3",{ref:s,className:L("text-2xl font-semibold leading-none tracking-tight",t),...e}));_e.displayName="CardTitle";const us=g.forwardRef(({className:t,...e},s)=>o.jsx("p",{ref:s,className:L("text-sm text-muted-foreground",t),...e}));us.displayName="CardDescription";const je=g.forwardRef(({className:t,...e},s)=>o.jsx("div",{ref:s,className:L("p-6 pt-0",t),...e}));je.displayName="CardContent";const Kl=g.forwardRef(({className:t,...e},s)=>o.jsx("div",{ref:s,className:L("flex items-center p-6 pt-0",t),...e}));Kl.displayName="CardFooter";const hs=async()=>{try{const t=new AbortController,e=setTimeout(()=>t.abort(),3e3),s=await fetch("https://jofuqlexuxzamltxxzuq.supabase.co/rest/v1/",{method:"HEAD",signal:t.signal,cache:"no-cache",headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvZnVxbGV4dXh6YW1sdHh4enVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxMDA2NjAsImV4cCI6MjA2NDY3NjY2MH0.Fq_Sx7NUeZF2k-erwrj_V-2npReXum9Cmuufsco3Cmw"}});return clearTimeout(e),s.ok}catch(t){return console.error("Connectivity check failed:",t),!1}};function Yl(){window.addEventListener("online",()=>console.log("🔌 Online")),window.addEventListener("offline",()=>console.log("❌ Offline"))}const xo=()=>{const[t,e]=g.useState(navigator.onLine);return g.useEffect(()=>{const s=async()=>{console.log("Browser came online, checking server connectivity...");const n=await hs();e(n)},r=()=>{console.log("Browser went offline"),e(!1)};return hs().then(e),window.addEventListener("online",s),window.addEventListener("offline",r),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}},[]),{isOnline:t}},Xl="modulepreload",Ql=function(t){return"/mia-consent-offline-form/"+t},yn={},Lt=function(e,s,r){let n=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(s.map(c=>{if(c=Ql(c),c in yn)return;yn[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":Xl,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((m,h)=>{f.addEventListener("load",m),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return n.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},Zl=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>Lt(async()=>{const{default:r}=await Promise.resolve().then(()=>xt);return{default:r}},void 0).then(({default:r})=>r(...s)):e=fetch,(...s)=>e(...s)};class Or extends Error{constructor(e,s="FunctionsError",r){super(e),this.name=s,this.context=r}}class ec extends Or{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class tc extends Or{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class sc extends Or{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var nr;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(nr||(nr={}));var rc=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};class nc{constructor(e,{headers:s={},customFetch:r,region:n=nr.Any}={}){this.url=e,this.headers=s,this.region=n,this.fetch=Zl(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,s={}){var r;return rc(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=s;let l={},{region:c}=s;c||(c=this.region),c&&c!=="any"&&(l["x-region"]=c);let d;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=a):typeof a=="string"?(l["Content-Type"]="text/plain",d=a):typeof FormData<"u"&&a instanceof FormData?d=a:(l["Content-Type"]="application/json",d=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:d}).catch(p=>{throw new ec(p)}),f=u.headers.get("x-relay-error");if(f&&f==="true")throw new tc(u);if(!u.ok)throw new sc(u);let m=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),h;return m==="application/json"?h=yield u.json():m==="application/octet-stream"?h=yield u.blob():m==="text/event-stream"?h=u:m==="multipart/form-data"?h=yield u.formData():h=yield u.text(),{data:h,error:null}}catch(n){return{data:null,error:n}}})}}var ee={},Tr={},Ss={},Bt={},Ns={},Cs={},oc=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ct=oc();const ic=ct.fetch,bo=ct.fetch.bind(ct),vo=ct.Headers,ac=ct.Request,lc=ct.Response,xt=Object.freeze(Object.defineProperty({__proto__:null,Headers:vo,Request:ac,Response:lc,default:bo,fetch:ic},Symbol.toStringTag,{value:"Module"})),cc=Xa(xt);var ks={};Object.defineProperty(ks,"__esModule",{value:!0});let dc=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ks.default=dc;var wo=re&&re.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Cs,"__esModule",{value:!0});const uc=wo(cc),hc=wo(ks);let fc=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=uc.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,s){return this.headers=Object.assign({},this.headers),this.headers[e]=s,this}then(e,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,l,c;let d=null,u=null,f=null,m=i.status,h=i.statusText;if(i.ok){if(this.method!=="HEAD"){const b=await i.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=b:u=JSON.parse(b))}const y=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),x=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");y&&x&&x.length>1&&(f=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,f=null,m=406,h="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const y=await i.text();try{d=JSON.parse(y),Array.isArray(d)&&i.status===404&&(u=[],d=null,m=200,h="OK")}catch{i.status===404&&y===""?(m=204,h="No Content"):d={message:y}}if(d&&this.isMaybeSingle&&(!((c=d==null?void 0:d.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,m=200,h="OK"),d&&this.shouldThrowOnError)throw new hc.default(d)}return{error:d,data:u,count:f,status:m,statusText:h}});return this.shouldThrowOnError||(n=n.catch(i=>{var a,l,c;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,s)}returns(){return this}overrideTypes(){return this}};Cs.default=fc;var mc=re&&re.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ns,"__esModule",{value:!0});const pc=mc(Cs);let gc=class extends pc.default{select(e){let s=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!s?"":(n==='"'&&(s=!s),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:s=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const a=i?`${i}.order`:"order",l=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${l?`${l},`:""}${e}.${s?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:s,referencedTable:r=s}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,s,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${s-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:s=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:a="text"}={}){var l;const c=[e?"analyze":null,s?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${d}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ns.default=gc;var yc=re&&re.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Bt,"__esModule",{value:!0});const xc=yc(Ns);let bc=class extends xc.default{eq(e,s){return this.url.searchParams.append(e,`eq.${s}`),this}neq(e,s){return this.url.searchParams.append(e,`neq.${s}`),this}gt(e,s){return this.url.searchParams.append(e,`gt.${s}`),this}gte(e,s){return this.url.searchParams.append(e,`gte.${s}`),this}lt(e,s){return this.url.searchParams.append(e,`lt.${s}`),this}lte(e,s){return this.url.searchParams.append(e,`lte.${s}`),this}like(e,s){return this.url.searchParams.append(e,`like.${s}`),this}likeAllOf(e,s){return this.url.searchParams.append(e,`like(all).{${s.join(",")}}`),this}likeAnyOf(e,s){return this.url.searchParams.append(e,`like(any).{${s.join(",")}}`),this}ilike(e,s){return this.url.searchParams.append(e,`ilike.${s}`),this}ilikeAllOf(e,s){return this.url.searchParams.append(e,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(e,s){return this.url.searchParams.append(e,`ilike(any).{${s.join(",")}}`),this}is(e,s){return this.url.searchParams.append(e,`is.${s}`),this}in(e,s){const r=Array.from(new Set(s)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cs.{${s.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(s)}`),this}containedBy(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cd.{${s.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(s)}`),this}rangeGt(e,s){return this.url.searchParams.append(e,`sr.${s}`),this}rangeGte(e,s){return this.url.searchParams.append(e,`nxl.${s}`),this}rangeLt(e,s){return this.url.searchParams.append(e,`sl.${s}`),this}rangeLte(e,s){return this.url.searchParams.append(e,`nxr.${s}`),this}rangeAdjacent(e,s){return this.url.searchParams.append(e,`adj.${s}`),this}overlaps(e,s){return typeof s=="string"?this.url.searchParams.append(e,`ov.${s}`):this.url.searchParams.append(e,`ov.{${s.join(",")}}`),this}textSearch(e,s,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${s}`),this}match(e){return Object.entries(e).forEach(([s,r])=>{this.url.searchParams.append(s,`eq.${r}`)}),this}not(e,s,r){return this.url.searchParams.append(e,`not.${s}.${r}`),this}or(e,{foreignTable:s,referencedTable:r=s}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,s,r){return this.url.searchParams.append(e,`${s}.${r}`),this}};Bt.default=bc;var vc=re&&re.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ss,"__esModule",{value:!0});const kt=vc(Bt);let wc=class{constructor(e,{headers:s={},schema:r,fetch:n}){this.url=e,this.headers=s,this.schema=r,this.fetch=n}select(e,{head:s=!1,count:r}={}){const n=s?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new kt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:s,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new kt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:s,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const a="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const c=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new kt.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:s}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),this.headers.Prefer=n.join(","),new kt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const s="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new kt.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Ss.default=wc;var As={},Ps={};Object.defineProperty(Ps,"__esModule",{value:!0});Ps.version=void 0;Ps.version="0.0.0-automated";Object.defineProperty(As,"__esModule",{value:!0});As.DEFAULT_HEADERS=void 0;const _c=Ps;As.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${_c.version}`};var _o=re&&re.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Tr,"__esModule",{value:!0});const jc=_o(Ss),Sc=_o(Bt),Nc=As;let Cc=class jo{constructor(e,{headers:s={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Nc.DEFAULT_HEADERS),s),this.schemaName=r,this.fetch=n}from(e){const s=new URL(`${this.url}/${e}`);return new jc.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new jo(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,s={},{head:r=!1,get:n=!1,count:i}={}){let a;const l=new URL(`${this.url}/rpc/${e}`);let c;r||n?(a=r?"HEAD":"GET",Object.entries(s).filter(([u,f])=>f!==void 0).map(([u,f])=>[u,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([u,f])=>{l.searchParams.append(u,f)})):(a="POST",c=s);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new Sc.default({method:a,url:l,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};Tr.default=Cc;var bt=re&&re.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ee,"__esModule",{value:!0});ee.PostgrestError=ee.PostgrestBuilder=ee.PostgrestTransformBuilder=ee.PostgrestFilterBuilder=ee.PostgrestQueryBuilder=ee.PostgrestClient=void 0;const So=bt(Tr);ee.PostgrestClient=So.default;const No=bt(Ss);ee.PostgrestQueryBuilder=No.default;const Co=bt(Bt);ee.PostgrestFilterBuilder=Co.default;const ko=bt(Ns);ee.PostgrestTransformBuilder=ko.default;const Ao=bt(Cs);ee.PostgrestBuilder=Ao.default;const Po=bt(ks);ee.PostgrestError=Po.default;var kc=ee.default={PostgrestClient:So.default,PostgrestQueryBuilder:No.default,PostgrestFilterBuilder:Co.default,PostgrestTransformBuilder:ko.default,PostgrestBuilder:Ao.default,PostgrestError:Po.default};const{PostgrestClient:Ac,PostgrestQueryBuilder:Fp,PostgrestFilterBuilder:Mp,PostgrestTransformBuilder:Dp,PostgrestBuilder:Lp,PostgrestError:Bp}=kc;let or;typeof window>"u"?or=require("ws"):or=window.WebSocket;const Pc=or,Ec="2.11.10",Oc={"X-Client-Info":`realtime-js/${Ec}`},Tc="1.0.0",Eo=1e4,Rc=1e3;var it;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(it||(it={}));var Q;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Q||(Q={}));var oe;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(oe||(oe={}));var ir;(function(t){t.websocket="websocket"})(ir||(ir={}));var We;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(We||(We={}));class Ic{constructor(){this.HEADER_LENGTH=1}decode(e,s){return e.constructor===ArrayBuffer?s(this._binaryDecode(e)):s(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const s=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,s,r)}_decodeBroadcast(e,s,r){const n=s.getUint8(1),i=s.getUint8(2);let a=this.HEADER_LENGTH+2;const l=r.decode(e.slice(a,a+n));a=a+n;const c=r.decode(e.slice(a,a+i));a=a+i;const d=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class Oo{constructor(e,s){this.callback=e,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var q;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(q||(q={}));const xn=(t,e,s={})=>{var r;const n=(r=s.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=$c(a,t,e,n),i),{})},$c=(t,e,s,r)=>{const n=e.find(l=>l.name===t),i=n==null?void 0:n.type,a=s[t];return i&&!r.includes(i)?To(i,a):ar(a)},To=(t,e)=>{if(t.charAt(0)==="_"){const s=t.slice(1,t.length);return Lc(e,s)}switch(t){case q.bool:return Fc(e);case q.float4:case q.float8:case q.int2:case q.int4:case q.int8:case q.numeric:case q.oid:return Mc(e);case q.json:case q.jsonb:return Dc(e);case q.timestamp:return Bc(e);case q.abstime:case q.date:case q.daterange:case q.int4range:case q.int8range:case q.money:case q.reltime:case q.text:case q.time:case q.timestamptz:case q.timetz:case q.tsrange:case q.tstzrange:return ar(e);default:return ar(e)}},ar=t=>t,Fc=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Mc=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Dc=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},Lc=(t,e)=>{if(typeof t!="string")return t;const s=t.length-1,r=t[s];if(t[0]==="{"&&r==="}"){let i;const a=t.slice(1,s);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(l=>To(e,l))}return t},Bc=t=>typeof t=="string"?t.replace(" ","T"):t,Ro=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class qs{constructor(e,s,r={},n=Eo){this.channel=e,this.event=s,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,s){var r;return this._hasReceived(e)&&s((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:s}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(s))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var bn;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(bn||(bn={}));class Et{constructor(e,s){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Et.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=Et.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Et.syncDiff(this.state,n,i,a),l())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,s,r,n){const i=this.cloneDeep(e),a=this.transformState(s),l={},c={};return this.map(i,(d,u)=>{a[d]||(c[d]=u)}),this.map(a,(d,u)=>{const f=i[d];if(f){const m=u.map(x=>x.presence_ref),h=f.map(x=>x.presence_ref),p=u.filter(x=>h.indexOf(x.presence_ref)<0),y=f.filter(x=>m.indexOf(x.presence_ref)<0);p.length>0&&(l[d]=p),y.length>0&&(c[d]=y)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},r,n)}static syncDiff(e,s,r,n){const{joins:i,leaves:a}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),u.length>0){const f=e[l].map(h=>h.presence_ref),m=u.filter(h=>f.indexOf(h.presence_ref)<0);e[l].unshift(...m)}r(l,u,c)}),this.map(a,(l,c)=>{let d=e[l];if(!d)return;const u=c.map(f=>f.presence_ref);d=d.filter(f=>u.indexOf(f.presence_ref)<0),e[l]=d,n(l,d,c),d.length===0&&delete e[l]}),e}static map(e,s){return Object.getOwnPropertyNames(e).map(r=>s(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((s,r)=>{const n=e[r];return"metas"in n?s[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[r]=n,s},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var vn;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(vn||(vn={}));var wn;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(wn||(wn={}));var be;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(be||(be={}));class Rr{constructor(e,s={config:{}},r){this.topic=e,this.params=s,this.socket=r,this.bindings={},this.state=Q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new qs(this,oe.join,this.params,this.timeout),this.rejoinTimer=new Oo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Q.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(oe.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Et(this),this.broadcastEndpointURL=Ro(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,s=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:l}}=this.params;this._onError(u=>e==null?void 0:e(be.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(be.CLOSED));const c={},d={broadcast:i,presence:a,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&n!==void 0?n:[],private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:u})=>{var f;if(this.socket.setAuth(),u===void 0){e==null||e(be.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,h=(f=m==null?void 0:m.length)!==null&&f!==void 0?f:0,p=[];for(let y=0;y<h;y++){const x=m[y],{filter:{event:b,schema:v,table:w,filter:_}}=x,j=u&&u[y];if(j&&j.event===b&&j.schema===v&&j.table===w&&j.filter===_)p.push(Object.assign(Object.assign({},x),{id:j.id}));else{this.unsubscribe(),this.state=Q.errored,e==null||e(be.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(be.SUBSCRIBED);return}}).receive("error",u=>{this.state=Q.errored,e==null||e(be.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(be.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,s={}){return await this.send({type:"presence",event:"track",payload:e},s.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,s,r){return this._on(e,s,r)}async send(e,s={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,l,c;const d=this._push(e.type,e,s.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Q.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(oe.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise(r=>{const n=new qs(this,oe.leave,{},e);n.receive("ok",()=>{s(),r("ok")}).receive("timeout",()=>{s(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,s,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},s),{signal:n.signal}));return clearTimeout(i),a}_push(e,s,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new qs(this,e,s,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,s,r){return s}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,s,r){var n,i;const a=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=oe;if(r&&[l,c,d,u].indexOf(a)>=0&&r!==this._joinRef())return;let m=this._onMessage(a,s,r);if(s&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(h=>{var p,y,x;return((p=h.filter)===null||p===void 0?void 0:p.event)==="*"||((x=(y=h.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===a}).map(h=>h.callback(m,r)):(i=this.bindings[a])===null||i===void 0||i.filter(h=>{var p,y,x,b,v,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in h){const _=h.id,j=(p=h.filter)===null||p===void 0?void 0:p.event;return _&&((y=s.ids)===null||y===void 0?void 0:y.includes(_))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((x=s.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const _=(v=(b=h==null?void 0:h.filter)===null||b===void 0?void 0:b.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return _==="*"||_===((w=s==null?void 0:s.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===a}).map(h=>{if(typeof m=="object"&&"ids"in m){const p=m.data,{schema:y,table:x,commit_timestamp:b,type:v,errors:w}=p;m=Object.assign(Object.assign({},{schema:y,table:x,commit_timestamp:b,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(p))}h.callback(m,r)})}_isClosed(){return this.state===Q.closed}_isJoined(){return this.state===Q.joined}_isJoining(){return this.state===Q.joining}_isLeaving(){return this.state===Q.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,s,r){const n=e.toLocaleLowerCase(),i={type:n,filter:s,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,s){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Rr.isEqual(n.filter,s))}),this}static isEqual(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const r in e)if(e[r]!==s[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(oe.close,{},e)}_onError(e){this._on(oe.error,{},s=>e(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Q.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const s={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(s.new=xn(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(s.old=xn(e.columns,e.old_record)),s}}const _n=()=>{},Uc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Hc{constructor(e,s){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=Oc,this.params={},this.timeout=Eo,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=_n,this.ref=0,this.logger=_n,this.conn=null,this.sendBuffer=[],this.serializer=new Ic,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...l)=>Lt(async()=>{const{default:c}=await Promise.resolve().then(()=>xt);return{default:c}},void 0).then(({default:c})=>c(...l)):a=fetch,(...l)=>a(...l)},this.endPoint=`${e}/${ir.websocket}`,this.httpEndpoint=Ro(e),s!=null&&s.transport?this.transport=s.transport:this.transport=null,s!=null&&s.params&&(this.params=s.params),s!=null&&s.headers&&(this.headers=Object.assign(Object.assign({},this.headers),s.headers)),s!=null&&s.timeout&&(this.timeout=s.timeout),s!=null&&s.logger&&(this.logger=s.logger),(s!=null&&s.logLevel||s!=null&&s.log_level)&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),s!=null&&s.heartbeatIntervalMs&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const n=(r=s==null?void 0:s.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=s!=null&&s.reconnectAfterMs?s.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=s!=null&&s.encode?s.encode:(i,a)=>a(JSON.stringify(i)),this.decode=s!=null&&s.decode?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Oo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(s==null?void 0:s.fetch),s!=null&&s.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(s==null?void 0:s.worker)||!1,this.workerUrl=s==null?void 0:s.workerUrl}this.accessToken=(s==null?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Pc),this.transport){typeof window<"u"&&this.transport===window.WebSocket?this.conn=new this.transport(this.endpointURL()):this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection();return}this.conn=new zc(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Tc}))}disconnect(e,s){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,s??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const s=await e.unsubscribe();return this.channels=this.channels.filter(r=>r._joinRef!==e._joinRef),this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const e=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,s,r){this.logger(e,s,r)}connectionState(){switch(this.conn&&this.conn.readyState){case it.connecting:return We.Connecting;case it.open:return We.Open;case it.closing:return We.Closing;default:return We.Closed}}isConnected(){return this.connectionState()===We.Open}channel(e,s={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new Rr(`realtime:${e}`,s,this);return this.channels.push(i),i}}push(e){const{topic:s,event:r,payload:n,ref:i}=e,a=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${r} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let s=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(r=>{s&&r.updateJoinPayload({access_token:s,version:this.headers&&this.headers["X-Client-Info"]}),r.joinedOnce&&r._isJoined()&&r._push(oe.access_token,{access_token:s})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Rc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let s=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${e}"`),s.unsubscribe())}_remove(e){this.channels=this.channels.filter(s=>s.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,s=>{let{topic:r,event:n,payload:i,ref:a}=s;r==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(s.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${a&&"("+a+")"||""}`,i),Array.from(this.channels).filter(l=>l._isMember(r)).forEach(l=>l._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(l=>l(s))})}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(s=>s(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(s=>s(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(oe.error))}_appendParams(e,s){if(Object.keys(s).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(s);return`${e}${r}${n}`}_workerObjectUrl(e){let s;if(e)s=e;else{const r=new Blob([Uc],{type:"application/javascript"});s=URL.createObjectURL(r)}return s}}class zc{constructor(e,s,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=it.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Ir extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function J(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class qc extends Ir{constructor(e,s){super(e),this.name="StorageApiError",this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class lr extends Ir{constructor(e,s){super(e),this.name="StorageUnknownError",this.originalError=s}}var Vc=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};const Io=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>Lt(async()=>{const{default:r}=await Promise.resolve().then(()=>xt);return{default:r}},void 0).then(({default:r})=>r(...s)):e=fetch,(...s)=>e(...s)},Gc=()=>Vc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Lt(()=>Promise.resolve().then(()=>xt),void 0)).Response:Response}),cr=t=>{if(Array.isArray(t))return t.map(s=>cr(s));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([s,r])=>{const n=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=cr(r)}),e};var Qe=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};const Vs=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Wc=(t,e,s)=>Qe(void 0,void 0,void 0,function*(){const r=yield Gc();t instanceof r&&!(s!=null&&s.noResolveJson)?t.json().then(n=>{e(new qc(Vs(n),t.status||500))}).catch(n=>{e(new lr(Vs(n),n))}):e(new lr(Vs(t),t))}),Jc=(t,e,s,r)=>{const n={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),s))};function Ut(t,e,s,r,n,i){return Qe(this,void 0,void 0,function*(){return new Promise((a,l)=>{t(s,Jc(e,r,n,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Wc(c,l,r))})})}function fs(t,e,s,r){return Qe(this,void 0,void 0,function*(){return Ut(t,"GET",e,s,r)})}function Oe(t,e,s,r,n){return Qe(this,void 0,void 0,function*(){return Ut(t,"POST",e,r,n,s)})}function Kc(t,e,s,r,n){return Qe(this,void 0,void 0,function*(){return Ut(t,"PUT",e,r,n,s)})}function Yc(t,e,s,r){return Qe(this,void 0,void 0,function*(){return Ut(t,"HEAD",e,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}function $o(t,e,s,r,n){return Qe(this,void 0,void 0,function*(){return Ut(t,"DELETE",e,r,n,s)})}var Z=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};const Xc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},jn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Qc{constructor(e,s={},r,n){this.url=e,this.headers=s,this.bucketId=r,this.fetch=Io(n)}uploadOrUpdate(e,s,r,n){return Z(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},jn),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${a.cacheControl}`,l["content-type"]=a.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),f=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:l},a!=null&&a.duplex?{duplex:a.duplex}:{})),m=yield f.json();return f.ok?{data:{path:d,id:m.Id,fullPath:m.Key},error:null}:{data:null,error:m}}catch(i){if(J(i))return{data:null,error:i};throw i}})}upload(e,s,r){return Z(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,s,r)})}uploadToSignedUrl(e,s,r,n){return Z(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${a}`);l.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:jn.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const f=yield this.fetch(l.toString(),{method:"PUT",body:c,headers:u}),m=yield f.json();return f.ok?{data:{path:i,fullPath:m.Key},error:null}:{data:null,error:m}}catch(c){if(J(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,s){return Z(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);s!=null&&s.upsert&&(n["x-upsert"]="true");const i=yield Oe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),a=new URL(this.url+i.url),l=a.searchParams.get("token");if(!l)throw new Ir("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:l},error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}})}update(e,s,r){return Z(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,s,r)})}move(e,s,r){return Z(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}})}copy(e,s,r){return Z(this,void 0,void 0,function*(){try{return{data:{path:(yield Oe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}})}createSignedUrl(e,s,r){return Z(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield Oe(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:s},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}})}createSignedUrls(e,s,r){return Z(this,void 0,void 0,function*(){try{const n=yield Oe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}})}download(e,s){return Z(this,void 0,void 0,function*(){const n=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),a=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield fs(this.fetch,`${this.url}/${n}/${l}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(J(l))return{data:null,error:l};throw l}})}info(e){return Z(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{const r=yield fs(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:cr(r),error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}})}exists(e){return Z(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{return yield Yc(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(J(r)&&r instanceof lr){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,s){const r=this._getFinalPath(e),n=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&n.push(i);const l=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${d}`)}}}remove(e){return Z(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(s){if(J(s))return{data:null,error:s};throw s}})}list(e,s,r){return Z(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Xc),s),{prefix:e||""});return{data:yield Oe(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const s=[];return e.width&&s.push(`width=${e.width}`),e.height&&s.push(`height=${e.height}`),e.resize&&s.push(`resize=${e.resize}`),e.format&&s.push(`format=${e.format}`),e.quality&&s.push(`quality=${e.quality}`),s.join("&")}}const Zc="2.7.1",ed={"X-Client-Info":`storage-js/${Zc}`};var et=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};class td{constructor(e,s={},r){this.url=e,this.headers=Object.assign(Object.assign({},ed),s),this.fetch=Io(r)}listBuckets(){return et(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(J(e))return{data:null,error:e};throw e}})}getBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(s){if(J(s))return{data:null,error:s};throw s}})}createBucket(e,s={public:!1}){return et(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}})}updateBucket(e,s){return et(this,void 0,void 0,function*(){try{return{data:yield Kc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}})}emptyBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(J(s))return{data:null,error:s};throw s}})}deleteBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(s){if(J(s))return{data:null,error:s};throw s}})}}class sd extends td{constructor(e,s={},r){super(e,s,r)}from(e){return new Qc(this.url,this.headers,e,this.fetch)}}const rd="2.49.10";let At="";typeof Deno<"u"?At="deno":typeof document<"u"?At="web":typeof navigator<"u"&&navigator.product==="ReactNative"?At="react-native":At="node";const nd={"X-Client-Info":`supabase-js-${At}/${rd}`},od={headers:nd},id={schema:"public"},ad={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ld={};var cd=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};const dd=t=>{let e;return t?e=t:typeof fetch>"u"?e=bo:e=fetch,(...s)=>e(...s)},ud=()=>typeof Headers>"u"?vo:Headers,hd=(t,e,s)=>{const r=dd(s),n=ud();return(i,a)=>cd(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:t;let d=new n(a==null?void 0:a.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:d}))})};var fd=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};function md(t){return t.endsWith("/")?t:t+"/"}function pd(t,e){var s,r;const{db:n,auth:i,realtime:a,global:l}=t,{db:c,auth:d,realtime:u,global:f}=e,m={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),a),global:Object.assign(Object.assign(Object.assign({},f),l),{headers:Object.assign(Object.assign({},(s=f==null?void 0:f.headers)!==null&&s!==void 0?s:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>fd(this,void 0,void 0,function*(){return""})};return t.accessToken?m.accessToken=t.accessToken:delete m.accessToken,m}const Fo="2.69.1",rt=30*1e3,dr=3,Gs=dr*rt,gd="http://localhost:9999",yd="supabase.auth.token",xd={"X-Client-Info":`gotrue-js/${Fo}`},ur="X-Supabase-Api-Version",Mo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bd=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vd=6e5;class $r extends Error{constructor(e,s,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=r}}function I(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class wd extends $r{constructor(e,s,r){super(e,s,r),this.name="AuthApiError",this.status=s,this.code=r}}function _d(t){return I(t)&&t.name==="AuthApiError"}class Do extends $r{constructor(e,s){super(e),this.name="AuthUnknownError",this.originalError=s}}class Ue extends $r{constructor(e,s,r,n){super(e,r,n),this.name=s,this.status=r}}class Pe extends Ue{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function jd(t){return I(t)&&t.name==="AuthSessionMissingError"}class Ws extends Ue{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Qt extends Ue{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Zt extends Ue{constructor(e,s=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Sd(t){return I(t)&&t.name==="AuthImplicitGrantRedirectError"}class Sn extends Ue{constructor(e,s=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hr extends Ue{constructor(e,s){super(e,"AuthRetryableFetchError",s,void 0)}}function Js(t){return I(t)&&t.name==="AuthRetryableFetchError"}class Nn extends Ue{constructor(e,s,r){super(e,"AuthWeakPasswordError",s,"weak_password"),this.reasons=r}}class Ot extends Ue{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),kn=` 	
\r=`.split(""),Nd=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<kn.length;e+=1)t[kn[e].charCodeAt(0)]=-2;for(let e=0;e<Cn.length;e+=1)t[Cn[e].charCodeAt(0)]=e;return t})();function Lo(t,e,s){const r=Nd[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)s(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function An(t){const e=[],s=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=a=>{Ad(a,r,s)};for(let a=0;a<t.length;a+=1)Lo(t.charCodeAt(a),n,i);return e.join("")}function Cd(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function kd(t,e){for(let s=0;s<t.length;s+=1){let r=t.charCodeAt(s);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(t.charCodeAt(s+1)-56320&65535|n)+65536,s+=1}Cd(r,e)}}function Ad(t,e,s){if(e.utf8seq===0){if(t<=127){s(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&s(e.codepoint)}}function Pd(t){const e=[],s={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)Lo(t.charCodeAt(n),s,r);return new Uint8Array(e)}function Ed(t){const e=[];return kd(t,s=>e.push(s)),new Uint8Array(e)}function Od(t){return Math.round(Date.now()/1e3)+t}function Td(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const ce=()=>typeof window<"u"&&typeof document<"u",Ve={tested:!1,writable:!1},Tt=()=>{if(!ce())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ve.tested)return Ve.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ve.tested=!0,Ve.writable=!0}catch{Ve.tested=!0,Ve.writable=!1}return Ve.writable};function Rd(t){const e={},s=new URL(t);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return s.searchParams.forEach((r,n)=>{e[n]=r}),e}const Bo=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>Lt(async()=>{const{default:r}=await Promise.resolve().then(()=>xt);return{default:r}},void 0).then(({default:r})=>r(...s)):e=fetch,(...s)=>e(...s)},Id=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Uo=async(t,e,s)=>{await t.setItem(e,JSON.stringify(s))},es=async(t,e)=>{const s=await t.getItem(e);if(!s)return null;try{return JSON.parse(s)}catch{return s}},ts=async(t,e)=>{await t.removeItem(e)};class Es{constructor(){this.promise=new Es.promiseConstructor((e,s)=>{this.resolve=e,this.reject=s})}}Es.promiseConstructor=Promise;function Ks(t){const e=t.split(".");if(e.length!==3)throw new Ot("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!bd.test(e[r]))throw new Ot("JWT not in base64url format");return{header:JSON.parse(An(e[0])),payload:JSON.parse(An(e[1])),signature:Pd(e[2]),raw:{header:e[0],payload:e[1]}}}async function $d(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Fd(t,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await t(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function Md(t){return("0"+t.toString(16)).substr(-2)}function Dd(){const e=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=s.length;let n="";for(let i=0;i<56;i++)n+=s.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,Md).join("")}async function Ld(t){const s=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",s),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Bd(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const s=await Ld(t);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tt(t,e,s=!1){const r=Dd();let n=r;s&&(n+="/PASSWORD_RECOVERY"),await Uo(t,`${e}-code-verifier`,n);const i=await Bd(r);return[i,r===i?"plain":"s256"]}const Ud=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Hd(t){const e=t.headers.get(ur);if(!e||!e.match(Ud))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function zd(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function qd(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Vd=function(t,e){var s={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(s[r[n]]=t[r[n]]);return s};const Ge=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Gd=[502,503,504];async function Pn(t){var e;if(!Id(t))throw new hr(Ge(t),0);if(Gd.includes(t.status))throw new hr(Ge(t),t.status);let s;try{s=await t.json()}catch(i){throw new Do(Ge(i),i)}let r;const n=Hd(t);if(n&&n.getTime()>=Mo["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?r=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(r=s.error_code),r){if(r==="weak_password")throw new Nn(Ge(s),t.status,((e=s.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Pe}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new Nn(Ge(s),t.status,s.weak_password.reasons);throw new wd(Ge(s),t.status||500,r)}const Wd=(t,e,s,r)=>{const n={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))};async function $(t,e,s,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[ur]||(i[ur]=Mo["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Jd(t,e,s+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Jd(t,e,s,r,n,i){const a=Wd(e,r,n,i);let l;try{l=await t(s,Object.assign({},a))}catch(c){throw console.error(c),new hr(Ge(c),0)}if(l.ok||await Pn(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Pn(c)}}function Ee(t){var e;let s=null;Qd(t)&&(s=Object.assign({},t),t.expires_at||(s.expires_at=Od(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:s,user:r},error:null}}function En(t){const e=Ee(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((s,r)=>s&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Te(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Kd(t){return{data:t,error:null}}function Yd(t){const{action_link:e,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i}=t,a=Vd(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:l,user:c},error:null}}function Xd(t){return t}function Qd(t){return t.access_token&&t.refresh_token&&t.expires_in}var Zd=function(t,e){var s={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(s[r[n]]=t[r[n]]);return s};class eu{constructor({url:e="",headers:s={},fetch:r}){this.url=e,this.headers=s,this.fetch=Bo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,s="global"){try{return await $(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,s={}){try{return await $(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Te})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:s}=e,r=Zd(e,["options"]),n=Object.assign(Object.assign({},r),s);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await $(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Yd,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(I(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(e){try{return await $(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Te})}catch(s){if(I(s))return{data:{user:null},error:s};throw s}}async listUsers(e){var s,r,n,i,a,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await $(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(s=e==null?void 0:e.page)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Xd});if(u.error)throw u.error;const f=await u.json(),m=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return h.length>0&&(h.forEach(p=>{const y=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(p.split(";")[1].split("=")[1]);d[`${x}Page`]=y}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(I(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){try{return await $(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Te})}catch(s){if(I(s))return{data:{user:null},error:s};throw s}}async updateUserById(e,s){try{return await $(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:s,headers:this.headers,xform:Te})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,s=!1){try{return await $(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:s},xform:Te})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:s,error:r}=await $(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:s,error:r}}catch(s){if(I(s))return{data:null,error:s};throw s}}async _deleteFactor(e){try{return{data:await $(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(s){if(I(s))return{data:null,error:s};throw s}}}const tu={getItem:t=>Tt()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{Tt()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{Tt()&&globalThis.localStorage.removeItem(t)}};function On(t={}){return{getItem:e=>t[e]||null,setItem:(e,s)=>{t[e]=s},removeItem:e=>{delete t[e]}}}function su(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const st={debug:!!(globalThis&&Tt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ho extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ru extends Ho{}async function nu(t,e,s){st.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),st.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){st.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await s()}finally{st.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(e===0)throw st.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new ru(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(st.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}su();const ou={url:gd,storageKey:yd,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:xd,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Tn(t,e,s){return await s()}class $t{constructor(e){var s,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=$t.nextInstanceID,$t.nextInstanceID+=1,this.instanceID>0&&ce()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ou),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new eu({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Bo(n.fetch),this.lock=n.lock||Tn,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:ce()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=nu:this.lock=Tn,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:Tt()?this.storage=tu:(this.memoryStorage={},this.storage=On(this.memoryStorage)):(this.memoryStorage={},this.storage=On(this.memoryStorage)),ce()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Fo}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const s=Rd(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":await this._isPKCECallback(s)&&(r="pkce"),ce()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(s,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Sd(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return I(s)?{error:s}:{error:new Do("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var s,r,n;try{const i=await $(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:Ee}),{data:a,error:l}=i;if(l||!a)return{data:{user:null,session:null},error:l};const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(I(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var s,r,n;try{let i;if("email"in e){const{email:u,password:f,options:m}=e;let h=null,p=null;this.flowType==="pkce"&&([h,p]=await tt(this.storage,this.storageKey)),i=await $(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:u,password:f,data:(s=m==null?void 0:m.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:h,code_challenge_method:p},xform:Ee})}else if("phone"in e){const{phone:u,password:f,options:m}=e;i=await $(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:f,data:(r=m==null?void 0:m.data)!==null&&r!==void 0?r:{},channel:(n=m==null?void 0:m.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:Ee})}else throw new Qt("You must provide either an email or phone number and a password");const{data:a,error:l}=i;if(l||!a)return{data:{user:null,session:null},error:l};const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(I(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let s;if("email"in e){const{email:i,password:a,options:l}=e;s=await $(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:En})}else if("phone"in e){const{phone:i,password:a,options:l}=e;s=await $(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:En})}else throw new Qt("You must provide either an email or phone number and a password");const{data:r,error:n}=s;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ws}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(s){if(I(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(e){var s,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const s=await es(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(s??"").split("/");try{const{data:i,error:a}=await $(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ee});if(await ts(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ws}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(I(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:s,provider:r,token:n,access_token:i,nonce:a}=e,l=await $(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Ee}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ws}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(I(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(e){var s,r,n,i,a;try{if("email"in e){const{email:l,options:c}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await tt(this.storage,this.storageKey));const{error:f}=await $(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:u}=await $(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new Qt("You must provide either an email or phone number.")}catch(l){if(I(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var s,r;try{let n,i;"options"in e&&(n=(s=e.options)===null||s===void 0?void 0:s.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:l}=await $(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Ee});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,d=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(n){if(I(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var s,r,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await tt(this.storage,this.storageKey)),await $(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(s=e.options)===null||s===void 0?void 0:s.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Kd})}catch(i){if(I(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:s},error:r}=e;if(r)throw r;if(!s)throw new Pe;const{error:n}=await $(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(I(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const s=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:a}=await $(this.fetch,"POST",s,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:a,error:l}=await $(this.fetch,"POST",s,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:l}}throw new Qt("You must provide either an email or phone number and a type")}catch(s){if(I(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(e,s){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await s()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=s();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await e(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const s=await es(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Gs:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,d,u)=>(!a&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await $(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Te}):await this._useSession(async s=>{var r,n,i;const{data:a,error:l}=s;if(l)throw l;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pe}:await $(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Te})})}catch(s){if(I(s))return jd(s)&&(await this._removeSession(),await ts(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(e,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,s))}async _updateUser(e,s={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new Pe;const a=n.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await tt(this.storage,this.storageKey));const{data:d,error:u}=await $(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:Te});if(u)throw u;return a.user=d.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Pe;const s=Date.now()/1e3;let r=s,n=!0,i=null;const{payload:a}=Ks(e.access_token);if(a.exp&&(r=a.exp,n=r<=s),n){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-s,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(I(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async s=>{var r;if(!e){const{data:a,error:l}=s;if(l)throw l;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Pe;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(I(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(e,s){try{if(!ce())throw new Zt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Zt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Sn("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Zt("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Sn("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!a||!d)throw new Zt("No session defined in URL");const u=Math.round(Date.now()/1e3),f=parseInt(l);let m=u+f;c&&(m=parseInt(c));const h=m-u;h*1e3<=rt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${f}s`);const p=m-f;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,m,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,m,u);const{data:y,error:x}=await this._getUser(i);if(x)throw x;const b={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:f,expires_at:m,refresh_token:a,token_type:d,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(r){if(I(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const s=await es(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&s)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async s=>{var r;const{data:n,error:i}=s;if(i)return{error:i};const a=(r=n.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:l}=await this.admin.signOut(a,e);if(l&&!(_d(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await ts(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const s=Td(),r={id:s,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async s=>{var r,n;try{const{data:{session:i},error:a}=s;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,s={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await tt(this.storage,this.storageKey,!0));try{return await $(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(I(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:s,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=s.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(s){if(I(s))return{data:null,error:s};throw s}}async linkIdentity(e){var s;try{const{data:r,error:n}=await this._useSession(async i=>{var a,l,c,d,u;const{data:f,error:m}=i;if(m)throw m;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await $(this.fetch,"GET",h,{headers:this.headers,jwt:(u=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return ce()&&!(!((s=e.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(I(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async s=>{var r,n;const{data:i,error:a}=s;if(a)throw a;return await $(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(s){if(I(s))return{data:null,error:s};throw s}}async _refreshAccessToken(e){const s=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{const r=Date.now();return await Fd(async n=>(n>0&&await $d(200*Math.pow(2,n-1)),this._debug(s,"refreshing attempt",n),await $(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ee})),(n,i)=>{const a=200*Math.pow(2,n);return i&&Js(i)&&Date.now()+a-r<rt})}catch(r){if(this._debug(s,"error",r),I(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(s,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,s){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",s,"url",r),ce()&&!s.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await es(this.storage,this.storageKey);if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),r!==null&&await this._removeSession();return}const n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Gs;if(this._debug(s,`session has${n?"":" not"} expired with margin of ${Gs}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),Js(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(s,"error",r),console.error(r);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var s,r;if(!e)throw new Pe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Es;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Pe;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),I(i)){const a={session:null,error:i};return Js(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,s,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:s});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,s)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Uo(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await ts(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ce()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),rt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async s=>{const{data:{session:r}}=s;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/rt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${rt}ms, refresh threshold is ${dr} ticks`),n<=dr&&await this._callRefreshToken(r.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ho)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ce()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const s=`#_onVisibilityChanged(${e})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,s,r){const n=[`provider=${encodeURIComponent(s)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await tt(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async s=>{var r;const{data:n,error:i}=s;return i?{data:null,error:i}:await $(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(I(s))return{data:null,error:s};throw s}}async _enroll(e){try{return await this._useSession(async s=>{var r,n;const{data:i,error:a}=s;if(a)return{data:null,error:a};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:d}=await $(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(I(s))return{data:null,error:s};throw s}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:n,error:i}=s;if(i)return{data:null,error:i};const{data:a,error:l}=await $(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(s){if(I(s))return{data:null,error:s};throw s}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:n,error:i}=s;return i?{data:null,error:i}:await $(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(I(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(e){const{data:s,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:s.id,code:e.code})}async _listFactors(){const{data:{user:e},error:s}=await this.getUser();if(s)return{data:null,error:s};const r=(e==null?void 0:e.factors)||[],n=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var s,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Ks(n.access_token);let l=null;a.aal&&(l=a.aal);let c=l;((r=(s=n.user.factors)===null||s===void 0?void 0:s.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,s={keys:[]}){let r=s.keys.find(a=>a.kid===e);if(r||(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+vd>Date.now()))return r;const{data:n,error:i}=await $(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new Ot("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),r=n.keys.find(a=>a.kid===e),!r)throw new Ot("No matching signing key found in JWKS");return r}async getClaims(e,s={keys:[]}){try{let r=e;if(!r){const{data:h,error:p}=await this.getSession();if(p||!h.session)return{data:null,error:p};r=h.session.access_token}const{header:n,payload:i,signature:a,raw:{header:l,payload:c}}=Ks(r);if(zd(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:h}=await this.getUser(r);if(h)throw h;return{data:{claims:i,header:n,signature:a},error:null}}const d=qd(n.alg),u=await this.fetchJwk(n.kid,s),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,a,Ed(`${l}.${c}`)))throw new Ot("Invalid JWT signature");return{data:{claims:i,header:n,signature:a},error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}}}$t.nextInstanceID=0;const iu=$t;class au extends iu{constructor(e){super(e)}}var lu=function(t,e,s,r){function n(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(f){a(f)}}function c(u){try{d(r.throw(u))}catch(f){a(f)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})};class cu{constructor(e,s,r){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=s,!e)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const l=md(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:id,realtime:ld,auth:Object.assign(Object.assign({},ad),{storageKey:d}),global:od},f=pd(r??{},u);this.storageKey=(n=f.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=f.global.headers)!==null&&i!==void 0?i:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=f.auth)!==null&&a!==void 0?a:{},this.headers,f.global.fetch),this.fetch=hd(s,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new Ac(new URL("rest/v1",c).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),f.accessToken||this._listenForAuthEvents()}get functions(){return new nc(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new sd(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,s={},r={}){return this.rest.rpc(e,s,r)}channel(e,s={config:{}}){return this.realtime.channel(e,s)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,s;return lu(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(s=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&s!==void 0?s:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:s,detectSessionInUrl:r,storage:n,storageKey:i,flowType:a,lock:l,debug:c},d,u){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new au({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),d),storageKey:i,autoRefreshToken:e,persistSession:s,detectSessionInUrl:r,storage:n,flowType:a,lock:l,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Hc(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,r)=>{this._handleTokenChanged(s,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,s,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const du=(t,e,s)=>new cu(t,e,s),uu="https://jofuqlexuxzamltxxzuq.supabase.co",hu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvZnVxbGV4dXh6YW1sdHh4enVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxMDA2NjAsImV4cCI6MjA2NDY3NjY2MH0.Fq_Sx7NUeZF2k-erwrj_V-2npReXum9Cmuufsco3Cmw",Ht=du(uu,hu),fu=async()=>{try{console.log("Testing Supabase connection...");const{data:t,error:e}=await Ht.from("consent_forms").select("count").limit(1);return e?(console.error("Supabase connection test error:",e),!1):(console.log("Supabase connection test successful"),!0)}catch(t){return console.error("Supabase connection test failed:",t),!1}},zo=async(t,e)=>{try{const s=e?"form_drafts":"consent_forms",{data:r,error:n}=await Ht.from(s).insert([{patient_name:t.patientName,age:t.age?parseInt(t.age):null,birth_date:t.birthDate,id_number:t.idNumber,marital_status:t.maritalStatus,gender:t.gender,employer_school:t.employerSchool,occupation_grade:t.occupationGrade,cell_phone:t.cellPhone,whatsapp_number:t.whatsappNumber,same_as_contact_number:t.sameAsContactNumber||!1,email:t.email,address:t.address,postal_code:t.postalCode,responsible_for_payment:t.responsibleForPayment||"",account_holder_name:t.accountHolderName,account_holder_age:t.accountHolderAge?parseInt(t.accountHolderAge):null,emergency_name:t.emergencyName||"",emergency_relationship:t.emergencyRelationship||"",emergency_phone:t.emergencyPhone||"",gp_name:t.gpName,gp_contact:t.gpContact,chronic_conditions:Array.isArray(t.chronicConditions)?t.chronicConditions:[],allergies:t.allergies||"",medication:t.medication||"",payment_preference:t.paymentPreference,medical_aid_name:t.medicalAidName,medical_aid_no:t.medicalAidNo,medical_aid_plan:t.medicalAidPlan,main_member:t.mainMember,dependant_code:t.dependantCode,signature:t.signature||"",region_code:t.regionCode||"",doctor:t.doctor,practice_number:t.practiceNumber,consent_agreement:e?t.consentAgreement||!1:!0,status:e?"draft":"completed",encrypted:!0,timestamp:new Date().toISOString(),last_modified:new Date().toISOString()}]).select().single();if(n)throw console.error("Error saving form to Supabase:",n),new Error(`Failed to save form: ${n.message}`);return{...t,id:r.id,timestamp:r.timestamp,lastModified:r.last_modified}}catch(s){throw console.error("Save form error:",s),s}},mu=async(t,e,s)=>{try{const r=s?"form_drafts":"consent_forms",{data:n,error:i}=await Ht.from(r).update({patient_name:e.patientName,age:e.age?parseInt(e.age):null,birth_date:e.birthDate,id_number:e.idNumber,marital_status:e.maritalStatus,gender:e.gender,employer_school:e.employerSchool,occupation_grade:e.occupationGrade,cell_phone:e.cellPhone,whatsapp_number:e.whatsappNumber,same_as_contact_number:e.sameAsContactNumber||!1,email:e.email,address:e.address,postal_code:e.postalCode,responsible_for_payment:e.responsibleForPayment||"",account_holder_name:e.accountHolderName,account_holder_age:e.accountHolderAge?parseInt(e.accountHolderAge):null,emergency_name:e.emergencyName||"",emergency_relationship:e.emergencyRelationship||"",emergency_phone:e.emergencyPhone||"",gp_name:e.gpName,gp_contact:e.gpContact,chronic_conditions:Array.isArray(e.chronicConditions)?e.chronicConditions:[],allergies:e.allergies||"",medication:e.medication||"",payment_preference:e.paymentPreference,medical_aid_name:e.medicalAidName,medical_aid_no:e.medicalAidNo,medical_aid_plan:e.medicalAidPlan,main_member:e.mainMember,dependant_code:e.dependantCode,signature:e.signature||"",region_code:e.regionCode||"",doctor:e.doctor,practice_number:e.practiceNumber,consent_agreement:s?e.consentAgreement||!1:!0,status:s?"draft":"completed",last_modified:new Date().toISOString()}).eq("id",t).select().single();if(i)throw console.error("Error updating form in Supabase:",i),new Error(`Failed to update form: ${i.message}`);return{...e,id:n.id,timestamp:n.timestamp,lastModified:n.last_modified}}catch(r){throw console.error("Update form error:",r),r}},qo=async t=>{try{const e=t?"form_drafts":"consent_forms",{data:s,error:r}=await Ht.from(e).select("*").order("created_at",{ascending:!1});if(r)throw console.error("Error fetching forms from Supabase:",r),new Error(`Failed to fetch forms: ${r.message}`);return(s||[]).map(n=>{var i,a;return{id:n.id,patientName:n.patient_name,age:(i=n.age)==null?void 0:i.toString(),birthDate:n.birth_date,idNumber:n.id_number,maritalStatus:n.marital_status,gender:n.gender,employerSchool:n.employer_school,occupationGrade:n.occupation_grade,cellPhone:n.cell_phone,whatsappNumber:n.whatsapp_number,sameAsContactNumber:n.same_as_contact_number||!1,email:n.email,address:n.address,postalCode:n.postal_code,responsibleForPayment:n.responsible_for_payment,accountHolderName:n.account_holder_name,accountHolderAge:(a=n.account_holder_age)==null?void 0:a.toString(),emergencyName:n.emergency_name,emergencyRelationship:n.emergency_relationship,emergencyPhone:n.emergency_phone,gpName:n.gp_name,gpContact:n.gp_contact,chronicConditions:Array.isArray(n.chronic_conditions)?n.chronic_conditions.map(l=>String(l)):n.chronic_conditions?[String(n.chronic_conditions)]:[],allergies:n.allergies,medication:n.medication,paymentPreference:n.payment_preference,medicalAidName:n.medical_aid_name,medicalAidNo:n.medical_aid_no,medicalAidPlan:n.medical_aid_plan,mainMember:n.main_member,dependantCode:n.dependant_code,signature:n.signature,regionCode:n.region_code,doctor:n.doctor,practiceNumber:n.practice_number,consentAgreement:n.consent_agreement,status:n.status,timestamp:n.timestamp,lastModified:n.last_modified,createdAt:n.created_at}})}catch(e){throw console.error("Get forms error:",e),e}},pu=async(t,e)=>{try{const s=e?"form_drafts":"consent_forms",{error:r}=await Ht.from(s).delete().eq("id",t);if(r)throw console.error("Error deleting form from Supabase:",r),new Error(`Failed to delete form: ${r.message}`)}catch(s){throw console.error("Delete form error:",s),s}},gu=async()=>{try{if(!window.indexedDB)return!1;const t=window.indexedDB.open("test",1);return new Promise(e=>{t.onsuccess=()=>{t.result.close(),e(!0)},t.onerror=()=>e(!1)})}catch{return!1}};let Ke={supabase:!1,indexedDB:!1};const Rn=async()=>{try{const[t,e]=await Promise.all([fu(),gu()]);return Ke={supabase:t,indexedDB:e},console.log("Storage capabilities initialized:",Ke),Ke}catch(t){return console.error("Error initializing storage:",t),Ke}},Os=()=>({...Ke}),Rt=t=>{Ke={...Ke,...t}},yu="consentFormDB",xu=2,dt="forms",fe="drafts",vt=()=>new Promise((t,e)=>{const s=indexedDB.open(yu,xu);s.onerror=()=>{e(new Error("Failed to open IndexedDB"))},s.onsuccess=()=>{const r=s.result;t(r)},s.onupgradeneeded=r=>{const n=r.target.result;if(!n.objectStoreNames.contains(dt)){const i=n.createObjectStore(dt,{keyPath:"id",autoIncrement:!0});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("synced","synced",{unique:!1}),i.createIndex("regionCode","regionCode",{unique:!1}),i.createIndex("status","status",{unique:!1})}if(!n.objectStoreNames.contains(fe)){const i=n.createObjectStore(fe,{keyPath:"id",autoIncrement:!0});i.createIndex("lastModified","lastModified",{unique:!1}),i.createIndex("regionCode","regionCode",{unique:!1})}}}),bu=async t=>{const r=(await vt()).transaction([dt],"readwrite").objectStore(dt);return await new Promise((i,a)=>{const l=r.add(t);l.onsuccess=()=>i(l.result),l.onerror=()=>a(l.error)})},Vo=async()=>{const s=(await vt()).transaction([dt],"readonly").objectStore(dt);return new Promise((r,n)=>{const i=s.getAll();i.onsuccess=()=>r(i.result),i.onerror=()=>n(i.error)})},vu=async t=>{const r=(await vt()).transaction([fe],"readwrite").objectStore(fe);return await new Promise((i,a)=>{const l=r.add(t);l.onsuccess=()=>i(l.result),l.onerror=()=>a(l.error)})},fr=async()=>{const s=(await vt()).transaction([fe],"readonly").objectStore(fe);return new Promise((r,n)=>{const i=s.getAll();i.onsuccess=()=>r(i.result),i.onerror=()=>n(i.error)})},wu=async t=>{const r=(await vt()).transaction([fe],"readwrite").objectStore(fe);return new Promise((n,i)=>{const a=r.delete(t);a.onsuccess=()=>n(),a.onerror=()=>i(a.error)})},In=async(t,e)=>{const n=(await vt()).transaction([fe],"readwrite").objectStore(fe);return new Promise((i,a)=>{const l=n.put({...e,id:t});l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})},_u=async(t,e=!1)=>{const s=Os();let r=null,n=null;if(e&&(t.patientName||t.idNumber)&&s.indexedDB)try{const a=(await fr()).find(l=>t.patientName&&l.patientName===t.patientName||t.idNumber&&l.idNumber===t.idNumber);if(a&&a.id!==t.id){const l={...a,...t,id:a.id};return await In(a.id,l),console.log("Updated existing draft to prevent duplicate"),l}}catch(i){console.error("Error checking for duplicate drafts:",i)}if(e&&t.id){if(s.indexedDB)try{if((await fr()).find(l=>l.id===t.id))return await In(t.id,t),n={...t},console.log("Updated existing draft in IndexedDB"),n}catch(i){console.error("IndexedDB update failed:",i)}if(s.supabase&&!e)try{if((await qo(!1)).find(l=>l.id===t.id))return r=await mu(t.id,t,e),console.log("Updated existing form in Supabase"),r}catch(i){console.error("Supabase update check failed:",i),Rt({supabase:!1})}}if(!e&&s.supabase)try{return r=await zo(t,e),console.log("Form saved to Supabase successfully"),r}catch(i){console.error("Supabase save failed, trying IndexedDB:",i),Rt({supabase:!1})}if(s.indexedDB)try{const i=e?await vu(t):await bu(t);return n={...t,id:i},console.log(`${e?"Draft":"Form"} saved to IndexedDB`),n}catch(i){console.error("IndexedDB save also failed:",i),Rt({indexedDB:!1})}throw new Error("All storage methods failed")},ju=async(t=!1)=>{const e=Os();if(!t&&e.supabase)try{const s=await qo(t);return console.log(`Retrieved ${s.length} forms from Supabase`),s}catch(s){console.error("Supabase fetch failed, trying IndexedDB:",s),Rt({supabase:!1})}if(e.indexedDB)try{const s=t?await fr():await Vo();return console.log(`Retrieved ${s.length} ${t?"drafts":"forms"} from IndexedDB`),s}catch(s){console.error("IndexedDB fetch also failed:",s),Rt({indexedDB:!1})}return console.warn("No storage methods available, returning empty array"),[]},Su=async(t,e=!1)=>{const s=Os();let r=!1,n=!1,i=null;if(console.log(`Attempting to delete ${e?"draft":"form"} with ID:`,t,typeof t),!e&&s.supabase&&typeof t=="string")try{await pu(t,e),r=!0,console.log("Form deleted from Supabase")}catch(a){console.error("Supabase delete failed:",a),i=a}if(s.indexedDB)try{const a=typeof t=="string"?parseInt(t,10):t;if(isNaN(a))throw new Error(`Invalid ID for IndexedDB deletion: ${t}`);e?(await wu(a),n=!0,console.log(`Draft deleted from IndexedDB with ID: ${a}`)):(console.warn("Delete completed form from IndexedDB not fully implemented"),n=!0)}catch(a){console.error("IndexedDB delete failed:",a),i=a}if(!r&&!n)throw i||new Error("Failed to delete form from all storage methods")},Nu=async()=>{const t=Os();if(!t.indexedDB||!t.supabase)return console.log("Sync skipped: required storage not available"),{success:0,failed:0};const e={success:0,failed:0};try{console.log("Starting sync of completed forms only (drafts will remain local)");const r=(await Vo()).filter(n=>!n.synced&&n.status!=="draft");console.log(`Found ${r.length} unsynced completed forms to sync`);for(const n of r)try{await zo(n,!1),e.success++,console.log(`Successfully synced completed form: ${n.id}`)}catch(i){console.error("Failed to sync completed form:",n.id,i),e.failed++}console.log(`Sync completed: ${e.success} success, ${e.failed} failed`),console.log("Note: Draft forms were not synced and remain local-only")}catch(s){console.error("Sync process error:",s)}return e},Cu=1,ku=1e6;let Ys=0;function Au(){return Ys=(Ys+1)%Number.MAX_SAFE_INTEGER,Ys.toString()}const Xs=new Map,$n=t=>{if(Xs.has(t))return;const e=setTimeout(()=>{Xs.delete(t),It({type:"REMOVE_TOAST",toastId:t})},ku);Xs.set(t,e)},Pu=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,Cu)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(s=>s.id===e.toast.id?{...s,...e.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=e;return s?$n(s):t.toasts.forEach(r=>{$n(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===s||s===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==e.toastId)}}},os=[];let is={toasts:[]};function It(t){is=Pu(is,t),os.forEach(e=>{e(is)})}function Eu({...t}){const e=Au(),s=n=>It({type:"UPDATE_TOAST",toast:{...n,id:e}}),r=()=>It({type:"DISMISS_TOAST",toastId:e});return It({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:n=>{n||r()}}}),{id:e,dismiss:r,update:s}}function He(){const[t,e]=g.useState(is);return g.useEffect(()=>(os.push(e),()=>{const s=os.indexOf(e);s>-1&&os.splice(s,1)}),[t]),{...t,toast:Eu,dismiss:s=>It({type:"DISMISS_TOAST",toastId:s})}}const zt=()=>{const[t,e]=g.useState(!1),[s,r]=g.useState({supabase:!1,indexedDB:!1}),[n,i]=g.useState(navigator.onLine),{toast:a}=He();g.useEffect(()=>{(async()=>{try{const m=await Rn();r(m),e(!0),!m.supabase&&!m.indexedDB?a({title:"Storage Warning",description:"No storage methods available. Data may be lost.",variant:"destructive"}):m.supabase||a({title:"Offline Mode",description:"Using local storage only. Data will sync when online.",variant:"default"})}catch(m){console.error("Storage initialization failed:",m),a({title:"Storage Error",description:"Failed to initialize storage systems.",variant:"destructive"})}})()},[a]),g.useEffect(()=>{const f=async()=>{i(!0);const h=await Rn();if(r(h),h.supabase){a({title:"Back Online",description:"Connected to cloud storage. Syncing data..."});try{const p=await u();p.success>0&&a({title:"Sync Complete",description:`Successfully synced ${p.success} items.`})}catch(p){console.error("Auto-sync failed:",p)}}},m=()=>{i(!1),r(h=>({...h,supabase:!1})),a({title:"Offline Mode",description:"Using local storage only."})};return window.addEventListener("online",f),window.addEventListener("offline",m),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",m)}},[a]);const l=async(f,m=!1)=>{try{const h=await _u(f,m);return!s.supabase&&s.indexedDB&&a({title:"Saved Locally",description:"Data saved to local storage. Will sync when online."}),h}catch(h){throw console.error("Save failed:",h),a({title:"Save Failed",description:"Unable to save form data.",variant:"destructive"}),h}},c=async(f=!1)=>{try{return await ju(f)}catch(m){return console.error("Get forms failed:",m),a({title:"Load Failed",description:"Unable to load form data.",variant:"destructive"}),[]}},d=async(f,m=!1)=>{try{await Su(f,m),a({title:"Deleted",description:"Form deleted successfully."})}catch(h){throw console.error("Delete failed:",h),a({title:"Delete Failed",description:"Unable to delete form.",variant:"destructive"}),h}},u=async()=>{try{return await Nu()}catch(f){return console.error("Sync failed:",f),a({title:"Sync Failed",description:"Unable to sync data to cloud storage.",variant:"destructive"}),{success:0,failed:0}}};return{isInitialized:t,capabilities:s,saveForm:l,getForms:c,deleteForm:d,syncData:u,isOnline:n}},Ts=Qn,Ou=Zn,Tu=Xn,Go=g.forwardRef(({className:t,...e},s)=>o.jsx(vr,{ref:s,className:L("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));Go.displayName=vr.displayName;const qt=g.forwardRef(({className:t,children:e,...s},r)=>o.jsxs(Tu,{children:[o.jsx(Go,{}),o.jsxs(wr,{ref:r,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[e,o.jsxs(_r,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[o.jsx(gl,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));qt.displayName=wr.displayName;const Vt=({className:t,...e})=>o.jsx("div",{className:L("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});Vt.displayName="DialogHeader";const Gt=g.forwardRef(({className:t,...e},s)=>o.jsx(jr,{ref:s,className:L("text-lg font-semibold leading-none tracking-tight",t),...e}));Gt.displayName=jr.displayName;const Wo=g.forwardRef(({className:t,...e},s)=>o.jsx(Sr,{ref:s,className:L("text-sm text-muted-foreground",t),...e}));Wo.displayName=Sr.displayName;const Ru=({onRefresh:t,size:e="default"})=>o.jsxs(D,{onClick:t,variant:"outline",size:e,children:[o.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Refresh"]}),Iu=({onRefresh:t})=>o.jsx(Vt,{children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx(Gt,{className:"text-xl font-bold text-gray-900",children:"Form Management Center"}),o.jsx(Wo,{className:"text-sm text-gray-500",children:"Manage saved drafts, monitor submission queue, and handle pending forms"})]}),o.jsx(Ru,{onRefresh:t,size:"sm"})]})});function $u(t,e=[]){let s=[];function r(i,a){const l=g.createContext(a),c=s.length;s=[...s,a];function d(f){const{scope:m,children:h,...p}=f,y=(m==null?void 0:m[t][c])||l,x=g.useMemo(()=>p,Object.values(p));return o.jsx(y.Provider,{value:x,children:h})}function u(f,m){const h=(m==null?void 0:m[t][c])||l,p=g.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${i}\``)}return d.displayName=i+"Provider",[d,u]}const n=()=>{const i=s.map(a=>g.createContext(a));return function(l){const c=(l==null?void 0:l[t])||i;return g.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return n.scopeName=t,[r,Fu(n,...e)]}function Fu(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const r=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const a=r.reduce((l,{useScope:c,scopeName:d})=>{const f=c(i)[`__scope${d}`];return{...l,...f}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return s.scopeName=e.scopeName,s}function Mu(t){const e=t+"CollectionProvider",[s,r]=$u(e),[n,i]=s(e,{collectionRef:{current:null},itemMap:new Map}),a=h=>{const{scope:p,children:y}=h,x=xe.useRef(null),b=xe.useRef(new Map).current;return o.jsx(n,{scope:p,itemMap:b,collectionRef:x,children:y})};a.displayName=e;const l=t+"CollectionSlot",c=xe.forwardRef((h,p)=>{const{scope:y,children:x}=h,b=i(l,y),v=ue(p,b.collectionRef);return o.jsx(ds,{ref:v,children:x})});c.displayName=l;const d=t+"CollectionItemSlot",u="data-radix-collection-item",f=xe.forwardRef((h,p)=>{const{scope:y,children:x,...b}=h,v=xe.useRef(null),w=ue(p,v),_=i(d,y);return xe.useEffect(()=>(_.itemMap.set(v,{ref:v,...b}),()=>void _.itemMap.delete(v))),o.jsx(ds,{[u]:"",ref:w,children:x})});f.displayName=d;function m(h){const p=i(t+"CollectionConsumer",h);return xe.useCallback(()=>{const x=p.collectionRef.current;if(!x)return[];const b=Array.from(x.querySelectorAll(`[${u}]`));return Array.from(p.itemMap.values()).sort((_,j)=>b.indexOf(_.ref.current)-b.indexOf(j.ref.current))},[p.collectionRef,p.itemMap])}return[{Provider:a,Slot:c,ItemSlot:f},m,r]}function Du(t,e=[]){let s=[];function r(i,a){const l=g.createContext(a),c=s.length;s=[...s,a];function d(f){const{scope:m,children:h,...p}=f,y=(m==null?void 0:m[t][c])||l,x=g.useMemo(()=>p,Object.values(p));return o.jsx(y.Provider,{value:x,children:h})}function u(f,m){const h=(m==null?void 0:m[t][c])||l,p=g.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${i}\``)}return d.displayName=i+"Provider",[d,u]}const n=()=>{const i=s.map(a=>g.createContext(a));return function(l){const c=(l==null?void 0:l[t])||i;return g.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return n.scopeName=t,[r,Lu(n,...e)]}function Lu(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const r=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const a=r.reduce((l,{useScope:c,scopeName:d})=>{const f=c(i)[`__scope${d}`];return{...l,...f}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return s.scopeName=e.scopeName,s}var Bu=g.createContext(void 0);function Jo(t){const e=g.useContext(Bu);return t||e||"ltr"}var Qs="rovingFocusGroup.onEntryFocus",Uu={bubbles:!1,cancelable:!0},Rs="RovingFocusGroup",[mr,Ko,Hu]=Mu(Rs),[zu,Yo]=Du(Rs,[Hu]),[qu,Vu]=zu(Rs),Xo=g.forwardRef((t,e)=>o.jsx(mr.Provider,{scope:t.__scopeRovingFocusGroup,children:o.jsx(mr.Slot,{scope:t.__scopeRovingFocusGroup,children:o.jsx(Gu,{...t,ref:e})})}));Xo.displayName=Rs;var Gu=g.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:s,orientation:r,loop:n=!1,dir:i,currentTabStopId:a,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:u=!1,...f}=t,m=g.useRef(null),h=ue(e,m),p=Jo(i),[y=null,x]=bs({prop:a,defaultProp:l,onChange:c}),[b,v]=g.useState(!1),w=eo(d),_=Ko(s),j=g.useRef(!1),[S,C]=g.useState(0);return g.useEffect(()=>{const k=m.current;if(k)return k.addEventListener(Qs,w),()=>k.removeEventListener(Qs,w)},[w]),o.jsx(qu,{scope:s,orientation:r,dir:p,loop:n,currentTabStopId:y,onItemFocus:g.useCallback(k=>x(k),[x]),onItemShiftTab:g.useCallback(()=>v(!0),[]),onFocusableItemAdd:g.useCallback(()=>C(k=>k+1),[]),onFocusableItemRemove:g.useCallback(()=>C(k=>k-1),[]),children:o.jsx(X.div,{tabIndex:b||S===0?-1:0,"data-orientation":r,...f,ref:h,style:{outline:"none",...t.style},onMouseDown:Y(t.onMouseDown,()=>{j.current=!0}),onFocus:Y(t.onFocus,k=>{const N=!j.current;if(k.target===k.currentTarget&&N&&!b){const E=new CustomEvent(Qs,Uu);if(k.currentTarget.dispatchEvent(E),!E.defaultPrevented){const O=_().filter(F=>F.focusable),A=O.find(F=>F.active),z=O.find(F=>F.id===y),W=[A,z,...O].filter(Boolean).map(F=>F.ref.current);ei(W,u)}}j.current=!1}),onBlur:Y(t.onBlur,()=>v(!1))})})}),Qo="RovingFocusGroupItem",Zo=g.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:s,focusable:r=!0,active:n=!1,tabStopId:i,...a}=t,l=Nr(),c=i||l,d=Vu(Qo,s),u=d.currentTabStopId===c,f=Ko(s),{onFocusableItemAdd:m,onFocusableItemRemove:h}=d;return g.useEffect(()=>{if(r)return m(),()=>h()},[r,m,h]),o.jsx(mr.ItemSlot,{scope:s,id:c,focusable:r,active:n,children:o.jsx(X.span,{tabIndex:u?0:-1,"data-orientation":d.orientation,...a,ref:e,onMouseDown:Y(t.onMouseDown,p=>{r?d.onItemFocus(c):p.preventDefault()}),onFocus:Y(t.onFocus,()=>d.onItemFocus(c)),onKeyDown:Y(t.onKeyDown,p=>{if(p.key==="Tab"&&p.shiftKey){d.onItemShiftTab();return}if(p.target!==p.currentTarget)return;const y=Ku(p,d.orientation,d.dir);if(y!==void 0){if(p.metaKey||p.ctrlKey||p.altKey||p.shiftKey)return;p.preventDefault();let b=f().filter(v=>v.focusable).map(v=>v.ref.current);if(y==="last")b.reverse();else if(y==="prev"||y==="next"){y==="prev"&&b.reverse();const v=b.indexOf(p.currentTarget);b=d.loop?Yu(b,v+1):b.slice(v+1)}setTimeout(()=>ei(b))}})})})});Zo.displayName=Qo;var Wu={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ju(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Ku(t,e,s){const r=Ju(t.key,s);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Wu[r]}function ei(t,e=!1){const s=document.activeElement;for(const r of t)if(r===s||(r.focus({preventScroll:e}),document.activeElement!==s))return}function Yu(t,e){return t.map((s,r)=>t[(e+r)%t.length])}var Xu=Xo,Qu=Zo,Fr="Tabs",[Zu,Up]=vs(Fr,[Yo]),ti=Yo(),[eh,Mr]=Zu(Fr),si=g.forwardRef((t,e)=>{const{__scopeTabs:s,value:r,onValueChange:n,defaultValue:i,orientation:a="horizontal",dir:l,activationMode:c="automatic",...d}=t,u=Jo(l),[f,m]=bs({prop:r,onChange:n,defaultProp:i});return o.jsx(eh,{scope:s,baseId:Nr(),value:f,onValueChange:m,orientation:a,dir:u,activationMode:c,children:o.jsx(X.div,{dir:u,"data-orientation":a,...d,ref:e})})});si.displayName=Fr;var ri="TabsList",ni=g.forwardRef((t,e)=>{const{__scopeTabs:s,loop:r=!0,...n}=t,i=Mr(ri,s),a=ti(s);return o.jsx(Xu,{asChild:!0,...a,orientation:i.orientation,dir:i.dir,loop:r,children:o.jsx(X.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:e})})});ni.displayName=ri;var oi="TabsTrigger",ii=g.forwardRef((t,e)=>{const{__scopeTabs:s,value:r,disabled:n=!1,...i}=t,a=Mr(oi,s),l=ti(s),c=ci(a.baseId,r),d=di(a.baseId,r),u=r===a.value;return o.jsx(Qu,{asChild:!0,...l,focusable:!n,active:u,children:o.jsx(X.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":d,"data-state":u?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:c,...i,ref:e,onMouseDown:Y(t.onMouseDown,f=>{!n&&f.button===0&&f.ctrlKey===!1?a.onValueChange(r):f.preventDefault()}),onKeyDown:Y(t.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&a.onValueChange(r)}),onFocus:Y(t.onFocus,()=>{const f=a.activationMode!=="manual";!u&&!n&&f&&a.onValueChange(r)})})})});ii.displayName=oi;var ai="TabsContent",li=g.forwardRef((t,e)=>{const{__scopeTabs:s,value:r,forceMount:n,children:i,...a}=t,l=Mr(ai,s),c=ci(l.baseId,r),d=di(l.baseId,r),u=r===l.value,f=g.useRef(u);return g.useEffect(()=>{const m=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(m)},[]),o.jsx(ws,{present:n||u,children:({present:m})=>o.jsx(X.div,{"data-state":u?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!m,id:d,tabIndex:0,...a,ref:e,style:{...t.style,animationDuration:f.current?"0s":void 0},children:m&&i})})});li.displayName=ai;function ci(t,e){return`${t}-trigger-${e}`}function di(t,e){return`${t}-content-${e}`}var th=si,ui=ni,hi=ii,fi=li;const sh=th,mi=g.forwardRef(({className:t,...e},s)=>o.jsx(ui,{ref:s,className:L("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));mi.displayName=ui.displayName;const as=g.forwardRef(({className:t,...e},s)=>o.jsx(hi,{ref:s,className:L("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...e}));as.displayName=hi.displayName;const ls=g.forwardRef(({className:t,...e},s)=>o.jsx(fi,{ref:s,className:L("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));ls.displayName=fi.displayName;function rh(t){const e=g.useRef({value:t,previous:t});return g.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}function pi(t){const[e,s]=g.useState(void 0);return sr(()=>{if(t){s({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const i=n[0];let a,l;if("borderBoxSize"in i){const c=i.borderBoxSize,d=Array.isArray(c)?c[0]:c;a=d.inlineSize,l=d.blockSize}else a=t.offsetWidth,l=t.offsetHeight;s({width:a,height:l})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else s(void 0)},[t]),e}var Dr="Checkbox",[nh,Hp]=vs(Dr),[oh,ih]=nh(Dr),gi=g.forwardRef((t,e)=>{const{__scopeCheckbox:s,name:r,checked:n,defaultChecked:i,required:a,disabled:l,value:c="on",onCheckedChange:d,form:u,...f}=t,[m,h]=g.useState(null),p=ue(e,_=>h(_)),y=g.useRef(!1),x=m?u||!!m.closest("form"):!0,[b=!1,v]=bs({prop:n,defaultProp:i,onChange:d}),w=g.useRef(b);return g.useEffect(()=>{const _=m==null?void 0:m.form;if(_){const j=()=>v(w.current);return _.addEventListener("reset",j),()=>_.removeEventListener("reset",j)}},[m,v]),o.jsxs(oh,{scope:s,state:b,disabled:l,children:[o.jsx(X.button,{type:"button",role:"checkbox","aria-checked":$e(b)?"mixed":b,"aria-required":a,"data-state":bi(b),"data-disabled":l?"":void 0,disabled:l,value:c,...f,ref:p,onKeyDown:Y(t.onKeyDown,_=>{_.key==="Enter"&&_.preventDefault()}),onClick:Y(t.onClick,_=>{v(j=>$e(j)?!0:!j),x&&(y.current=_.isPropagationStopped(),y.current||_.stopPropagation())})}),x&&o.jsx(ah,{control:m,bubbles:!y.current,name:r,value:c,checked:b,required:a,disabled:l,form:u,style:{transform:"translateX(-100%)"},defaultChecked:$e(i)?!1:i})]})});gi.displayName=Dr;var yi="CheckboxIndicator",xi=g.forwardRef((t,e)=>{const{__scopeCheckbox:s,forceMount:r,...n}=t,i=ih(yi,s);return o.jsx(ws,{present:r||$e(i.state)||i.state===!0,children:o.jsx(X.span,{"data-state":bi(i.state),"data-disabled":i.disabled?"":void 0,...n,ref:e,style:{pointerEvents:"none",...t.style}})})});xi.displayName=yi;var ah=t=>{const{control:e,checked:s,bubbles:r=!0,defaultChecked:n,...i}=t,a=g.useRef(null),l=rh(s),c=pi(e);g.useEffect(()=>{const u=a.current,f=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(f,"checked").set;if(l!==s&&h){const p=new Event("click",{bubbles:r});u.indeterminate=$e(s),h.call(u,$e(s)?!1:s),u.dispatchEvent(p)}},[l,s,r]);const d=g.useRef($e(s)?!1:s);return o.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??d.current,...i,tabIndex:-1,ref:a,style:{...t.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function $e(t){return t==="indeterminate"}function bi(t){return $e(t)?"indeterminate":t?"checked":"unchecked"}var vi=gi,lh=xi;const ne=g.forwardRef(({className:t,...e},s)=>o.jsx(vi,{ref:s,className:L("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...e,children:o.jsx(lh,{className:L("flex items-center justify-center text-current"),children:o.jsx(al,{className:"h-4 w-4"})})}));ne.displayName=vi.displayName;var wi="AlertDialog",[ch,zp]=vs(wi,[to]),Ce=to(),_i=t=>{const{__scopeAlertDialog:e,...s}=t,r=Ce(e);return o.jsx(Qn,{...r,...s,modal:!0})};_i.displayName=wi;var dh="AlertDialogTrigger",ji=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,...r}=t,n=Ce(s);return o.jsx(Zn,{...n,...r,ref:e})});ji.displayName=dh;var uh="AlertDialogPortal",Si=t=>{const{__scopeAlertDialog:e,...s}=t,r=Ce(e);return o.jsx(Xn,{...r,...s})};Si.displayName=uh;var hh="AlertDialogOverlay",Ni=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,...r}=t,n=Ce(s);return o.jsx(vr,{...n,...r,ref:e})});Ni.displayName=hh;var at="AlertDialogContent",[fh,mh]=ch(at),Ci=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,children:r,...n}=t,i=Ce(s),a=g.useRef(null),l=ue(e,a),c=g.useRef(null);return o.jsx(za,{contentName:at,titleName:ki,docsSlug:"alert-dialog",children:o.jsx(fh,{scope:s,cancelRef:c,children:o.jsxs(wr,{role:"alertdialog",...i,...n,ref:l,onOpenAutoFocus:Y(n.onOpenAutoFocus,d=>{var u;d.preventDefault(),(u=c.current)==null||u.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[o.jsx(qa,{children:r}),o.jsx(gh,{contentRef:a})]})})})});Ci.displayName=at;var ki="AlertDialogTitle",Ai=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,...r}=t,n=Ce(s);return o.jsx(jr,{...n,...r,ref:e})});Ai.displayName=ki;var Pi="AlertDialogDescription",Ei=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,...r}=t,n=Ce(s);return o.jsx(Sr,{...n,...r,ref:e})});Ei.displayName=Pi;var ph="AlertDialogAction",Oi=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,...r}=t,n=Ce(s);return o.jsx(_r,{...n,...r,ref:e})});Oi.displayName=ph;var Ti="AlertDialogCancel",Ri=g.forwardRef((t,e)=>{const{__scopeAlertDialog:s,...r}=t,{cancelRef:n}=mh(Ti,s),i=Ce(s),a=ue(e,n);return o.jsx(_r,{...i,...r,ref:a})});Ri.displayName=Ti;var gh=({contentRef:t})=>{const e=`\`${at}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${at}\` by passing a \`${Pi}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${at}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return g.useEffect(()=>{var r;document.getElementById((r=t.current)==null?void 0:r.getAttribute("aria-describedby"))||console.warn(e)},[e,t]),null},yh=_i,xh=ji,bh=Si,Ii=Ni,$i=Ci,Fi=Oi,Mi=Ri,Di=Ai,Li=Ei;const Bi=yh,Ui=xh,vh=bh,Hi=g.forwardRef(({className:t,...e},s)=>o.jsx(Ii,{className:L("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:s}));Hi.displayName=Ii.displayName;const Lr=g.forwardRef(({className:t,...e},s)=>o.jsxs(vh,{children:[o.jsx(Hi,{}),o.jsx($i,{ref:s,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...e})]}));Lr.displayName=$i.displayName;const Br=({className:t,...e})=>o.jsx("div",{className:L("flex flex-col space-y-2 text-center sm:text-left",t),...e});Br.displayName="AlertDialogHeader";const Ur=({className:t,...e})=>o.jsx("div",{className:L("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});Ur.displayName="AlertDialogFooter";const Hr=g.forwardRef(({className:t,...e},s)=>o.jsx(Di,{ref:s,className:L("text-lg font-semibold",t),...e}));Hr.displayName=Di.displayName;const zr=g.forwardRef(({className:t,...e},s)=>o.jsx(Li,{ref:s,className:L("text-sm text-muted-foreground",t),...e}));zr.displayName=Li.displayName;const qr=g.forwardRef(({className:t,...e},s)=>o.jsx(Fi,{ref:s,className:L(Er(),t),...e}));qr.displayName=Fi.displayName;const Vr=g.forwardRef(({className:t,...e},s)=>o.jsx(Mi,{ref:s,className:L(Er({variant:"outline"}),"mt-2 sm:mt-0",t),...e}));Vr.displayName=Mi.displayName;const wh=({totalDrafts:t,selectedCount:e,isSelectAll:s,onToggleSelectAll:r,onBulkDelete:n,isBulkDeleting:i,onClearSelection:a})=>t===0?null:o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(ne,{id:"select-all",checked:s||e===t,onCheckedChange:r,className:"h-4 w-4"}),o.jsxs("label",{htmlFor:"select-all",className:"text-sm font-medium text-gray-700 cursor-pointer",children:["Select All (",t,")"]}),e>0&&o.jsxs("span",{className:"text-sm text-gray-500",children:[e," selected"]})]}),e>0&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(D,{variant:"outline",size:"sm",onClick:a,disabled:i,children:"Clear Selection"}),o.jsxs(Bi,{children:[o.jsx(Ui,{asChild:!0,children:o.jsxs(D,{variant:"destructive",size:"sm",disabled:i,className:"flex items-center space-x-1",children:[o.jsx(Ar,{className:"w-4 h-4"}),o.jsxs("span",{children:["Delete ",e," Selected"]})]})}),o.jsxs(Lr,{children:[o.jsxs(Br,{children:[o.jsx(Hr,{children:"Delete Selected Drafts"}),o.jsxs(zr,{children:["Are you sure you want to delete ",e," selected draft",e!==1?"s":"","? This action cannot be undone."]})]}),o.jsxs(Ur,{children:[o.jsx(Vr,{children:"Cancel"}),o.jsx(qr,{onClick:n,className:"bg-red-600 hover:bg-red-700",children:i?"Deleting...":"Delete Selected"})]})]})]})]})]}),ut={PTA:{code:"PTA",name:"Pretoria",doctor:"Dr Vorster",practiceNumber:"1227831"},JHB:{code:"JHB",name:"Johannesburg",doctor:"Dr Essop",practiceNumber:"1182609"},CPT:{code:"CPT",name:"Cape Town",doctor:"Dr Soni",practiceNumber:"1030817"}},_h=async()=>ut.PTA,jh=["top","right","bottom","left"],Fe=Math.min,te=Math.max,ms=Math.round,ss=Math.floor,Me=t=>({x:t,y:t}),Sh={left:"right",right:"left",bottom:"top",top:"bottom"},Nh={start:"end",end:"start"};function pr(t,e,s){return te(t,Fe(e,s))}function Se(t,e){return typeof t=="function"?t(e):t}function Ne(t){return t.split("-")[0]}function wt(t){return t.split("-")[1]}function Gr(t){return t==="x"?"y":"x"}function Wr(t){return t==="y"?"height":"width"}function De(t){return["top","bottom"].includes(Ne(t))?"y":"x"}function Jr(t){return Gr(De(t))}function Ch(t,e,s){s===void 0&&(s=!1);const r=wt(t),n=Jr(t),i=Wr(n);let a=n==="x"?r===(s?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(a=ps(a)),[a,ps(a)]}function kh(t){const e=ps(t);return[gr(t),e,gr(e)]}function gr(t){return t.replace(/start|end/g,e=>Nh[e])}function Ah(t,e,s){const r=["left","right"],n=["right","left"],i=["top","bottom"],a=["bottom","top"];switch(t){case"top":case"bottom":return s?e?n:r:e?r:n;case"left":case"right":return e?i:a;default:return[]}}function Ph(t,e,s,r){const n=wt(t);let i=Ah(Ne(t),s==="start",r);return n&&(i=i.map(a=>a+"-"+n),e&&(i=i.concat(i.map(gr)))),i}function ps(t){return t.replace(/left|right|bottom|top/g,e=>Sh[e])}function Eh(t){return{top:0,right:0,bottom:0,left:0,...t}}function zi(t){return typeof t!="number"?Eh(t):{top:t,right:t,bottom:t,left:t}}function gs(t){const{x:e,y:s,width:r,height:n}=t;return{width:r,height:n,top:s,left:e,right:e+r,bottom:s+n,x:e,y:s}}function Fn(t,e,s){let{reference:r,floating:n}=t;const i=De(e),a=Jr(e),l=Wr(a),c=Ne(e),d=i==="y",u=r.x+r.width/2-n.width/2,f=r.y+r.height/2-n.height/2,m=r[l]/2-n[l]/2;let h;switch(c){case"top":h={x:u,y:r.y-n.height};break;case"bottom":h={x:u,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:f};break;case"left":h={x:r.x-n.width,y:f};break;default:h={x:r.x,y:r.y}}switch(wt(e)){case"start":h[a]-=m*(s&&d?-1:1);break;case"end":h[a]+=m*(s&&d?-1:1);break}return h}const Oh=async(t,e,s)=>{const{placement:r="bottom",strategy:n="absolute",middleware:i=[],platform:a}=s,l=i.filter(Boolean),c=await(a.isRTL==null?void 0:a.isRTL(e));let d=await a.getElementRects({reference:t,floating:e,strategy:n}),{x:u,y:f}=Fn(d,r,c),m=r,h={},p=0;for(let y=0;y<l.length;y++){const{name:x,fn:b}=l[y],{x:v,y:w,data:_,reset:j}=await b({x:u,y:f,initialPlacement:r,placement:m,strategy:n,middlewareData:h,rects:d,platform:a,elements:{reference:t,floating:e}});u=v??u,f=w??f,h={...h,[x]:{...h[x],..._}},j&&p<=50&&(p++,typeof j=="object"&&(j.placement&&(m=j.placement),j.rects&&(d=j.rects===!0?await a.getElementRects({reference:t,floating:e,strategy:n}):j.rects),{x:u,y:f}=Fn(d,m,c)),y=-1)}return{x:u,y:f,placement:m,strategy:n,middlewareData:h}};async function Ft(t,e){var s;e===void 0&&(e={});const{x:r,y:n,platform:i,rects:a,elements:l,strategy:c}=t,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:m=!1,padding:h=0}=Se(e,t),p=zi(h),x=l[m?f==="floating"?"reference":"floating":f],b=gs(await i.getClippingRect({element:(s=await(i.isElement==null?void 0:i.isElement(x)))==null||s?x:x.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(l.floating)),boundary:d,rootBoundary:u,strategy:c})),v=f==="floating"?{x:r,y:n,width:a.floating.width,height:a.floating.height}:a.reference,w=await(i.getOffsetParent==null?void 0:i.getOffsetParent(l.floating)),_=await(i.isElement==null?void 0:i.isElement(w))?await(i.getScale==null?void 0:i.getScale(w))||{x:1,y:1}:{x:1,y:1},j=gs(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:v,offsetParent:w,strategy:c}):v);return{top:(b.top-j.top+p.top)/_.y,bottom:(j.bottom-b.bottom+p.bottom)/_.y,left:(b.left-j.left+p.left)/_.x,right:(j.right-b.right+p.right)/_.x}}const Th=t=>({name:"arrow",options:t,async fn(e){const{x:s,y:r,placement:n,rects:i,platform:a,elements:l,middlewareData:c}=e,{element:d,padding:u=0}=Se(t,e)||{};if(d==null)return{};const f=zi(u),m={x:s,y:r},h=Jr(n),p=Wr(h),y=await a.getDimensions(d),x=h==="y",b=x?"top":"left",v=x?"bottom":"right",w=x?"clientHeight":"clientWidth",_=i.reference[p]+i.reference[h]-m[h]-i.floating[p],j=m[h]-i.reference[h],S=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d));let C=S?S[w]:0;(!C||!await(a.isElement==null?void 0:a.isElement(S)))&&(C=l.floating[w]||i.floating[p]);const k=_/2-j/2,N=C/2-y[p]/2-1,E=Fe(f[b],N),O=Fe(f[v],N),A=E,z=C-y[p]-O,B=C/2-y[p]/2+k,W=pr(A,B,z),F=!c.arrow&&wt(n)!=null&&B!==W&&i.reference[p]/2-(B<A?E:O)-y[p]/2<0,T=F?B<A?B-A:B-z:0;return{[h]:m[h]+T,data:{[h]:W,centerOffset:B-W-T,...F&&{alignmentOffset:T}},reset:F}}}),Rh=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var s,r;const{placement:n,middlewareData:i,rects:a,initialPlacement:l,platform:c,elements:d}=e,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:m,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:y=!0,...x}=Se(t,e);if((s=i.arrow)!=null&&s.alignmentOffset)return{};const b=Ne(n),v=De(l),w=Ne(l)===l,_=await(c.isRTL==null?void 0:c.isRTL(d.floating)),j=m||(w||!y?[ps(l)]:kh(l)),S=p!=="none";!m&&S&&j.push(...Ph(l,y,p,_));const C=[l,...j],k=await Ft(e,x),N=[];let E=((r=i.flip)==null?void 0:r.overflows)||[];if(u&&N.push(k[b]),f){const B=Ch(n,a,_);N.push(k[B[0]],k[B[1]])}if(E=[...E,{placement:n,overflows:N}],!N.every(B=>B<=0)){var O,A;const B=(((O=i.flip)==null?void 0:O.index)||0)+1,W=C[B];if(W)return{data:{index:B,overflows:E},reset:{placement:W}};let F=(A=E.filter(T=>T.overflows[0]<=0).sort((T,P)=>T.overflows[1]-P.overflows[1])[0])==null?void 0:A.placement;if(!F)switch(h){case"bestFit":{var z;const T=(z=E.filter(P=>{if(S){const U=De(P.placement);return U===v||U==="y"}return!0}).map(P=>[P.placement,P.overflows.filter(U=>U>0).reduce((U,K)=>U+K,0)]).sort((P,U)=>P[1]-U[1])[0])==null?void 0:z[0];T&&(F=T);break}case"initialPlacement":F=l;break}if(n!==F)return{reset:{placement:F}}}return{}}}};function Mn(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Dn(t){return jh.some(e=>t[e]>=0)}const Ih=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:s}=e,{strategy:r="referenceHidden",...n}=Se(t,e);switch(r){case"referenceHidden":{const i=await Ft(e,{...n,elementContext:"reference"}),a=Mn(i,s.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:Dn(a)}}}case"escaped":{const i=await Ft(e,{...n,altBoundary:!0}),a=Mn(i,s.floating);return{data:{escapedOffsets:a,escaped:Dn(a)}}}default:return{}}}}};async function $h(t,e){const{placement:s,platform:r,elements:n}=t,i=await(r.isRTL==null?void 0:r.isRTL(n.floating)),a=Ne(s),l=wt(s),c=De(s)==="y",d=["left","top"].includes(a)?-1:1,u=i&&c?-1:1,f=Se(e,t);let{mainAxis:m,crossAxis:h,alignmentAxis:p}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return l&&typeof p=="number"&&(h=l==="end"?p*-1:p),c?{x:h*u,y:m*d}:{x:m*d,y:h*u}}const Fh=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var s,r;const{x:n,y:i,placement:a,middlewareData:l}=e,c=await $h(e,t);return a===((s=l.offset)==null?void 0:s.placement)&&(r=l.arrow)!=null&&r.alignmentOffset?{}:{x:n+c.x,y:i+c.y,data:{...c,placement:a}}}}},Mh=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:s,y:r,placement:n}=e,{mainAxis:i=!0,crossAxis:a=!1,limiter:l={fn:x=>{let{x:b,y:v}=x;return{x:b,y:v}}},...c}=Se(t,e),d={x:s,y:r},u=await Ft(e,c),f=De(Ne(n)),m=Gr(f);let h=d[m],p=d[f];if(i){const x=m==="y"?"top":"left",b=m==="y"?"bottom":"right",v=h+u[x],w=h-u[b];h=pr(v,h,w)}if(a){const x=f==="y"?"top":"left",b=f==="y"?"bottom":"right",v=p+u[x],w=p-u[b];p=pr(v,p,w)}const y=l.fn({...e,[m]:h,[f]:p});return{...y,data:{x:y.x-s,y:y.y-r,enabled:{[m]:i,[f]:a}}}}}},Dh=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:s,y:r,placement:n,rects:i,middlewareData:a}=e,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=Se(t,e),u={x:s,y:r},f=De(n),m=Gr(f);let h=u[m],p=u[f];const y=Se(l,e),x=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(c){const w=m==="y"?"height":"width",_=i.reference[m]-i.floating[w]+x.mainAxis,j=i.reference[m]+i.reference[w]-x.mainAxis;h<_?h=_:h>j&&(h=j)}if(d){var b,v;const w=m==="y"?"width":"height",_=["top","left"].includes(Ne(n)),j=i.reference[f]-i.floating[w]+(_&&((b=a.offset)==null?void 0:b[f])||0)+(_?0:x.crossAxis),S=i.reference[f]+i.reference[w]+(_?0:((v=a.offset)==null?void 0:v[f])||0)-(_?x.crossAxis:0);p<j?p=j:p>S&&(p=S)}return{[m]:h,[f]:p}}}},Lh=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var s,r;const{placement:n,rects:i,platform:a,elements:l}=e,{apply:c=()=>{},...d}=Se(t,e),u=await Ft(e,d),f=Ne(n),m=wt(n),h=De(n)==="y",{width:p,height:y}=i.floating;let x,b;f==="top"||f==="bottom"?(x=f,b=m===(await(a.isRTL==null?void 0:a.isRTL(l.floating))?"start":"end")?"left":"right"):(b=f,x=m==="end"?"top":"bottom");const v=y-u.top-u.bottom,w=p-u.left-u.right,_=Fe(y-u[x],v),j=Fe(p-u[b],w),S=!e.middlewareData.shift;let C=_,k=j;if((s=e.middlewareData.shift)!=null&&s.enabled.x&&(k=w),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(C=v),S&&!m){const E=te(u.left,0),O=te(u.right,0),A=te(u.top,0),z=te(u.bottom,0);h?k=p-2*(E!==0||O!==0?E+O:te(u.left,u.right)):C=y-2*(A!==0||z!==0?A+z:te(u.top,u.bottom))}await c({...e,availableWidth:k,availableHeight:C});const N=await a.getDimensions(l.floating);return p!==N.width||y!==N.height?{reset:{rects:!0}}:{}}}};function Is(){return typeof window<"u"}function _t(t){return qi(t)?(t.nodeName||"").toLowerCase():"#document"}function se(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function pe(t){var e;return(e=(qi(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function qi(t){return Is()?t instanceof Node||t instanceof se(t).Node:!1}function ae(t){return Is()?t instanceof Element||t instanceof se(t).Element:!1}function me(t){return Is()?t instanceof HTMLElement||t instanceof se(t).HTMLElement:!1}function Ln(t){return!Is()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof se(t).ShadowRoot}function Wt(t){const{overflow:e,overflowX:s,overflowY:r,display:n}=le(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+s)&&!["inline","contents"].includes(n)}function Bh(t){return["table","td","th"].includes(_t(t))}function $s(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Kr(t){const e=Yr(),s=ae(t)?le(t):t;return s.transform!=="none"||s.perspective!=="none"||(s.containerType?s.containerType!=="normal":!1)||!e&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!e&&(s.filter?s.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(s.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(s.contain||"").includes(r))}function Uh(t){let e=Le(t);for(;me(e)&&!ht(e);){if(Kr(e))return e;if($s(e))return null;e=Le(e)}return null}function Yr(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ht(t){return["html","body","#document"].includes(_t(t))}function le(t){return se(t).getComputedStyle(t)}function Fs(t){return ae(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Le(t){if(_t(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Ln(t)&&t.host||pe(t);return Ln(e)?e.host:e}function Vi(t){const e=Le(t);return ht(e)?t.ownerDocument?t.ownerDocument.body:t.body:me(e)&&Wt(e)?e:Vi(e)}function Mt(t,e,s){var r;e===void 0&&(e=[]),s===void 0&&(s=!0);const n=Vi(t),i=n===((r=t.ownerDocument)==null?void 0:r.body),a=se(n);if(i){const l=yr(a);return e.concat(a,a.visualViewport||[],Wt(n)?n:[],l&&s?Mt(l):[])}return e.concat(n,Mt(n,[],s))}function yr(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Gi(t){const e=le(t);let s=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const n=me(t),i=n?t.offsetWidth:s,a=n?t.offsetHeight:r,l=ms(s)!==i||ms(r)!==a;return l&&(s=i,r=a),{width:s,height:r,$:l}}function Xr(t){return ae(t)?t:t.contextElement}function lt(t){const e=Xr(t);if(!me(e))return Me(1);const s=e.getBoundingClientRect(),{width:r,height:n,$:i}=Gi(e);let a=(i?ms(s.width):s.width)/r,l=(i?ms(s.height):s.height)/n;return(!a||!Number.isFinite(a))&&(a=1),(!l||!Number.isFinite(l))&&(l=1),{x:a,y:l}}const Hh=Me(0);function Wi(t){const e=se(t);return!Yr()||!e.visualViewport?Hh:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function zh(t,e,s){return e===void 0&&(e=!1),!s||e&&s!==se(t)?!1:e}function Xe(t,e,s,r){e===void 0&&(e=!1),s===void 0&&(s=!1);const n=t.getBoundingClientRect(),i=Xr(t);let a=Me(1);e&&(r?ae(r)&&(a=lt(r)):a=lt(t));const l=zh(i,s,r)?Wi(i):Me(0);let c=(n.left+l.x)/a.x,d=(n.top+l.y)/a.y,u=n.width/a.x,f=n.height/a.y;if(i){const m=se(i),h=r&&ae(r)?se(r):r;let p=m,y=yr(p);for(;y&&r&&h!==p;){const x=lt(y),b=y.getBoundingClientRect(),v=le(y),w=b.left+(y.clientLeft+parseFloat(v.paddingLeft))*x.x,_=b.top+(y.clientTop+parseFloat(v.paddingTop))*x.y;c*=x.x,d*=x.y,u*=x.x,f*=x.y,c+=w,d+=_,p=se(y),y=yr(p)}}return gs({width:u,height:f,x:c,y:d})}function qh(t){let{elements:e,rect:s,offsetParent:r,strategy:n}=t;const i=n==="fixed",a=pe(r),l=e?$s(e.floating):!1;if(r===a||l&&i)return s;let c={scrollLeft:0,scrollTop:0},d=Me(1);const u=Me(0),f=me(r);if((f||!f&&!i)&&((_t(r)!=="body"||Wt(a))&&(c=Fs(r)),me(r))){const m=Xe(r);d=lt(r),u.x=m.x+r.clientLeft,u.y=m.y+r.clientTop}return{width:s.width*d.x,height:s.height*d.y,x:s.x*d.x-c.scrollLeft*d.x+u.x,y:s.y*d.y-c.scrollTop*d.y+u.y}}function Vh(t){return Array.from(t.getClientRects())}function xr(t,e){const s=Fs(t).scrollLeft;return e?e.left+s:Xe(pe(t)).left+s}function Gh(t){const e=pe(t),s=Fs(t),r=t.ownerDocument.body,n=te(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),i=te(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-s.scrollLeft+xr(t);const l=-s.scrollTop;return le(r).direction==="rtl"&&(a+=te(e.clientWidth,r.clientWidth)-n),{width:n,height:i,x:a,y:l}}function Wh(t,e){const s=se(t),r=pe(t),n=s.visualViewport;let i=r.clientWidth,a=r.clientHeight,l=0,c=0;if(n){i=n.width,a=n.height;const d=Yr();(!d||d&&e==="fixed")&&(l=n.offsetLeft,c=n.offsetTop)}return{width:i,height:a,x:l,y:c}}function Jh(t,e){const s=Xe(t,!0,e==="fixed"),r=s.top+t.clientTop,n=s.left+t.clientLeft,i=me(t)?lt(t):Me(1),a=t.clientWidth*i.x,l=t.clientHeight*i.y,c=n*i.x,d=r*i.y;return{width:a,height:l,x:c,y:d}}function Bn(t,e,s){let r;if(e==="viewport")r=Wh(t,s);else if(e==="document")r=Gh(pe(t));else if(ae(e))r=Jh(e,s);else{const n=Wi(t);r={...e,x:e.x-n.x,y:e.y-n.y}}return gs(r)}function Ji(t,e){const s=Le(t);return s===e||!ae(s)||ht(s)?!1:le(s).position==="fixed"||Ji(s,e)}function Kh(t,e){const s=e.get(t);if(s)return s;let r=Mt(t,[],!1).filter(l=>ae(l)&&_t(l)!=="body"),n=null;const i=le(t).position==="fixed";let a=i?Le(t):t;for(;ae(a)&&!ht(a);){const l=le(a),c=Kr(a);!c&&l.position==="fixed"&&(n=null),(i?!c&&!n:!c&&l.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||Wt(a)&&!c&&Ji(t,a))?r=r.filter(u=>u!==a):n=l,a=Le(a)}return e.set(t,r),r}function Yh(t){let{element:e,boundary:s,rootBoundary:r,strategy:n}=t;const a=[...s==="clippingAncestors"?$s(e)?[]:Kh(e,this._c):[].concat(s),r],l=a[0],c=a.reduce((d,u)=>{const f=Bn(e,u,n);return d.top=te(f.top,d.top),d.right=Fe(f.right,d.right),d.bottom=Fe(f.bottom,d.bottom),d.left=te(f.left,d.left),d},Bn(e,l,n));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Xh(t){const{width:e,height:s}=Gi(t);return{width:e,height:s}}function Qh(t,e,s){const r=me(e),n=pe(e),i=s==="fixed",a=Xe(t,!0,i,e);let l={scrollLeft:0,scrollTop:0};const c=Me(0);if(r||!r&&!i)if((_t(e)!=="body"||Wt(n))&&(l=Fs(e)),r){const h=Xe(e,!0,i,e);c.x=h.x+e.clientLeft,c.y=h.y+e.clientTop}else n&&(c.x=xr(n));let d=0,u=0;if(n&&!r&&!i){const h=n.getBoundingClientRect();u=h.top+l.scrollTop,d=h.left+l.scrollLeft-xr(n,h)}const f=a.left+l.scrollLeft-c.x-d,m=a.top+l.scrollTop-c.y-u;return{x:f,y:m,width:a.width,height:a.height}}function Zs(t){return le(t).position==="static"}function Un(t,e){if(!me(t)||le(t).position==="fixed")return null;if(e)return e(t);let s=t.offsetParent;return pe(t)===s&&(s=s.ownerDocument.body),s}function Ki(t,e){const s=se(t);if($s(t))return s;if(!me(t)){let n=Le(t);for(;n&&!ht(n);){if(ae(n)&&!Zs(n))return n;n=Le(n)}return s}let r=Un(t,e);for(;r&&Bh(r)&&Zs(r);)r=Un(r,e);return r&&ht(r)&&Zs(r)&&!Kr(r)?s:r||Uh(t)||s}const Zh=async function(t){const e=this.getOffsetParent||Ki,s=this.getDimensions,r=await s(t.floating);return{reference:Qh(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function ef(t){return le(t).direction==="rtl"}const tf={convertOffsetParentRelativeRectToViewportRelativeRect:qh,getDocumentElement:pe,getClippingRect:Yh,getOffsetParent:Ki,getElementRects:Zh,getClientRects:Vh,getDimensions:Xh,getScale:lt,isElement:ae,isRTL:ef};function sf(t,e){let s=null,r;const n=pe(t);function i(){var l;clearTimeout(r),(l=s)==null||l.disconnect(),s=null}function a(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),i();const{left:d,top:u,width:f,height:m}=t.getBoundingClientRect();if(l||e(),!f||!m)return;const h=ss(u),p=ss(n.clientWidth-(d+f)),y=ss(n.clientHeight-(u+m)),x=ss(d),v={rootMargin:-h+"px "+-p+"px "+-y+"px "+-x+"px",threshold:te(0,Fe(1,c))||1};let w=!0;function _(j){const S=j[0].intersectionRatio;if(S!==c){if(!w)return a();S?a(!1,S):r=setTimeout(()=>{a(!1,1e-7)},1e3)}w=!1}try{s=new IntersectionObserver(_,{...v,root:n.ownerDocument})}catch{s=new IntersectionObserver(_,v)}s.observe(t)}return a(!0),i}function rf(t,e,s,r){r===void 0&&(r={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,d=Xr(t),u=n||i?[...d?Mt(d):[],...Mt(e)]:[];u.forEach(b=>{n&&b.addEventListener("scroll",s,{passive:!0}),i&&b.addEventListener("resize",s)});const f=d&&l?sf(d,s):null;let m=-1,h=null;a&&(h=new ResizeObserver(b=>{let[v]=b;v&&v.target===d&&h&&(h.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var w;(w=h)==null||w.observe(e)})),s()}),d&&!c&&h.observe(d),h.observe(e));let p,y=c?Xe(t):null;c&&x();function x(){const b=Xe(t);y&&(b.x!==y.x||b.y!==y.y||b.width!==y.width||b.height!==y.height)&&s(),y=b,p=requestAnimationFrame(x)}return s(),()=>{var b;u.forEach(v=>{n&&v.removeEventListener("scroll",s),i&&v.removeEventListener("resize",s)}),f==null||f(),(b=h)==null||b.disconnect(),h=null,c&&cancelAnimationFrame(p)}}const nf=Fh,of=Mh,af=Rh,lf=Lh,cf=Ih,Hn=Th,df=Dh,uf=(t,e,s)=>{const r=new Map,n={platform:tf,...s},i={...n.platform,_c:r};return Oh(t,e,{...n,platform:i})};var cs=typeof document<"u"?g.useLayoutEffect:g.useEffect;function ys(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let s,r,n;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(s=t.length,s!==e.length)return!1;for(r=s;r--!==0;)if(!ys(t[r],e[r]))return!1;return!0}if(n=Object.keys(t),s=n.length,s!==Object.keys(e).length)return!1;for(r=s;r--!==0;)if(!{}.hasOwnProperty.call(e,n[r]))return!1;for(r=s;r--!==0;){const i=n[r];if(!(i==="_owner"&&t.$$typeof)&&!ys(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function Yi(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function zn(t,e){const s=Yi(t);return Math.round(e*s)/s}function er(t){const e=g.useRef(t);return cs(()=>{e.current=t}),e}function hf(t){t===void 0&&(t={});const{placement:e="bottom",strategy:s="absolute",middleware:r=[],platform:n,elements:{reference:i,floating:a}={},transform:l=!0,whileElementsMounted:c,open:d}=t,[u,f]=g.useState({x:0,y:0,strategy:s,placement:e,middlewareData:{},isPositioned:!1}),[m,h]=g.useState(r);ys(m,r)||h(r);const[p,y]=g.useState(null),[x,b]=g.useState(null),v=g.useCallback(P=>{P!==S.current&&(S.current=P,y(P))},[]),w=g.useCallback(P=>{P!==C.current&&(C.current=P,b(P))},[]),_=i||p,j=a||x,S=g.useRef(null),C=g.useRef(null),k=g.useRef(u),N=c!=null,E=er(c),O=er(n),A=er(d),z=g.useCallback(()=>{if(!S.current||!C.current)return;const P={placement:e,strategy:s,middleware:m};O.current&&(P.platform=O.current),uf(S.current,C.current,P).then(U=>{const K={...U,isPositioned:A.current!==!1};B.current&&!ys(k.current,K)&&(k.current=K,so.flushSync(()=>{f(K)}))})},[m,e,s,O,A]);cs(()=>{d===!1&&k.current.isPositioned&&(k.current.isPositioned=!1,f(P=>({...P,isPositioned:!1})))},[d]);const B=g.useRef(!1);cs(()=>(B.current=!0,()=>{B.current=!1}),[]),cs(()=>{if(_&&(S.current=_),j&&(C.current=j),_&&j){if(E.current)return E.current(_,j,z);z()}},[_,j,z,E,N]);const W=g.useMemo(()=>({reference:S,floating:C,setReference:v,setFloating:w}),[v,w]),F=g.useMemo(()=>({reference:_,floating:j}),[_,j]),T=g.useMemo(()=>{const P={position:s,left:0,top:0};if(!F.floating)return P;const U=zn(F.floating,u.x),K=zn(F.floating,u.y);return l?{...P,transform:"translate("+U+"px, "+K+"px)",...Yi(F.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:U,top:K}},[s,l,F.floating,u.x,u.y]);return g.useMemo(()=>({...u,update:z,refs:W,elements:F,floatingStyles:T}),[u,z,W,F,T])}const ff=t=>{function e(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:t,fn(s){const{element:r,padding:n}=typeof t=="function"?t(s):t;return r&&e(r)?r.current!=null?Hn({element:r.current,padding:n}).fn(s):{}:r?Hn({element:r,padding:n}).fn(s):{}}}},mf=(t,e)=>({...nf(t),options:[t,e]}),pf=(t,e)=>({...of(t),options:[t,e]}),gf=(t,e)=>({...df(t),options:[t,e]}),yf=(t,e)=>({...af(t),options:[t,e]}),xf=(t,e)=>({...lf(t),options:[t,e]}),bf=(t,e)=>({...cf(t),options:[t,e]}),vf=(t,e)=>({...ff(t),options:[t,e]});var wf="Arrow",Xi=g.forwardRef((t,e)=>{const{children:s,width:r=10,height:n=5,...i}=t;return o.jsx(X.svg,{...i,ref:e,width:r,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?s:o.jsx("polygon",{points:"0,0 30,0 15,10"})})});Xi.displayName=wf;var _f=Xi;function jf(t,e=[]){let s=[];function r(i,a){const l=g.createContext(a),c=s.length;s=[...s,a];function d(f){const{scope:m,children:h,...p}=f,y=(m==null?void 0:m[t][c])||l,x=g.useMemo(()=>p,Object.values(p));return o.jsx(y.Provider,{value:x,children:h})}function u(f,m){const h=(m==null?void 0:m[t][c])||l,p=g.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${i}\``)}return d.displayName=i+"Provider",[d,u]}const n=()=>{const i=s.map(a=>g.createContext(a));return function(l){const c=(l==null?void 0:l[t])||i;return g.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return n.scopeName=t,[r,Sf(n,...e)]}function Sf(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const r=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const a=r.reduce((l,{useScope:c,scopeName:d})=>{const f=c(i)[`__scope${d}`];return{...l,...f}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return s.scopeName=e.scopeName,s}var Qr="Popper",[Qi,Zi]=jf(Qr),[Nf,ea]=Qi(Qr),ta=t=>{const{__scopePopper:e,children:s}=t,[r,n]=g.useState(null);return o.jsx(Nf,{scope:e,anchor:r,onAnchorChange:n,children:s})};ta.displayName=Qr;var sa="PopperAnchor",ra=g.forwardRef((t,e)=>{const{__scopePopper:s,virtualRef:r,...n}=t,i=ea(sa,s),a=g.useRef(null),l=ue(e,a);return g.useEffect(()=>{i.onAnchorChange((r==null?void 0:r.current)||a.current)}),r?null:o.jsx(X.div,{...n,ref:l})});ra.displayName=sa;var Zr="PopperContent",[Cf,kf]=Qi(Zr),na=g.forwardRef((t,e)=>{var Kt,ge,Yt,on,an,ln;const{__scopePopper:s,side:r="bottom",sideOffset:n=0,align:i="center",alignOffset:a=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:u=0,sticky:f="partial",hideWhenDetached:m=!1,updatePositionStrategy:h="optimized",onPlaced:p,...y}=t,x=ea(Zr,s),[b,v]=g.useState(null),w=ue(e,jt=>v(jt)),[_,j]=g.useState(null),S=pi(_),C=(S==null?void 0:S.width)??0,k=(S==null?void 0:S.height)??0,N=r+(i!=="center"?"-"+i:""),E=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},O=Array.isArray(d)?d:[d],A=O.length>0,z={padding:E,boundary:O.filter(Pf),altBoundary:A},{refs:B,floatingStyles:W,placement:F,isPositioned:T,middlewareData:P}=hf({strategy:"fixed",placement:N,whileElementsMounted:(...jt)=>rf(...jt,{animationFrame:h==="always"}),elements:{reference:x.anchor},middleware:[mf({mainAxis:n+k,alignmentAxis:a}),c&&pf({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?gf():void 0,...z}),c&&yf({...z}),xf({...z,apply:({elements:jt,rects:cn,availableWidth:Ma,availableHeight:Da})=>{const{width:La,height:Ba}=cn.reference,Xt=jt.floating.style;Xt.setProperty("--radix-popper-available-width",`${Ma}px`),Xt.setProperty("--radix-popper-available-height",`${Da}px`),Xt.setProperty("--radix-popper-anchor-width",`${La}px`),Xt.setProperty("--radix-popper-anchor-height",`${Ba}px`)}}),_&&vf({element:_,padding:l}),Ef({arrowWidth:C,arrowHeight:k}),m&&bf({strategy:"referenceHidden",...z})]}),[U,K]=aa(F),G=eo(p);sr(()=>{T&&(G==null||G())},[T,G]);const Ze=(Kt=P.arrow)==null?void 0:Kt.x,Ls=(ge=P.arrow)==null?void 0:ge.y,Bs=((Yt=P.arrow)==null?void 0:Yt.centerOffset)!==0,[Us,Hs]=g.useState();return sr(()=>{b&&Hs(window.getComputedStyle(b).zIndex)},[b]),o.jsx("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:{...W,transform:T?W.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Us,"--radix-popper-transform-origin":[(on=P.transformOrigin)==null?void 0:on.x,(an=P.transformOrigin)==null?void 0:an.y].join(" "),...((ln=P.hide)==null?void 0:ln.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:o.jsx(Cf,{scope:s,placedSide:U,onArrowChange:j,arrowX:Ze,arrowY:Ls,shouldHideArrow:Bs,children:o.jsx(X.div,{"data-side":U,"data-align":K,...y,ref:w,style:{...y.style,animation:T?void 0:"none"}})})})});na.displayName=Zr;var oa="PopperArrow",Af={top:"bottom",right:"left",bottom:"top",left:"right"},ia=g.forwardRef(function(e,s){const{__scopePopper:r,...n}=e,i=kf(oa,r),a=Af[i.placedSide];return o.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:o.jsx(_f,{...n,ref:s,style:{...n.style,display:"block"}})})});ia.displayName=oa;function Pf(t){return t!==null}var Ef=t=>({name:"transformOrigin",options:t,fn(e){var x,b,v;const{placement:s,rects:r,middlewareData:n}=e,a=((x=n.arrow)==null?void 0:x.centerOffset)!==0,l=a?0:t.arrowWidth,c=a?0:t.arrowHeight,[d,u]=aa(s),f={start:"0%",center:"50%",end:"100%"}[u],m=(((b=n.arrow)==null?void 0:b.x)??0)+l/2,h=(((v=n.arrow)==null?void 0:v.y)??0)+c/2;let p="",y="";return d==="bottom"?(p=a?f:`${m}px`,y=`${-c}px`):d==="top"?(p=a?f:`${m}px`,y=`${r.floating.height+c}px`):d==="right"?(p=`${-c}px`,y=a?f:`${h}px`):d==="left"&&(p=`${r.floating.width+c}px`,y=a?f:`${h}px`),{data:{x:p,y}}}});function aa(t){const[e,s="center"]=t.split("-");return[e,s]}var Of=ta,la=ra,Tf=na,Rf=ia,en="Popover",[ca,qp]=vs(en,[Zi]),Jt=Zi(),[If,ze]=ca(en),da=t=>{const{__scopePopover:e,children:s,open:r,defaultOpen:n,onOpenChange:i,modal:a=!1}=t,l=Jt(e),c=g.useRef(null),[d,u]=g.useState(!1),[f=!1,m]=bs({prop:r,defaultProp:n,onChange:i});return o.jsx(Of,{...l,children:o.jsx(If,{scope:e,contentId:Nr(),triggerRef:c,open:f,onOpenChange:m,onOpenToggle:g.useCallback(()=>m(h=>!h),[m]),hasCustomAnchor:d,onCustomAnchorAdd:g.useCallback(()=>u(!0),[]),onCustomAnchorRemove:g.useCallback(()=>u(!1),[]),modal:a,children:s})})};da.displayName=en;var ua="PopoverAnchor",$f=g.forwardRef((t,e)=>{const{__scopePopover:s,...r}=t,n=ze(ua,s),i=Jt(s),{onCustomAnchorAdd:a,onCustomAnchorRemove:l}=n;return g.useEffect(()=>(a(),()=>l()),[a,l]),o.jsx(la,{...i,...r,ref:e})});$f.displayName=ua;var ha="PopoverTrigger",fa=g.forwardRef((t,e)=>{const{__scopePopover:s,...r}=t,n=ze(ha,s),i=Jt(s),a=ue(e,n.triggerRef),l=o.jsx(X.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":xa(n.open),...r,ref:a,onClick:Y(t.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:o.jsx(la,{asChild:!0,...i,children:l})});fa.displayName=ha;var tn="PopoverPortal",[Ff,Mf]=ca(tn,{forceMount:void 0}),ma=t=>{const{__scopePopover:e,forceMount:s,children:r,container:n}=t,i=ze(tn,e);return o.jsx(Ff,{scope:e,forceMount:s,children:o.jsx(ws,{present:s||i.open,children:o.jsx(Ya,{asChild:!0,container:n,children:r})})})};ma.displayName=tn;var ft="PopoverContent",pa=g.forwardRef((t,e)=>{const s=Mf(ft,t.__scopePopover),{forceMount:r=s.forceMount,...n}=t,i=ze(ft,t.__scopePopover);return o.jsx(ws,{present:r||i.open,children:i.modal?o.jsx(Df,{...n,ref:e}):o.jsx(Lf,{...n,ref:e})})});pa.displayName=ft;var Df=g.forwardRef((t,e)=>{const s=ze(ft,t.__scopePopover),r=g.useRef(null),n=ue(e,r),i=g.useRef(!1);return g.useEffect(()=>{const a=r.current;if(a)return Va(a)},[]),o.jsx(Ga,{as:ds,allowPinchZoom:!0,children:o.jsx(ga,{...t,ref:n,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Y(t.onCloseAutoFocus,a=>{var l;a.preventDefault(),i.current||(l=s.triggerRef.current)==null||l.focus()}),onPointerDownOutside:Y(t.onPointerDownOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Y(t.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),Lf=g.forwardRef((t,e)=>{const s=ze(ft,t.__scopePopover),r=g.useRef(!1),n=g.useRef(!1);return o.jsx(ga,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var a,l;(a=t.onCloseAutoFocus)==null||a.call(t,i),i.defaultPrevented||(r.current||(l=s.triggerRef.current)==null||l.focus(),i.preventDefault()),r.current=!1,n.current=!1},onInteractOutside:i=>{var c,d;(c=t.onInteractOutside)==null||c.call(t,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const a=i.target;((d=s.triggerRef.current)==null?void 0:d.contains(a))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),ga=g.forwardRef((t,e)=>{const{__scopePopover:s,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...f}=t,m=ze(ft,s),h=Jt(s);return Wa(),o.jsx(Ja,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:i,children:o.jsx(Ka,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>m.onOpenChange(!1),children:o.jsx(Tf,{"data-state":xa(m.open),role:"dialog",id:m.contentId,...h,...f,ref:e,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ya="PopoverClose",Bf=g.forwardRef((t,e)=>{const{__scopePopover:s,...r}=t,n=ze(ya,s);return o.jsx(X.button,{type:"button",...r,ref:e,onClick:Y(t.onClick,()=>n.onOpenChange(!1))})});Bf.displayName=ya;var Uf="PopoverArrow",Hf=g.forwardRef((t,e)=>{const{__scopePopover:s,...r}=t,n=Jt(s);return o.jsx(Rf,{...n,...r,ref:e})});Hf.displayName=Uf;function xa(t){return t?"open":"closed"}var zf=da,qf=fa,Vf=ma,ba=pa;const Gf=zf,Wf=qf,va=g.forwardRef(({className:t,align:e="center",sideOffset:s=4,...r},n)=>o.jsx(Vf,{children:o.jsx(ba,{ref:n,align:e,sideOffset:s,className:L("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));va.displayName=ba.displayName;const wa=({currentRegion:t,onRegionSelect:e,isFromDraft:s=!1,isDetected:r=!1})=>{if(!t)return null;const n=()=>s?"bg-purple-100 text-purple-800":r?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800",i=()=>s?"From Draft":r?"Auto-detected":"Manual";return o.jsxs(Gf,{children:[o.jsx(Wf,{asChild:!0,children:o.jsxs(D,{variant:"ghost",size:"sm",className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n()} hover:opacity-80 transition-opacity cursor-pointer`,children:[o.jsx(kr,{className:"w-3 h-3 mr-1"}),t.code," - ",t.name,o.jsx(ll,{className:"w-3 h-3 ml-1"})]})}),o.jsxs(va,{className:"w-80 p-0",align:"start",children:[o.jsxs("div",{className:"p-3 border-b bg-gray-50",children:[o.jsx("h4",{className:"font-medium text-sm text-gray-900",children:"Select Region & Doctor"}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current: ",i()]})]}),o.jsx("div",{className:"p-3 space-y-2",children:Object.values(ut).map(a=>o.jsxs("button",{onClick:()=>e(a),className:`w-full text-left p-3 rounded-lg border transition-colors ${t.code===a.code?"border-[#ef4805] bg-orange-50 text-[#ef4805]":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[o.jsx("div",{className:"font-medium text-sm",children:a.name}),o.jsx("div",{className:"text-sm text-gray-600",children:a.doctor}),o.jsxs("div",{className:"text-xs text-gray-500",children:["Practice: ",a.practiceNumber]})]},a.code))})]})]})},Jf=({onDelete:t,disabled:e=!1,patientName:s="this draft",isDeleting:r=!1})=>{const[n,i]=g.useState(!1),a=()=>{t(),i(!1)};return o.jsxs(Bi,{open:n,onOpenChange:i,children:[o.jsx(Ui,{asChild:!0,children:o.jsx(D,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:e||r,children:o.jsx(Ar,{className:"w-4 h-4"})})}),o.jsxs(Lr,{children:[o.jsxs(Br,{children:[o.jsx(Hr,{children:"Delete Draft"}),o.jsxs(zr,{children:["Are you sure you want to delete the draft for ",s,"? This action cannot be undone."]})]}),o.jsxs(Ur,{children:[o.jsx(Vr,{children:"Cancel"}),o.jsx(qr,{onClick:a,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})},Kf=()=>{const[t,e]=g.useState(new Set),[s,r]=g.useState(!1);return He(),{selectedDrafts:t,isSelectAll:s,toggleDraftSelection:d=>{const u=new Set(t);u.has(d)?u.delete(d):u.add(d),e(u),r(!1)},toggleSelectAll:d=>{s||t.size===d.length?(e(new Set),r(!1)):(e(new Set(d)),r(!0))},clearSelection:()=>{e(new Set),r(!1)},getSelectedCount:()=>t.size,getSelectedDrafts:()=>Array.from(t)}},Yf=js("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),mt=g.forwardRef(({className:t,variant:e,...s},r)=>o.jsx("div",{ref:r,role:"alert",className:L(Yf({variant:e}),t),...s}));mt.displayName="Alert";const Xf=g.forwardRef(({className:t,...e},s)=>o.jsx("h5",{ref:s,className:L("mb-1 font-medium leading-none tracking-tight",t),...e}));Xf.displayName="AlertTitle";const pt=g.forwardRef(({className:t,...e},s)=>o.jsx("div",{ref:s,className:L("text-sm [&_p]:leading-relaxed",t),...e}));pt.displayName="AlertDescription";const Qf=({drafts:t,isLoading:e,error:s,onRetry:r,onDeleteDraft:n,onBulkDeleteDrafts:i,onDoctorChange:a,formatDate:l,getDoctorOptions:c,onContinue:d,isBulkDeleting:u,onEmergencyCleanup:f,onManualCleanup:m})=>{const{selectedDrafts:h,isSelectAll:p,toggleDraftSelection:y,toggleSelectAll:x,clearSelection:b,getSelectedCount:v,getSelectedDrafts:w}=Kf();if(e)return o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-gray-500",children:"Loading drafts..."})});if(s)return o.jsxs("div",{className:"space-y-4 p-4",children:[o.jsxs(mt,{variant:"destructive",children:[o.jsx(_s,{className:"h-4 w-4"}),o.jsx(pt,{children:s})]}),o.jsxs("div",{className:"text-center space-x-2",children:[o.jsx(D,{onClick:r,variant:"outline",children:"Try Again"}),f&&o.jsxs(D,{onClick:f,variant:"outline",className:"text-red-600 border-red-300",children:[o.jsx(nt,{className:"w-4 h-4 mr-2"}),"Emergency Cleanup"]})]})]});if(t.length===0)return o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-500",children:"No saved drafts found"}),o.jsxs("div",{className:"mt-4 space-x-2",children:[m&&o.jsx(D,{onClick:m,variant:"outline",size:"sm",children:"Clean Up Old Drafts"}),f&&o.jsxs(D,{onClick:f,variant:"outline",size:"sm",className:"text-red-600 border-red-300",children:[o.jsx(nt,{className:"w-4 h-4 mr-2"}),"Emergency Cleanup"]})]})]});const _=t.map(N=>String(N.id)),j=()=>{const N=w();i(N),b()},S=(N,E)=>{a(String(N.id),E.code)},C=N=>{const E=c(),O=E.find(A=>A.code===N.regionCode)||E[0];return{code:N.regionCode||(O==null?void 0:O.code)||"PTA",name:N.region||(O==null?void 0:O.name)||"Pretoria",doctor:N.doctor||(O==null?void 0:O.doctor)||"Dr. Unknown",practiceNumber:N.practiceNumber||(O==null?void 0:O.practiceNumber)||"0123456"}},k=N=>{n(N,{preventDefault:()=>{},stopPropagation:()=>{}})};return o.jsxs("div",{className:"space-y-0",children:[o.jsx(wh,{totalDrafts:t.length,selectedCount:v(),isSelectAll:p,onToggleSelectAll:()=>x(_),onBulkDelete:j,isBulkDeleting:u,onClearSelection:b}),t.length>5&&o.jsx("div",{className:"p-4 bg-yellow-50 border-l-4 border-yellow-400 space-y-2",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx(nt,{className:"w-4 h-4 text-yellow-600 mr-2"}),o.jsx("p",{className:"text-sm text-yellow-800",children:"Manage your drafts with cleanup options"})]}),o.jsxs("div",{className:"space-x-2",children:[m&&o.jsx(D,{onClick:m,variant:"outline",size:"sm",children:"Clean Old Drafts"}),f&&o.jsx(D,{onClick:f,variant:"outline",size:"sm",className:"text-red-600 border-red-300",children:"Emergency Cleanup"})]})]})}),o.jsx("div",{className:"space-y-4 p-4",children:t.map(N=>{const E=N.autoSaved===!0;return o.jsx("div",{className:`border border-gray-200 rounded-lg p-4 transition-colors ${E?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[o.jsx(ne,{checked:h.has(String(N.id)),onCheckedChange:()=>y(String(N.id)),className:"mt-1",disabled:E}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(ml,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"font-medium text-gray-900 truncate",children:N.patientName||"Unnamed Patient"}),E&&o.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Auto-saving..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2",children:[N.cellPhone&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(hl,{className:"w-3 h-3 text-gray-400"}),o.jsx("span",{children:N.cellPhone})]}),N.timestamp&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(il,{className:"w-3 h-3 text-gray-400"}),o.jsxs("span",{children:["Saved: ",l(N.timestamp)]})]})]}),o.jsx("div",{className:"text-xs text-gray-500 mb-2",children:o.jsxs("div",{children:["Draft ID: ",String(N.id).substring(0,20),"..."]})}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2"}),(N.idNumber||N.email)&&o.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[N.idNumber&&o.jsxs("div",{children:["ID: ",N.idNumber]}),N.email&&o.jsxs("div",{children:["Email: ",N.email]})]}),o.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[o.jsx(kr,{className:"w-3 h-3 text-gray-400"}),o.jsx("span",{className:"text-xs text-gray-500",children:"Region:"}),o.jsx(wa,{currentRegion:C(N),onRegionSelect:O=>S(N,O),isFromDraft:!0})]})]})]}),o.jsxs("div",{className:"flex gap-2 ml-4",children:[o.jsx(D,{onClick:()=>d(String(N.id)),size:"sm",className:"bg-[#ef4805] hover:bg-[#d63d04] text-white",disabled:E,children:"Continue"}),o.jsx(Jf,{onDelete:()=>k(String(N.id)),disabled:E,patientName:N.patientName||"this draft"})]})]})},N.id)})})]})},Zf=js("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Re({className:t,variant:e,...s}){return o.jsx("div",{className:L(Zf({variant:e}),t),...s})}function em(t,e=[]){let s=[];function r(i,a){const l=g.createContext(a),c=s.length;s=[...s,a];function d(f){const{scope:m,children:h,...p}=f,y=(m==null?void 0:m[t][c])||l,x=g.useMemo(()=>p,Object.values(p));return o.jsx(y.Provider,{value:x,children:h})}function u(f,m){const h=(m==null?void 0:m[t][c])||l,p=g.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${i}\``)}return d.displayName=i+"Provider",[d,u]}const n=()=>{const i=s.map(a=>g.createContext(a));return function(l){const c=(l==null?void 0:l[t])||i;return g.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return n.scopeName=t,[r,tm(n,...e)]}function tm(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const r=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const a=r.reduce((l,{useScope:c,scopeName:d})=>{const f=c(i)[`__scope${d}`];return{...l,...f}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return s.scopeName=e.scopeName,s}var sn="Progress",rn=100,[sm,Vp]=em(sn),[rm,nm]=sm(sn),_a=g.forwardRef((t,e)=>{const{__scopeProgress:s,value:r=null,max:n,getValueLabel:i=om,...a}=t;(n||n===0)&&!qn(n)&&console.error(im(`${n}`,"Progress"));const l=qn(n)?n:rn;r!==null&&!Vn(r,l)&&console.error(am(`${r}`,"Progress"));const c=Vn(r,l)?r:null,d=xs(c)?i(c,l):void 0;return o.jsx(rm,{scope:s,value:c,max:l,children:o.jsx(X.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":xs(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":Na(c,l),"data-value":c??void 0,"data-max":l,...a,ref:e})})});_a.displayName=sn;var ja="ProgressIndicator",Sa=g.forwardRef((t,e)=>{const{__scopeProgress:s,...r}=t,n=nm(ja,s);return o.jsx(X.div,{"data-state":Na(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...r,ref:e})});Sa.displayName=ja;function om(t,e){return`${Math.round(t/e*100)}%`}function Na(t,e){return t==null?"indeterminate":t===e?"complete":"loading"}function xs(t){return typeof t=="number"}function qn(t){return xs(t)&&!isNaN(t)&&t>0}function Vn(t,e){return xs(t)&&!isNaN(t)&&t<=e&&t>=0}function im(t,e){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${e}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${rn}\`.`}function am(t,e){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${e}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${rn} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ca=_a,lm=Sa;const Ms=g.forwardRef(({className:t,value:e,...s},r)=>o.jsx(Ca,{ref:r,className:L("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...s,children:o.jsx(lm,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));Ms.displayName=Ca.displayName;const cm=({queuedSubmissions:t,isLoading:e,onForceRetry:s,onClearFailedSubmissions:r,onRefresh:n})=>{const[i,a]=g.useState(new Date);g.useEffect(()=>{const h=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(h)},[]);const l=()=>{const h=t.filter(b=>b.submissionStatus==="pending").length,p=t.filter(b=>b.submissionStatus==="retrying").length,y=t.filter(b=>b.submissionStatus==="failed"||b.retryCount>=b.maxRetries).length,x=t.length;return{pending:h,retrying:p,failed:y,total:x}},c=h=>{if(h.submissionStatus==="failed"||h.retryCount>=h.maxRetries)return"Failed";const y=new Date(h.nextRetry).getTime()-i.getTime();if(y<=0)return"Ready";const x=Math.floor(y/(1e3*60)),b=Math.floor(y%(1e3*60)/1e3);return x>0?`${x}m ${b}s`:`${b}s`},d=h=>h.retryCount/h.maxRetries*100,u=h=>h.submissionStatus==="failed"||h.retryCount>=h.maxRetries?o.jsx(cl,{className:"w-4 h-4 text-red-500"}):h.submissionStatus==="retrying"?o.jsx(Ie,{className:"w-4 h-4 text-yellow-500 animate-spin"}):c(h)==="Ready"?o.jsx(he,{className:"w-4 h-4 text-green-500"}):o.jsx(Ye,{className:"w-4 h-4 text-blue-500"}),f=l(),m=t.filter(h=>h.submissionStatus!=="failed"&&h.retryCount<h.maxRetries&&new Date(h.nextRetry)<=i);return e?o.jsxs(ve,{children:[o.jsx(we,{children:o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(Pt,{className:"w-5 h-5"}),"Queue Status"]})}),o.jsx(je,{children:o.jsx("p",{className:"text-gray-500",children:"Loading queue status..."})})]}):o.jsxs(ve,{children:[o.jsx(we,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(Pt,{className:"w-5 h-5"}),"Queue Status Dashboard"]}),o.jsxs(D,{onClick:n,variant:"outline",size:"sm",children:[o.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})}),o.jsxs(je,{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f.pending}),o.jsx("div",{className:"text-sm text-blue-600",children:"Pending"})]}),o.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:f.retrying}),o.jsx("div",{className:"text-sm text-yellow-600",children:"Retrying"})]}),o.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.failed}),o.jsx("div",{className:"text-sm text-red-600",children:"Failed"})]}),o.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[o.jsx("div",{className:"text-2xl font-bold text-gray-600",children:f.total}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]})]}),m.length>0&&o.jsxs(mt,{children:[o.jsx(he,{className:"h-4 w-4"}),o.jsxs(pt,{children:[m.length," submission",m.length>1?"s are":" is"," ready for retry."]})]}),f.failed>0&&o.jsxs(mt,{variant:"destructive",children:[o.jsx(nt,{className:"h-4 w-4"}),o.jsxs(pt,{className:"flex justify-between items-center",children:[o.jsxs("span",{children:[f.failed," submission",f.failed>1?"s have":" has"," permanently failed."]}),o.jsx(D,{onClick:r,variant:"outline",size:"sm",className:"ml-2",children:"Clear Failed"})]})]}),t.length>0?o.jsxs("div",{className:"space-y-3",children:[o.jsx("h4",{className:"font-medium",children:"Queue Details"}),t.map(h=>o.jsxs("div",{className:"border rounded-lg p-3 space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[u(h),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-sm",children:h.data.patientName||"Unknown Patient"}),o.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",new Date(h.createdAt).toLocaleString()]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(Re,{variant:h.submissionStatus==="failed"||h.retryCount>=h.maxRetries?"destructive":"secondary",children:[h.retryCount,"/",h.maxRetries]}),h.submissionStatus!=="failed"&&h.retryCount<h.maxRetries&&o.jsx(D,{onClick:()=>s(h.id),variant:"outline",size:"sm",disabled:h.submissionStatus==="retrying",children:h.submissionStatus==="retrying"?o.jsx(Ie,{className:"w-3 h-3 animate-spin"}):"Force Retry"})]})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-xs",children:[o.jsx("span",{children:"Retry Progress"}),o.jsxs("span",{children:[Math.round(d(h)),"%"]})]}),o.jsx(Ms,{value:d(h),className:"h-2"})]}),h.submissionStatus!=="failed"&&h.retryCount<h.maxRetries&&o.jsxs("div",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Next retry:"}),o.jsx("span",{className:`font-mono ${c(h)==="Ready"?"text-green-600 font-bold":"text-blue-600"}`,children:c(h)})]})]},h.id))]}):o.jsxs("div",{className:"text-center py-6 text-gray-500",children:[o.jsx(Pt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),o.jsx("p",{children:"No items in submission queue"})]})]})]})},dm=({pendingSubmissions:t,onRetrySubmission:e,onDeleteSubmission:s,onForceRetry:r,isLoading:n})=>{const[i,a]=g.useState(new Date);g.useEffect(()=>{const p=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(p)},[]);const l=p=>p.submissionStatus==="failed"||p.retryCount>=p.maxRetries?"destructive":p.submissionStatus==="retrying"?"secondary":u(p)?"default":"outline",c=p=>p.submissionStatus==="failed"?"Failed":p.retryCount>=p.maxRetries?"Max retries exceeded":p.submissionStatus==="retrying"?"Retrying...":u(p)?"Ready to retry":"Pending",d=p=>{const y=i,b=new Date(p).getTime()-y.getTime();if(b<=0)return"Ready now";const v=Math.floor(b/(1e3*60)),w=Math.floor(b%(1e3*60)/1e3);return v>0?`${v}m ${w}s`:`${w}s`},u=p=>p.submissionStatus==="failed"||p.retryCount>=p.maxRetries?!1:new Date(p.nextRetry)<=i,f=p=>p.retryCount/p.maxRetries*100;if(n)return o.jsxs(ve,{children:[o.jsx(we,{children:o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(Ye,{className:"w-5 h-5"}),"Enhanced Pending Submissions"]})}),o.jsx(je,{children:o.jsxs("div",{className:"flex items-center justify-center py-8",children:[o.jsx(Ie,{className:"w-6 h-6 animate-spin mr-2"}),o.jsx("p",{className:"text-gray-500",children:"Loading pending submissions..."})]})})]});if(t.length===0)return o.jsxs(ve,{children:[o.jsx(we,{children:o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(Ye,{className:"w-5 h-5"}),"Enhanced Pending Submissions"]})}),o.jsx(je,{children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx(Pt,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),o.jsx("p",{className:"text-gray-500",children:"No pending submissions"}),o.jsx("p",{className:"text-sm text-gray-400",children:"All submissions are up to date"})]})})]});const m=t.filter(p=>p.submissionStatus==="failed"||p.retryCount>=p.maxRetries),h=t.filter(u);return o.jsxs(ve,{children:[o.jsx(we,{children:o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(Ye,{className:"w-5 h-5"}),"Enhanced Pending Submissions (",t.length,")"]})}),o.jsxs(je,{className:"space-y-4",children:[h.length>0&&o.jsxs(mt,{children:[o.jsx(hn,{className:"h-4 w-4"}),o.jsxs(pt,{children:[h.length," submission",h.length>1?"s are":" is"," ready for retry."]})]}),m.length>0&&o.jsxs(mt,{variant:"destructive",children:[o.jsx(nt,{className:"h-4 w-4"}),o.jsxs(pt,{children:[m.length," submission",m.length>1?"s":""," failed permanently. Consider deleting them to clean up your queue."]})]}),o.jsx("div",{className:"space-y-3",children:t.map(p=>o.jsxs("div",{className:"border rounded-lg p-4 space-y-3 bg-white shadow-sm",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("h4",{className:"font-medium",children:p.data.patientName||"Unknown Patient"}),o.jsx(Re,{variant:l(p),className:"text-xs",children:c(p)})]}),o.jsxs("p",{className:"text-sm text-gray-500",children:["Created: ",new Date(p.createdAt).toLocaleString()]}),p.lastAttempt&&o.jsxs("p",{className:"text-sm text-gray-500",children:["Last attempt: ",new Date(p.lastAttempt).toLocaleString()]})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs(Re,{variant:p.retryCount>=p.maxRetries?"destructive":"outline",className:"font-mono",children:[p.retryCount,"/",p.maxRetries]})})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[o.jsx("span",{children:"Retry Progress"}),o.jsxs("span",{children:[Math.round(f(p)),"%"]})]}),o.jsx(Ms,{value:f(p),className:"h-2"})]}),p.submissionStatus!=="failed"&&p.retryCount<p.maxRetries&&o.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Pt,{className:"w-4 h-4 text-blue-600"}),o.jsx("span",{className:"text-sm text-blue-700",children:"Next retry:"})]}),o.jsx("span",{className:`font-mono text-sm font-bold ${u(p)?"text-green-600 animate-pulse":"text-blue-600"}`,children:d(p.nextRetry)})]}),o.jsx("div",{className:"flex gap-2 pt-2",children:p.submissionStatus==="failed"||p.retryCount>=p.maxRetries?o.jsxs(D,{onClick:()=>s(p.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[o.jsx(Ar,{className:"w-4 h-4 mr-1"}),"Delete"]}):o.jsxs(o.Fragment,{children:[o.jsxs(D,{onClick:()=>e(p.id),variant:"outline",size:"sm",disabled:p.submissionStatus==="retrying",children:[o.jsx(Ie,{className:`w-4 h-4 mr-1 ${p.submissionStatus==="retrying"?"animate-spin":""}`}),p.submissionStatus==="retrying"?"Retrying...":"Retry Now"]}),o.jsxs(D,{onClick:()=>r(p.id),variant:"default",size:"sm",disabled:p.submissionStatus==="retrying",className:"bg-orange-500 hover:bg-orange-600",children:[o.jsx(hn,{className:"w-4 h-4 mr-1"}),"Force Retry"]})]})})]},p.id))})]})]})},um=({drafts:t,isLoading:e,error:s,isBulkDeleting:r,onRetryDrafts:n,onDeleteDraft:i,onBulkDeleteDrafts:a,onDoctorChange:l,onEmergencyCleanup:c,onManualCleanup:d,onContinue:u,formatDate:f,getDoctorOptions:m,pendingSubmissions:h,loadingPending:p,onRetrySubmission:y,onDeleteSubmission:x,onForceRetry:b,onClearFailedSubmissions:v,onRefreshPending:w})=>o.jsxs(sh,{defaultValue:"drafts",className:"overflow-y-auto max-h-[70vh]",children:[o.jsxs(mi,{className:"grid w-full grid-cols-3",children:[o.jsx(as,{value:"drafts",children:"Saved Drafts"}),o.jsx(as,{value:"queue",children:"Queue Dashboard"}),o.jsx(as,{value:"pending",children:"Pending Submissions"})]}),o.jsx(ls,{value:"drafts",className:"space-y-4",children:o.jsx(Qf,{drafts:t,isLoading:e,error:s,onRetry:n,onDeleteDraft:i,onBulkDeleteDrafts:a,onDoctorChange:l,onEmergencyCleanup:c,onManualCleanup:d,formatDate:f,getDoctorOptions:m,onContinue:u,isBulkDeleting:r})}),o.jsx(ls,{value:"queue",className:"space-y-4",children:o.jsx(cm,{queuedSubmissions:h,isLoading:p,onForceRetry:b,onClearFailedSubmissions:v,onRefresh:w})}),o.jsx(ls,{value:"pending",className:"space-y-4",children:o.jsx(dm,{pendingSubmissions:h,onRetrySubmission:y,onDeleteSubmission:x,onForceRetry:b,isLoading:p})})]}),hm=t=>{const[e,s]=g.useState([]),[r,n]=g.useState(!1),[i,a]=g.useState(null),[l,c]=g.useState(!1),{getForms:d,deleteForm:u,saveForm:f}=zt(),m=async()=>{if(t){n(!0),a(null);try{const w=await d(!0);s(w||[]),console.log(`Loaded ${(w==null?void 0:w.length)||0} drafts`)}catch(w){a("Failed to load drafts"),console.error("Error loading drafts:",w)}finally{n(!1)}}};return g.useEffect(()=>{t&&m()},[t]),{drafts:e,isLoading:r,error:i,isBulkDeleting:l,loadDrafts:m,handleDeleteDraft:async(w,_)=>{if(_.stopPropagation(),e.some(S=>String(S.id)===w&&S.autoSaved===!0)){a("Cannot delete draft while auto-save is in progress. Please wait a moment and try again.");return}try{console.log("Deleting draft with ID:",w,typeof w);const S=parseInt(w,10);if(isNaN(S))throw new Error(`Invalid draft ID: ${w}`);await u(S,!0),console.log("Draft deleted successfully"),s(C=>C.filter(k=>String(k.id)!==w)),setTimeout(()=>m(),500)}catch(S){console.error("Error deleting draft:",S),a(`Failed to delete draft: ${S instanceof Error?S.message:"Unknown error"}`)}},handleBulkDeleteDrafts:async w=>{if(w.length===0)return;c(!0),a(null);let _=0,j=0;try{for(const S of w)try{console.log("Bulk deleting draft with ID:",S,typeof S);const C=parseInt(S,10);if(isNaN(C))throw new Error(`Invalid draft ID: ${S}`);await u(C,!0),_++,console.log(`Successfully deleted draft ${S}`)}catch(C){j++,console.error(`Failed to delete draft ${S}:`,C)}j>0&&a(`Deleted ${_} drafts, but ${j} failed`),s(S=>S.filter(C=>!w.includes(String(C.id)))),setTimeout(()=>m(),1e3)}catch(S){console.error("Error in bulk delete:",S),a("Bulk delete operation failed")}finally{c(!1)}},handleDoctorChange:async(w,_)=>{try{console.log("Changing region for draft:",w,"to:",_);const j=e.find(k=>String(k.id)===w);if(!j)throw new Error(`Draft with ID ${w} not found`);const S=ut[_];if(!S)throw new Error(`Invalid region code: ${_}`);const C={...j,regionCode:S.code,region:S.name,doctor:S.doctor,practiceNumber:S.practiceNumber,lastModified:new Date().toISOString()};await f(C,!0),console.log("Draft region updated successfully"),await m()}catch(j){console.error("Error updating draft region:",j),a(`Failed to update region: ${j instanceof Error?j.message:"Unknown error"}`)}},handleEmergencyCleanup:async()=>{try{console.log("Starting emergency cleanup of all drafts"),n(!0);const w=await d(!0);let _=0;for(const j of w)try{const S=typeof j.id=="string"?parseInt(j.id,10):j.id;isNaN(S)||(await u(S,!0),_++)}catch(S){console.error(`Failed to clean draft ${j.id}:`,S)}console.log(`Emergency cleanup completed: ${_} drafts removed`),s([]),await m()}catch(w){console.error("Emergency cleanup failed:",w),a("Emergency cleanup failed")}finally{n(!1)}},formatDate:w=>{try{return new Date(w).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(_){return console.error("Error formatting date:",_),"Invalid date"}},getDoctorOptions:()=>Object.values(ut).map(w=>w.doctor)}},fm=({getForms:t,deleteForm:e,maxAgeDays:s=30,onCleanupComplete:r})=>{const{toast:n}=He(),i=c=>{try{const d=new Date(c),f=Math.abs(new Date().getTime()-d.getTime());return Math.ceil(f/(1e3*60*60*24))>s}catch(d){return console.error("Error checking stale date:",d),!1}},a=async()=>{try{const c=await t(!0);let d=0;for(const u of c){const f=u.createdAt||u.timestamp,m=u.lastModified,h=f&&i(f),p=m&&i(m);if(h||p)try{await e(u.id,!0),d++,console.log(`Deleted stale draft: ${u.patientName||"Unknown"} (${u.id})`)}catch(y){console.error(`Failed to delete stale draft ${u.id}:`,y)}}return d}catch(c){return console.error("Failed to cleanup stale drafts:",c),0}},l=async()=>{try{const c=await a();c>0?n({title:"Cleanup Complete",description:`Deleted ${c} draft${c>1?"s":""} older than ${s} days.`}):n({title:"No Cleanup Needed",description:"No stale drafts found."}),r&&r(c)}catch(c){console.error("Manual cleanup failed:",c),n({title:"Cleanup Failed",description:"Unable to clean up old drafts.",variant:"destructive"})}};return g.useEffect(()=>{const d=setTimeout(async()=>{try{const u=await a();u>0&&(console.log(`Auto-cleanup: Deleted ${u} stale drafts`),n({title:"Auto Cleanup",description:`Cleaned up ${u} old draft${u>1?"s":""}.`,variant:"default"})),r&&r(u)}catch(u){console.error("Auto cleanup failed:",u)}},3e3);return()=>clearTimeout(d)},[]),{manualCleanup:l,cleanupStaleDrafts:a}},ka="submission_queue",mm=5,Gn=[1e3,2e3,5e3,1e4,3e4],pm=async t=>{const e=`queue_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s=new Date().toISOString(),r={id:e,data:t,submissionStatus:"pending",retryCount:0,lastAttempt:s,nextRetry:s,createdAt:s,maxRetries:mm},n=await Be();return n.push(r),await Ds(n),console.log("Added to submission queue:",e),e},Be=async()=>{try{const t=localStorage.getItem(ka);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to get submission queue:",t),[]}},Ds=async t=>{try{localStorage.setItem(ka,JSON.stringify(t))}catch(e){console.error("Failed to save submission queue:",e)}},Aa=async(t,e)=>{const s=await Be(),r=s.findIndex(n=>n.id===t);r!==-1&&(s[r]={...s[r],...e},await Ds(s))},Wn=async t=>{const s=(await Be()).filter(r=>r.id!==t);await Ds(s),console.log("Removed from submission queue:",t)},gm=t=>{const e=Gn[Math.min(t,Gn.length-1)];return new Date(Date.now()+e).toISOString()},ym=t=>t.submissionStatus==="failed"||t.retryCount>=t.maxRetries?!1:new Date(t.nextRetry)<=new Date,Jn=async()=>(await Be()).filter(ym),xm=async t=>{const s=(await Be()).find(r=>r.id===t);if(s){const r=s.retryCount+1;await Aa(t,{retryCount:r,lastAttempt:new Date().toISOString(),nextRetry:gm(r),submissionStatus:r>=s.maxRetries?"failed":"retrying"})}},bm=async()=>{const t=await Be(),e=new Date(Date.now()-7*24*60*60*1e3),s=t.filter(r=>r.submissionStatus==="failed"?new Date(r.createdAt)>e:!0);s.length!==t.length&&(await Ds(s),console.log(`Cleaned up ${t.length-s.length} old failed submissions`))},vm=({onRetrySubmissions:t,isEnabled:e=!0})=>{const{isOnline:s}=xo(),{toast:r}=He(),n=g.useRef(),i=g.useRef(!s);return g.useEffect(()=>{s&&i.current&&e&&(console.log("Device came online, checking for pending submissions..."),setTimeout(async()=>{try{const l=await Jn();l.length>0&&(r({title:"Back Online",description:`Retrying ${l.length} pending submission${l.length>1?"s":""}...`}),await t())}catch(l){console.error("Auto-retry failed:",l)}},2e3)),i.current=!s},[s,t,e,r]),g.useEffect(()=>{if(!e)return;const a=async()=>{if(s)try{const l=await Jn();l.length>0&&(console.log(`Found ${l.length} submissions ready for retry`),await t())}catch(l){console.error("Periodic retry check failed:",l)}};return n.current=setInterval(a,3e4),()=>{n.current&&clearInterval(n.current)}},[s,t,e]),{isOnline:s,wasOffline:i.current}},wm=({isOpen:t,onDraftsChanged:e})=>{const s=gt(),{toast:r}=He(),[n,i]=g.useState([]),[a,l]=g.useState(!1),{getForms:c,deleteForm:d}=zt(),{drafts:u,isLoading:f,error:m,isBulkDeleting:h,loadDrafts:p,handleDeleteDraft:y,handleBulkDeleteDrafts:x,handleDoctorChange:b,handleEmergencyCleanup:v,formatDate:w,getDoctorOptions:_}=hm(t),{manualCleanup:j}=fm({getForms:c,deleteForm:d,onCleanupComplete:()=>{p(),e&&e()}}),S=async()=>{l(!0);try{const T=await Be();i(T)}catch(T){console.error("Failed to load pending submissions:",T)}finally{l(!1)}};return vm({onRetrySubmissions:async()=>{await S()},isEnabled:t}),{pendingSubmissions:n,loadingPending:a,drafts:u,isLoading:f,error:m,isBulkDeleting:h,formatDate:w,getDoctorOptions:_,handleContinue:T=>{s(`/consent-form/${T}`)},handleDelete:async(T,P)=>{await y(T,P),e&&e()},handleBulkDelete:async T=>{await x(T),e&&e()},handleEmergencyCleanupWithCallback:async()=>{await v(),e&&e()},handleRetrySubmission:async T=>{try{await xm(T),await S(),r({title:"Retry Scheduled",description:"Submission will be retried according to schedule."})}catch(P){console.error("Failed to retry submission:",P),r({title:"Retry Failed",description:"Could not schedule retry. Please try again.",variant:"destructive"})}},handleForceRetry:async T=>{try{await Aa(T,{nextRetry:new Date().toISOString(),submissionStatus:"retrying",lastAttempt:new Date().toISOString()}),await S(),r({title:"Force Retry Started",description:"Submission is being retried immediately."})}catch(P){console.error("Failed to force retry submission:",P),r({title:"Force Retry Failed",description:"Could not force retry. Please try again.",variant:"destructive"})}},handleDeleteSubmission:async T=>{try{await Wn(T),await S(),r({title:"Submission Deleted",description:"Failed submission has been removed from queue."})}catch(P){console.error("Failed to delete submission:",P),r({title:"Delete Failed",description:"Could not delete submission. Please try again.",variant:"destructive"})}},handleClearFailedSubmissions:async()=>{try{const P=(await Be()).filter(U=>U.submissionStatus==="failed"||U.retryCount>=U.maxRetries);for(const U of P)await Wn(U.id);await S(),r({title:"Failed Submissions Cleared",description:`Removed ${P.length} failed submission${P.length>1?"s":""} from queue.`})}catch(T){console.error("Failed to clear failed submissions:",T),r({title:"Clear Failed",description:"Could not clear failed submissions. Please try again.",variant:"destructive"})}},handleCacheRefresh:async()=>{await p(),await S(),e&&e()},manualCleanup:j,loadDrafts:p,loadPendingSubmissions:S}},_m=({onDraftsChanged:t})=>{const[e,s]=g.useState(!1),{pendingSubmissions:r,loadingPending:n,drafts:i,isLoading:a,error:l,isBulkDeleting:c,formatDate:d,getDoctorOptions:u,handleContinue:f,handleDelete:m,handleBulkDelete:h,handleEmergencyCleanupWithCallback:p,handleRetrySubmission:y,handleForceRetry:x,handleDeleteSubmission:b,handleClearFailedSubmissions:v,handleCacheRefresh:w,manualCleanup:_,loadDrafts:j,loadPendingSubmissions:S}=wm({isOpen:e,onDraftsChanged:t}),C=k=>{s(k),k&&S(),!k&&t&&t()};return o.jsxs(Ts,{open:e,onOpenChange:C,children:[o.jsx(Ou,{asChild:!0,children:o.jsxs(D,{variant:"outline",size:"lg",className:"inline-flex items-center px-6 py-3 bg-white text-[#ef4805] font-semibold rounded-lg border-2 border-[#ef4805] hover:bg-orange-50 transition-colors",children:[o.jsx(Ye,{className:"w-5 h-5 mr-2"}),"Resume Draft"]})}),o.jsxs(qt,{className:"max-w-7xl max-h-[90vh]",children:[o.jsx(Iu,{onRefresh:w}),o.jsx(um,{drafts:i,isLoading:a,error:l,isBulkDeleting:c,onRetryDrafts:j,onDeleteDraft:m,onBulkDeleteDrafts:h,onDoctorChange:()=>{},onEmergencyCleanup:p,onManualCleanup:_,onContinue:f,formatDate:d,getDoctorOptions:u,pendingSubmissions:r,loadingPending:n,onRetrySubmission:y,onDeleteSubmission:b,onForceRetry:x,onClearFailedSubmissions:v,onRefreshPending:S})]})]})},jm=({onRefresh:t})=>o.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium text-blue-800",children:"Pending Forms"}),o.jsx("p",{className:"text-sm text-blue-600",children:"Forms waiting to be synced to cloud"})]}),o.jsxs(D,{onClick:t,variant:"outline",size:"sm",children:[o.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})}),Sm=t=>{const e="/mia-consent-offline-form/",s=t.startsWith("/")?t.slice(1):t;return`${e.endsWith("/")?e:`${e}/`}${s}`},Pa=()=>Sm("lovable-uploads/9a0a9907-375b-48ce-a1bc-8009bc27059c.png"),Nm=()=>{console.log("Index: Component rendering started");const t=gt(),[e,s]=g.useState([]),[r,n]=g.useState(!1),[i,a]=g.useState(0),[l,c]=g.useState(!1),{isOnline:d}=xo(),{getForms:u,capabilities:f,isInitialized:m}=zt();console.log("Index: Hooks initialized successfully",{isOnline:d,capabilities:f,isInitialized:m}),g.useEffect(()=>{m&&!l&&h()},[m,i,l]);const h=async()=>{if(m){n(!0);try{console.log("Index: Loading drafts");const b=await u(!0);s(b||[]),console.log(`Index: Loaded ${(b||[]).length} draft forms`)}catch(b){console.error("Index: Failed to load drafts:",b),c(!0)}finally{n(!1)}}},p=()=>{console.log("Index: Refreshing drafts"),a(b=>b+1)},y=()=>{console.log("Index: Starting new form");try{t("/consent-form")}catch(b){console.error("Index: Navigation error:",b),c(!0)}};if(l)return o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center p-8",children:[o.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Something went wrong"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error loading the application."}),o.jsx(D,{onClick:()=>window.location.reload(),children:"Reload Page"})]})});const x=()=>o.jsx("div",{className:"flex items-center gap-2 text-sm",children:d?o.jsxs(o.Fragment,{children:[o.jsx(co,{className:"w-4 h-4 text-green-600"}),o.jsx("span",{className:"text-green-600",children:"Online"})]}):o.jsxs(o.Fragment,{children:[o.jsx(pl,{className:"w-4 h-4 text-orange-600"}),o.jsx("span",{className:"text-orange-600",children:"Offline"})]})});return console.log("Index: Rendering component"),o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:"bg-[#ef4805] p-4",children:o.jsx("div",{className:"max-w-4xl mx-auto",children:o.jsx("div",{className:"bg-white p-3 inline-block rounded-lg",children:o.jsx("img",{src:Pa(),alt:"Mia Healthcare",className:"h-16 w-auto",onError:b=>{console.error("Index: Mia logo failed to load:",b),console.log("Index: Attempted path:",b.currentTarget.src)},onLoad:()=>{console.log("Index: Mia logo loaded successfully")}})})})}),o.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[o.jsxs("div",{className:"text-center mb-8 mt-8",children:[o.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Mia Healthcare."}),o.jsx("p",{className:"text-xl text-gray-600",children:"Dental Consent Form"})]}),o.jsxs("div",{className:"flex justify-between items-center mb-8 p-4 bg-white rounded-lg shadow-sm",children:[o.jsx(x,{}),o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(kr,{className:"w-4 h-4 text-blue-600"}),o.jsx("span",{className:"text-blue-600",children:"Location will be detected when you start"})]})]}),!l&&o.jsx(jm,{onRefresh:p}),((e==null?void 0:e.length)||0)>0&&o.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsxs("p",{className:"text-blue-800 font-medium",children:["You have ",(e==null?void 0:e.length)||0," unfinished form",((e==null?void 0:e.length)||0)!==1?"s":""," saved as drafts"]}),o.jsx("p",{className:"text-blue-600 text-sm mt-1",children:'Use "Resume Draft" below to continue where you left off'})]}),o.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[o.jsxs(ve,{className:"hover:shadow-lg transition-shadow",children:[o.jsxs(we,{children:[o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(dl,{className:"w-6 h-6 text-[#ef4805]"}),"Start New Form"]}),o.jsx(us,{children:"Begin a new dental consent form for a patient"})]}),o.jsx(je,{children:o.jsx(D,{onClick:y,className:"w-full h-14 text-lg bg-[#ef4805] hover:bg-[#d63d04] text-white font-semibold",size:"lg",children:"Start New Form"})})]}),o.jsxs(ve,{className:"hover:shadow-lg transition-shadow",children:[o.jsxs(we,{children:[o.jsxs(_e,{className:"flex items-center gap-2",children:[o.jsx(Ie,{className:"w-6 h-6 text-blue-600"}),"Resume Draft (",(e==null?void 0:e.length)||0,")"]}),o.jsx(us,{children:"Continue working on a previously saved draft form"})]}),o.jsx(je,{children:o.jsx("div",{className:"w-full h-14 flex items-center",children:!l&&o.jsx(_m,{onDraftsChanged:p})})})]})]}),m&&!l&&o.jsxs("div",{className:"mt-4 text-center text-sm text-gray-500",children:["Storage: ",f.supabase?"Cloud + Local":f.indexedDB?"Local (IndexedDB)":"None",o.jsx("br",{}),o.jsx("span",{className:"text-xs",children:"Drafts saved locally • Completed forms go to cloud database"})]})]})]})},Cm=()=>{const[t,e]=g.useState(null),[s,r]=g.useState(!1),[n,i]=g.useState(!1),[a,l]=g.useState(!1),[c,d]=g.useState(!1),[u,f]=g.useState(!1),{toast:m}=He();g.useEffect(()=>{new URLSearchParams(window.location.search).get("draft")||h()},[]);const h=async b=>{if(b)return e(b),r(!0),i(!0),l(!1),d(!0),f(!1),m({title:"Region Loaded from Draft",description:`Form will be submitted for ${b.name} (${b.code}) - ${b.doctor}`}),b;if(n&&t)return t;try{const v=await _h();return e(v),r(!0),i(!0),l(!1),d(!1),f(!0),m({title:"Region Detected",description:`Form will be submitted for ${v.name} (${v.code}) - ${v.doctor}`}),v}catch(v){return console.error("Region detection failed:",v),e(null),r(!1),i(!1),l(!0),d(!1),f(!1),m({title:"Region Detection Failed",description:"Please select your region manually below",variant:"destructive"}),ut.PTA}};return{currentRegion:t,regionDetected:s,regionDetectionComplete:n,showManualSelector:a,isRegionFromDraft:c,isRegionDetected:u,detectAndSetRegion:h,setRegionManually:b=>{e(b),r(!0),i(!0),l(!1),d(!1),f(!1),m({title:"Region Selected",description:`Form will be submitted for ${b.name} (${b.code}) - ${b.doctor}`})},showRegionSelector:()=>{l(!0)},hideRegionSelector:()=>{l(!1)}}},km=()=>{const[t,e]=g.useState(!1),[s,r]=g.useState("draft");return{submitting:t,submissionStatus:s,startSubmission:()=>t?!1:(e(!0),r("pending"),!0),completeSubmission:l=>{e(!1),r(l)},failSubmission:()=>{e(!1),r("draft")},setSubmissionStatus:r}},tr=typeof localStorage<"u",Am=()=>{const[t,e]=g.useState(()=>tr?localStorage.getItem("formSessionId")||`session-${Date.now()}`:`session-${Date.now()}`);return g.useEffect(()=>{tr&&localStorage.setItem("formSessionId",t)},[t]),{sessionId:t,clearSession:()=>{tr&&localStorage.removeItem("formSessionId"),e(`session-${Date.now()}`)}}},rs="mia_submission_logs",Pm=1e3,Em=7,Je=class Je{static getInstance(){return Je.instance||(Je.instance=new Je),Je.instance}async logEvent(e,s,r,n,i){const a={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,event:e,formId:s,timestamp:new Date().toISOString(),status:r,message:n,metadata:i};try{const l=await this.getLogs(),c=[a,...l].slice(0,Pm);localStorage.setItem(rs,JSON.stringify(c)),console[r==="error"?"error":r==="warning"?"warn":"info"](`[${e}] ${n}`,i)}catch(l){console.error("Failed to log submission event:",l)}}async getLogs(){try{const e=localStorage.getItem(rs);if(!e)return[];const s=JSON.parse(e);return this.cleanupOldLogs(s)}catch(e){return console.error("Failed to retrieve submission logs:",e),[]}}async getLogsByFormId(e){return(await this.getLogs()).filter(r=>r.formId===e)}async getLogsByEvent(e){return(await this.getLogs()).filter(r=>r.event===e)}async clearLogs(){try{localStorage.removeItem(rs),console.info("Submission logs cleared")}catch(e){console.error("Failed to clear submission logs:",e)}}async exportLogs(){const e=await this.getLogs();return JSON.stringify(e,null,2)}cleanupOldLogs(e){const s=new Date;s.setDate(s.getDate()-Em);const r=e.filter(n=>new Date(n.timestamp)>s);return r.length!==e.length&&(localStorage.setItem(rs,JSON.stringify(r)),console.info(`Cleaned up ${e.length-r.length} old submission logs`)),r}async logSubmissionStart(e,s){await this.logEvent("submit.started",e,"info","Form submission started",s)}async logSubmissionSuccess(e,s){await this.logEvent("submit.success",e,"success","Form submitted successfully",s)}async logSubmissionFailed(e,s,r){await this.logEvent("submit.failed",e,"error",`Form submission failed: ${s}`,r)}async logSubmissionQueued(e,s){await this.logEvent("submit.queued",e,"info","Form queued for offline submission",s)}async logValidationFailed(e,s,r){await this.logEvent("validation.failed",e,"warning",`Validation failed: ${s.join(", ")}`,{...r,validationErrors:s})}async logSaveSuccess(e,s,r){await this.logEvent("save.success",e,"success",`${s?"Draft":"Form"} saved successfully`,r)}async logSaveFailed(e,s,r){await this.logEvent("save.failed",e,"error",`Save failed: ${s}`,r)}};St(Je,"instance");let br=Je;const ie=br.getInstance(),Ea=t=>{var n,i,a,l,c,d,u,f,m,h,p,y,x,b,v,w,_,j,S;const e=[];console.log("Validating comprehensive form data:",{patientName:t.patientName,age:t.age,idNumber:t.idNumber,cellPhone:t.cellPhone,email:t.email,address:t.address,terms:t.terms,consentFreeWill:t.consentFreeWill,rates:t.rates,paymentResponsibility:t.paymentResponsibility,cancellationPolicy:t.cancellationPolicy}),(n=t.patientName)!=null&&n.trim()||e.push("Patient name is required"),(i=t.age)!=null&&i.trim()||e.push("Age is required"),(a=t.birthDate)!=null&&a.trim()||e.push("Birth date is required"),(l=t.idNumber)!=null&&l.trim()||e.push("ID number is required"),(c=t.gender)!=null&&c.trim()||e.push("Gender is required"),(d=t.cellPhone)!=null&&d.trim()||e.push("Contact number is required"),(u=t.whatsappNumber)!=null&&u.trim()||e.push("WhatsApp number is required"),(f=t.email)!=null&&f.trim()||e.push("Personal email is required"),(m=t.address)!=null&&m.trim()||e.push("Address is required"),(h=t.responsibleForPayment)!=null&&h.trim()||e.push("Person responsible for payment is required"),t.paymentPreference==="Medical Aid"&&((p=t.medicalAidName)!=null&&p.trim()||e.push("Medical Aid name is required when Medical Aid is selected"),(y=t.medicalAidNo)!=null&&y.trim()||e.push("Medical Aid number is required when Medical Aid is selected"),(x=t.medicalAidPlan)!=null&&x.trim()||e.push("Medical Aid plan is required when Medical Aid is selected"),(b=t.mainMember)!=null&&b.trim()||e.push("Main member is required when Medical Aid is selected")),(v=t.emergencyName)!=null&&v.trim()||e.push("Emergency contact name is required"),(w=t.emergencyRelationship)!=null&&w.trim()||e.push("Emergency contact relationship is required"),(_=t.emergencyPhone)!=null&&_.trim()||e.push("Emergency WhatsApp number is required"),(j=t.allergies)!=null&&j.trim()||e.push("Allergies field is required (enter 'Nil' if none)"),(S=t.medication)!=null&&S.trim()||e.push("Medication field is required (enter 'Nil' if none)");const s=t.habits;return s&&(typeof s=="string"&&s.trim()!==""||Array.isArray(s)&&s.length>0)||e.push("Please select at least one option for habits/substance abuse"),(!t.terms||t.terms!=="Agree")&&e.push("You must agree to the terms and conditions"),(!t.consentFreeWill||t.consentFreeWill!=="Agree")&&e.push("You must confirm that consent is given of your own free will"),(!t.rates||t.rates!=="Agree")&&e.push("You must acknowledge the practice's billing rates"),(!t.paymentResponsibility||t.paymentResponsibility!=="Agree")&&e.push("You must accept responsibility for payment"),(!t.cancellationPolicy||t.cancellationPolicy!=="Acknowledge cancellation policy")&&e.push("You must acknowledge the cancellation policy"),console.log("Comprehensive validation result:",{isValid:e.length===0,errors:e}),{isValid:e.length===0,errors:e}},de=2,Om=[{fromVersion:1,toVersion:2,description:"Added enhanced tracking fields and normalized field names",migrate:t=>({...t,birthDate:t.birthDate||t.dateOfBirth,createdAt:t.createdAt||t.timestamp||new Date().toISOString(),lastModified:t.lastModified||new Date().toISOString(),formSchemaVersion:2,submissionStatus:t.submissionStatus||(t.status==="completed"?"submitted":"draft")})}],Oa=t=>{const e=[];let s={...t};const r=s.formSchemaVersion||1;if(r===de)return{migrated:s,warnings:e};if(r>de)return e.push(`Form was created with a newer version (${r}). Some features may not work correctly.`),{migrated:s,warnings:e};for(const n of Om)s.formSchemaVersion===n.fromVersion&&(console.log(`Migrating form from v${n.fromVersion} to v${n.toVersion}: ${n.description}`),s=n.migrate(s),e.push(`Form updated from version ${n.fromVersion} to ${n.toVersion}: ${n.description}`));return{migrated:s,warnings:e}},Tm=t=>t!==de,Rm=t=>t>de?`This form was created with a newer version (v${t}). Please update the app or some features may not work correctly.`:t<de?`This form was created with an older version (v${t}). It will be automatically updated when you save.`:"";class Dt{static simpleFallbackEncrypt(e){try{return this.ENCRYPTION_PREFIX+btoa(encodeURIComponent(e))}catch{return e}}static simpleFallbackDecrypt(e){try{if(!e.startsWith(this.ENCRYPTION_PREFIX))return e;const s=e.slice(this.ENCRYPTION_PREFIX.length);return decodeURIComponent(atob(s))}catch{return e}}static encryptSensitiveFields(e){const s={...e};return this.SENSITIVE_FIELDS.forEach(r=>{const n=s[r];n&&typeof n=="string"&&n.trim()&&(s[r]=this.simpleFallbackEncrypt(n))}),s._encrypted=!0,s}static decryptSensitiveFields(e){if(!e._encrypted)return e;const s={...e};return this.SENSITIVE_FIELDS.forEach(r=>{const n=s[r];n&&typeof n=="string"&&(s[r]=this.simpleFallbackDecrypt(n))}),delete s._encrypted,s}static isFieldSensitive(e){return this.SENSITIVE_FIELDS.includes(e)}static getSensitiveFields(){return[...this.SENSITIVE_FIELDS]}static getPrivacyNotice(){return"Sensitive information (like ID numbers and contact details) is encrypted when stored locally for your privacy and security."}}St(Dt,"SENSITIVE_FIELDS",["patientName","idNumber","cellPhone","email","address","emergencyContactName","emergencyContactNumber","accountHolderName","accountHolderIdNumber"]),St(Dt,"ENCRYPTION_PREFIX","enc:");const Im=(t,e,s)=>{const{migrated:r,warnings:n}=Oa(t),i=Dt.encryptSensitiveFields(r);return{preparedData:{...i,timestamp:new Date().toISOString(),createdAt:i.createdAt||new Date().toISOString(),synced:s,submissionId:`${i.regionCode||(e==null?void 0:e.code)||"UNK"}-${Date.now()}`,submissionStatus:"pending",status:"completed",formSchemaVersion:de},warnings:n}},$m=async(t,e,s,r,n,i,a)=>{const l=String(e.id||"new"),{saveForm:c,deleteForm:d,syncData:u,getForms:f,clearSession:m,capabilities:h,toast:p}=a,{completeSubmission:y,failSubmission:x,onOfflineSubmission:b,onOnlineSubmission:v}=i;try{console.log("Saving completed form...",{id:t.id,status:t.status,submissionStatus:t.submissionStatus,actuallyOnline:n,supabaseCapability:h.supabase});const w=await c(t,!1);if(console.log("Form saved successfully:",w),await ie.logSaveSuccess(l,!1,{formVersion:t.formSchemaVersion,encrypted:!0}),e.id&&r)try{console.log("Deleting draft form after successful submission...",e.id),await d(e.id,!0),console.log("Draft deleted successfully after submission")}catch(_){console.error("Draft deletion failed after submission (may not exist):",_)}return m(),console.log("Form session cleared after successful submission"),n?await Fm(t,l,s,y,h,u,p,v):await Mm(t,l,s,y,f,p,b)}catch(w){return console.error("Form submission error:",w),await ie.logSubmissionFailed(l,String(w),{formVersion:e.formSchemaVersion||1,region:s==null?void 0:s.code}),x&&x(),p({title:"Submission Error",description:"Failed to submit form. Please try again.",variant:"destructive"}),{success:!1,message:"Form submission failed"}}},Fm=async(t,e,s,r,n,i,a,l)=>{if(console.log("Processing ONLINE submission...",{supabaseCapability:n.supabase}),r&&r("submitted"),n.supabase)try{await i(),console.log("Post-submission sync completed"),await ie.logSubmissionSuccess(e,{formVersion:t.formSchemaVersion,region:s==null?void 0:s.code,synced:!0}),r&&r("synced")}catch(c){console.error("Post-submission sync failed:",c),await ie.logSubmissionFailed(e,`Sync failed: ${c}`,{formVersion:t.formSchemaVersion,submitted:!0,syncFailed:!0})}else await ie.logSubmissionSuccess(e,{formVersion:t.formSchemaVersion,region:s==null?void 0:s.code,synced:!1});return console.log("Triggering ONLINE success dialog..."),a({title:"Form Submitted",description:"Form submitted successfully to cloud database.",variant:"default"}),l&&setTimeout(()=>{l(t)},100),{success:!0,message:"Form submitted successfully"}},Mm=async(t,e,s,r,n,i,a)=>{console.log("Processing OFFLINE submission..."),await ie.logSubmissionQueued(e,{formVersion:t.formSchemaVersion,region:s==null?void 0:s.code}),r&&r("submitted");const c=(await n(!1)).filter(d=>d.submissionStatus==="pending"&&d.status==="completed");return console.log("Triggering OFFLINE submission dialog...",{pendingCount:c.length,currentForm:t.patientName}),i({title:"Form Queued",description:"Form queued for submission when online.",variant:"default"}),a&&setTimeout(()=>{a(t,c)},100),{success:!0,message:"Form queued for submission"}},Dm=({isOnline:t,onOfflineSubmission:e,onOnlineSubmission:s,onValidationErrors:r})=>{gt();const{toast:n}=He(),{saveForm:i,deleteForm:a,syncData:l,capabilities:c,getForms:d}=zt(),{clearSession:u}=Am();return{submitForm:async(m,h,p,y,x,b)=>{const v=String(m.id||"new");try{console.log("Processing form submission...",{formData:{patientName:m.patientName,idNumber:m.idNumber,cellPhone:m.cellPhone,consentAgreement:m.consentAgreement},isResuming:p,draftId:m.id}),await ie.logSubmissionStart(v,{formVersion:m.formSchemaVersion||1,region:h==null?void 0:h.code,isResuming:p});const{preparedData:w,warnings:_}=Im(m,h,!1);_.length>0&&_.forEach(k=>{n({title:"Form Updated",description:k,variant:"default"})});const j=Ea(w);if(!j.isValid)return console.log("Validation failed:",j.errors),await ie.logValidationFailed(v,j.errors,{formVersion:w.formSchemaVersion}),b&&b(),r&&r(j.errors),n({title:"Validation Error",description:"Please complete all required fields before submitting.",variant:"destructive"}),{success:!1,message:"Please fix validation errors before submitting"};console.log("Form validation passed, proceeding with submission..."),console.log("Checking real-time server connectivity...");const S=await hs();console.log("Server connectivity result:",S);const C={...w,synced:S};return await $m(C,m,h,p,S,{startSubmission:y,completeSubmission:x,failSubmission:b,onOfflineSubmission:e,onOnlineSubmission:s},{saveForm:i,deleteForm:a,syncData:l,getForms:d,clearSession:u,capabilities:c,toast:n})}catch(w){return console.error("Form submission error:",w),await ie.logSubmissionFailed(v,String(w),{formVersion:m.formSchemaVersion||1,region:h==null?void 0:h.code}),b&&b(),n({title:"Submission Error",description:"Failed to submit form. Please try again.",variant:"destructive"}),{success:!1,message:"Form submission failed"}}}}},Lm=t=>["patientName","idNumber","cellPhone","email","dateOfBirth","birthDate","address","emergencyContactName","emergencyContactNumber"].some(s=>{const r=t[s];return r&&typeof r=="string"&&r.trim().length>0}),Bm=()=>{const[t,e]=g.useState({}),[s,r]=g.useState(!1),[n,i]=g.useState("patientDetails"),[a,l]=g.useState([]),[c,d]=g.useState(0),u=g.useRef(!0),f=(v,w)=>{console.log(`Form field changed: ${v} = ${w}`),e(_=>{const j={..._,[v]:w,lastModified:new Date().toISOString(),formSchemaVersion:de};return Dt.isFieldSensitive(v)&&ie.logEvent("save.success",String(_.id||"new"),"info",`Updated sensitive field: ${v}`,{fieldName:v,fieldType:"sensitive"}),j}),u.current||r(!0)},m=(v,w,_)=>{console.log(`Checkbox changed: ${v} = ${_} (value: ${w})`);const j=_;e(S=>({...S,[v]:j,lastModified:new Date().toISOString(),formSchemaVersion:de})),u.current||r(!0)},h=g.useCallback(v=>{e(w=>({...w,regionCode:(v==null?void 0:v.code)||w.regionCode,region:(v==null?void 0:v.name)||w.region,doctor:(v==null?void 0:v.doctor)||w.doctor,practiceNumber:(v==null?void 0:v.practiceNumber)||w.practiceNumber,lastModified:new Date().toISOString(),formSchemaVersion:de}))},[]),p=g.useCallback(v=>{console.log("Setting form data:",{patientName:v.patientName,consentAgreement:v.consentAgreement,hasId:!!v.id});const w=Dt.decryptSensitiveFields(v),{migrated:_,warnings:j}=Oa(w);if(Tm(v.formSchemaVersion||1)){const S=Rm(v.formSchemaVersion||1);console.warn("Form version warning:",S)}j.length>0&&ie.logEvent("save.success",String(v.id||"unknown"),"warning",`Form migrated: ${j.join(", ")}`,{fromVersion:v.formSchemaVersion||1,toVersion:de,warnings:j}),e(_),u.current&&(u.current=!1)},[]),y=g.useCallback(()=>{},[]),x=g.useCallback(()=>"Just now",[]),b=g.useCallback((v=t)=>(console.log("Using comprehensive validation for form data"),Ea(v)),[t]);return{formData:t,setFormData:p,isDirty:s,setIsDirty:r,activeSection:n,setActiveSection:i,validationErrors:a,setValidationErrors:l,retryCount:c,setRetryCount:d,handleInputChange:f,handleCheckboxChange:m,updateFormDataWithRegion:h,hasMeaningfulContent:Lm,resetJustSaved:y,formatLastSaved:x,validateForm:b}},Um=()=>{const[t,e]=g.useState(!1),[s,r]=g.useState(""),[n,i]=g.useState(!1),[a,l]=g.useState(!1),[c,d]=g.useState(!1),[u,f]=g.useState(void 0),[m,h]=g.useState(void 0),[p,y]=g.useState([]);return{showSaveConfirmation:t,setShowSaveConfirmation:e,saveMessage:s,setSaveMessage:r,showOfflineDialog:n,setShowOfflineDialog:i,showOnlineSuccessDialog:a,setShowOnlineSuccessDialog:l,showOfflineSummaryDialog:c,setShowOfflineSummaryDialog:d,offlineFormData:u,setOfflineFormData:f,onlineFormData:m,setOnlineFormData:h,pendingForms:p,setPendingForms:y}},Hm=({isInitialized:t,getForms:e,setFormData:s,setSubmissionStatus:r,detectAndSetRegion:n})=>{const{draftId:i}=ro(),a=g.useRef(!1),l=g.useRef(null),c=g.useCallback(async()=>{if(!(!i||!t)){if(a.current&&l.current===i){console.log(`Draft ${i} already loaded, skipping reload`);return}try{console.log(`Loading draft ID: ${i}`);const u=(await e(!0)||[]).find(f=>String(f.id)===i);if(u){const f={...u,createdAt:u.createdAt||u.timestamp||new Date().toISOString(),submissionStatus:u.submissionStatus||"draft",formSchemaVersion:u.formSchemaVersion||1};if(s(f),r(f.submissionStatus),a.current=!0,l.current=i,console.log(`Successfully loaded draft ID ${i}`),u.regionCode){const m={code:u.regionCode,name:u.region||"Unknown",doctor:u.doctor||"Unknown",practiceNumber:u.practiceNumber||"Unknown"};await n(m)}}else console.warn(`Draft with ID ${i} not found`)}catch(d){console.error("Failed to load draft:",d)}}},[i,t,e,n,s,r]);return g.useEffect(()=>{c()},[c]),{isResuming:!!i,loadDraftById:c}};console.log("📌 useDraftLoader executing");const zm=({formData:t,currentRegion:e,draftId:s,saveForm:r,deleteForm:n,submitForm:i,hasMeaningfulContent:a,updateFormDataWithRegion:l,setIsDirty:c,setJustSaved:d,setRetryCount:u,startSubmission:f,completeSubmission:m,failSubmission:h,validateForm:p,setValidationErrors:y})=>({handleSave:async(w=!0)=>{try{if(!a(t)){console.log("Form has no meaningful content, skipping save");return}l(e);const _={...t,regionCode:(e==null?void 0:e.code)||t.regionCode,region:(e==null?void 0:e.name)||t.region,doctor:(e==null?void 0:e.doctor)||t.doctor,practiceNumber:(e==null?void 0:e.practiceNumber)||t.practiceNumber,createdAt:t.createdAt||new Date().toISOString(),lastModified:new Date().toISOString(),formSchemaVersion:1},j=await r(_,w);console.log("Form saved successfully:",j),c(!1),d(!0),setTimeout(()=>d(!1),2e3)}catch(_){console.error("Save failed:",_),u(j=>j+1)}},handleSubmit:async()=>{let w=!1;try{if(console.log("Starting form submission process..."),p&&y){const S=p(t);if(!S.isValid){console.log("Form validation failed:",S.errors),y(S.errors);return}y([])}if(w=f(),!w){console.log("Submission already in progress, aborting");return}const _=await hs();console.log("Connectivity check result:",_),l(e);const j={...t,regionCode:(e==null?void 0:e.code)||t.regionCode,region:(e==null?void 0:e.name)||t.region,doctor:(e==null?void 0:e.doctor)||t.doctor,practiceNumber:(e==null?void 0:e.practiceNumber)||t.practiceNumber,createdAt:t.createdAt||new Date().toISOString(),lastModified:new Date().toISOString(),formSchemaVersion:1};if(_)console.log("Online submission attempt"),await i(j,e,!!s,()=>!0,m,h);else{console.log("Offline - adding to submission queue");const S=await pm(j);console.log("Added to queue with ID:",S),m("submitted")}}catch(_){console.error("Form submission error:",_),w&&h()}},handleDiscard:async()=>{t.id&&await n(t.id,!0)}}),qm=()=>{const[t,e]=g.useState(!1),{saveForm:s,getForms:r,deleteForm:n,isInitialized:i,isOnline:a}=zt();g.useEffect(()=>{Yl(),bm()},[]);const{currentRegion:l,regionDetected:c,showManualSelector:d,isRegionFromDraft:u,isRegionDetected:f,detectAndSetRegion:m,setRegionManually:h}=Cm(),{submitting:p,submissionStatus:y,startSubmission:x,completeSubmission:b,failSubmission:v,setSubmissionStatus:w}=km(),{formData:_,setFormData:j,isDirty:S,setIsDirty:C,activeSection:k,setActiveSection:N,validationErrors:E,setValidationErrors:O,retryCount:A,setRetryCount:z,handleInputChange:B,handleCheckboxChange:W,updateFormDataWithRegion:F,hasMeaningfulContent:T,resetJustSaved:P,formatLastSaved:U,validateForm:K}=Bm(),G=Um(),{isResuming:Ze}=Hm({isInitialized:i,getForms:r,setFormData:j,setSubmissionStatus:w,detectAndSetRegion:m}),{submitForm:Ls}=Dm({isOnline:a,onOfflineSubmission:(ge,Yt)=>{G.setOfflineFormData(ge),G.setPendingForms(Yt),G.setShowOfflineSummaryDialog(!0)},onOnlineSubmission:ge=>{G.setOnlineFormData(ge),G.setShowOnlineSuccessDialog(!0)},onValidationErrors:ge=>{O(ge)}}),{handleSave:Bs,handleSubmit:Us,handleDiscard:Hs}=zm({formData:_,currentRegion:l,draftId:Ze?"draft":void 0,saveForm:s,deleteForm:n,submitForm:Ls,hasMeaningfulContent:T,updateFormDataWithRegion:F,setIsDirty:C,setJustSaved:e,setRetryCount:z,startSubmission:x,completeSubmission:b,failSubmission:v,validateForm:K,setValidationErrors:O}),Kt=g.useCallback(()=>K(_).isValid,[_,K]);return g.useEffect(()=>{!Ze&&i&&!l&&m()},[Ze,i,l,m]),{formData:_,handleInputChange:B,handleCheckboxChange:W,handleSave:Bs,handleSubmit:Us,handleDiscard:Hs,isDirty:S,justSaved:t,activeSection:k,setActiveSection:N,validationErrors:E||[],showValidationErrors:((E==null?void 0:E.length)||0)>0,isOnline:a,lastSaved:null,dbInitialized:i,retryCount:A,showManualSelector:d,setRegionManually:h,isRegionFromDraft:u,isRegionDetected:f,currentRegion:l,regionDetected:c,isResuming:Ze,resetJustSaved:P,formatLastSaved:U,submitting:p,submissionStatus:y,isFormComplete:Kt(),...G}},Vm=({currentRegion:t,regionDetected:e,isResuming:s})=>{const r=Pa();return console.log("ConsentFormHeader - Using dynamic icon path:",r),o.jsx("div",{className:"bg-[#ef4805] p-4",children:o.jsx("div",{className:"max-w-4xl mx-auto",children:o.jsx("div",{className:"bg-white p-3 inline-block rounded-lg",children:o.jsx("img",{src:r,alt:"Mia Healthcare",className:"h-16 w-auto",onError:n=>{console.error("ConsentFormHeader - Mia logo failed to load:",n),console.log("ConsentFormHeader - Attempted path:",n.currentTarget.src)},onLoad:()=>{console.log("ConsentFormHeader - Mia logo loaded successfully")}})})})})},Gm=({sections:t=[],currentSection:e})=>{const s=()=>t.length?(t.findIndex(n=>n.id===e)+1)/t.length*100:0;return o.jsx("div",{className:"w-full max-w-md mx-auto mt-4",children:o.jsx(Ms,{value:s(),className:"w-full"})})},Wm=({isOnline:t,currentRegion:e,isDirty:s,lastSaved:r,formatLastSaved:n,onSave:i,dbInitialized:a=!0,retryCount:l=0,onRegionSelect:c,isRegionFromDraft:d=!1,isRegionDetected:u=!1,showSaveConfirmation:f=!1,setSaveMessage:m,setShowSaveConfirmation:h})=>{const[p,y]=g.useState(!1),[x,b]=g.useState(!1),v=()=>t&&a?o.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[o.jsx(Cr,{className:"w-3 h-3 mr-1"}),"Cloud Storage Active"]}):a?o.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[o.jsx(ao,{className:"w-3 h-3 mr-1"}),"Local Storage Only"]}):o.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[o.jsx(io,{className:"w-3 h-3 mr-1"}),"Browser Storage Only"]}),w=async()=>{y(!0),b(!1);try{await i(),m&&m(t?"Draft saved to cloud":"Draft saved locally"),h&&h(!0),b(!0),setTimeout(()=>{b(!1),h&&h(!1)},3e3)}catch(_){console.error("Save failed:",_)}finally{y(!1)}};return o.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-3 mb-6 flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center space-x-4 flex-wrap gap-y-2",children:[o.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t?"Online":"Offline"}),v(),e&&c&&o.jsx(wa,{currentRegion:e,onRegionSelect:c,isFromDraft:d,isDetected:u}),s&&!x&&o.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[o.jsx(_s,{className:"w-3 h-3 mr-1"}),"Unsaved changes"]}),x&&o.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[o.jsx(he,{className:"w-3 h-3 mr-1"}),"Saved successfully"]}),r&&o.jsxs("span",{className:"text-xs text-gray-500",children:["Last saved: ",n()]})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{onClick:w,disabled:p,className:`flex items-center px-4 py-2 text-sm rounded-lg transition-colors ${p?"bg-gray-100 text-gray-400 cursor-not-allowed":x?"bg-green-100 text-green-700 hover:bg-green-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:p?o.jsxs(o.Fragment,{children:[o.jsx(un,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):x?o.jsxs(o.Fragment,{children:[o.jsx(he,{className:"w-4 h-4 mr-2"}),"Saved"]}):o.jsxs(o.Fragment,{children:[o.jsx(un,{className:"w-4 h-4 mr-2"}),"Save Progress"]})})})]})},Jm=({currentRegion:t,regionDetected:e,isResuming:s,children:r})=>o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"mb-6",children:[o.jsxs("h1",{className:"text-2xl font-bold text-[#ef4805] mb-2",children:["Mia Information and Consent Form ",(t==null?void 0:t.code)||"PTA",s&&o.jsx("span",{className:"text-lg text-gray-600 ml-2",children:"(Resumed)"})]}),o.jsxs("p",{className:"text-gray-600",children:[(t==null?void 0:t.doctor)||"Dr. Vorster"," Practice Number: ",(t==null?void 0:t.practiceNumber)||"1227831"]}),e&&t&&o.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Region: ",t.name," (",t.code,")"]})]}),o.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 mb-6",children:o.jsxs("p",{className:"text-sm text-gray-600",children:[o.jsx(_s,{className:"w-4 h-4 inline mr-1"}),"Your progress is automatically saved every 30 seconds. You can safely close and resume later."]})}),r]}),Km=({sections:t,activeSection:e,setActiveSection:s,onSave:r,onSubmit:n,submitting:i=!1,isFormComplete:a=!1})=>{const l=t.findIndex(m=>m.id===e),c=l===0,d=l===t.length-1,u=()=>{d||s(t[l+1].id)},f=()=>{c||s(t[l-1].id)};return o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center p-6 bg-white border-t",children:[o.jsx("div",{className:"w-full sm:w-auto",children:!c&&o.jsx(D,{onClick:f,variant:"outline",size:"lg",className:"w-full sm:w-auto",children:"Previous"})}),o.jsx("div",{className:"flex justify-center w-full sm:w-auto",children:(a||d)&&o.jsx(D,{onClick:n,disabled:i||!a,size:"lg",className:"bg-[#ef4805] hover:bg-[#d63d04] text-white flex items-center gap-2",children:i?o.jsxs(o.Fragment,{children:[o.jsx(ul,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):o.jsxs(o.Fragment,{children:[o.jsx(fl,{className:"w-4 h-4"}),"Submit Form"]})})}),o.jsx("div",{className:"w-full sm:w-auto",children:!d&&o.jsx(D,{onClick:u,size:"lg",className:"w-full sm:w-auto bg-[#ef4805] hover:bg-[#d63d04] text-white",children:"Next"})})]})},Ym=t=>["patientName","idNumber","cellPhone","email","dateOfBirth","birthDate","address","emergencyContactName","emergencyContactNumber"].some(s=>{const r=t[s];return r&&typeof r=="string"&&r.trim().length>0}),Xm=({isDirty:t,justSaved:e,formData:s,onSave:r,onDiscard:n,onResetJustSaved:i})=>{const a=gt(),l=()=>{const c=Ym(s);t&&!e&&c?r().then(()=>{a("/")}):a("/"),i()};return o.jsx(D,{onClick:l,variant:"outline",className:"mb-4",children:"← Back to Start"})},Qm=({onRegionSelect:t,currentRegion:e,isVisible:s})=>s?o.jsxs("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg border",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Select Your Region"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:Object.values(ut).map(r=>o.jsxs("button",{onClick:()=>t(r),className:`p-3 rounded border text-left ${(e==null?void 0:e.code)===r.code?"bg-blue-100 border-blue-500":"bg-white border-gray-300 hover:bg-gray-50"}`,children:[o.jsx("div",{className:"font-medium",children:r.name}),o.jsx("div",{className:"text-sm text-gray-600",children:r.doctor})]},r.code))})]}):null,Zm=({errors:t,isVisible:e})=>!e||t.length===0?null:o.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(nt,{className:"w-5 h-5 text-red-600"}),o.jsx("h3",{className:"text-sm font-semibold text-red-800",children:"Please fix the following errors before submitting:"})]}),o.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.map((s,r)=>o.jsx("li",{className:"text-sm text-red-700",children:s},r))})]}),ep=({id:t,title:e,isActive:s,onToggle:r,children:n})=>o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",onClick:()=>r(t),className:`w-full text-left p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors ${s?"bg-[#ef4805] text-white":"text-gray-700"}`,children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"font-medium",children:e}),s?o.jsx(ol,{className:"w-4 h-4"}):o.jsx(nl,{className:"w-4 h-4"})]})}),s&&o.jsx("div",{className:"p-6 space-y-6",children:n})]}),Ta=g.forwardRef(({className:t,type:e,...s},r)=>o.jsx("input",{type:e,className:L("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...s}));Ta.displayName="Input";var tp="Label",Ra=g.forwardRef((t,e)=>o.jsx(X.label,{...t,ref:e,onMouseDown:s=>{var n;s.target.closest("button, input, select, textarea")||((n=t.onMouseDown)==null||n.call(t,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Ra.displayName=tp;var Ia=Ra;const sp=js("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$a=g.forwardRef(({className:t,...e},s)=>o.jsx(Ia,{ref:s,className:L(sp(),t),...e}));$a.displayName=Ia.displayName;const rp=t=>{if(!t||t.trim()==="")return{isValid:!1,message:"Contact/WhatsApp number is required"};const e=t.replace(/\D/g,"");return e.length<10||e.length>15?{isValid:!1,message:"Contact/WhatsApp number must be 10-15 digits"}:/^[\d\s-()+]+$/.test(t)?{isValid:!0}:{isValid:!1,message:"Contact/WhatsApp number can only contain digits, spaces, dashes, parentheses, and plus sign"}},np=t=>!t||t.trim()===""?{isValid:!1,message:"Personal email is required"}:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)?["@company","@corp","@office",".local"].some(n=>t.toLowerCase().includes(n))?{isValid:!1,message:"Please use a personal email (gmail, yahoo, etc.) to avoid firewall restrictions"}:{isValid:!0}:{isValid:!1,message:"Please enter a valid personal email address"},M=({type:t,value:e,onChange:s,placeholder:r,required:n=!1,className:i="",label:a,onValidationChange:l,hasError:c=!1,disabled:d=!1})=>{const[u,f]=g.useState(""),[m,h]=g.useState(!1),p=_=>{if(!n&&!_.trim()){f(""),l==null||l(!0);return}let j;switch(t){case"phone":case"tel":j=rp(_);break;case"email":j=np(_);break;default:j={isValid:!0}}j.isValid?(f(""),l==null||l(!0)):(f(j.message||"Invalid input"),l==null||l(!1))};g.useEffect(()=>{m&&p(e)},[e,m]);const y=_=>{let j=_.target.value;(t==="phone"||t==="tel")&&(j=j.replace(/[^\d\s\-\(\)\+]/g,"")),s(j)},x=()=>{h(!0),p(e)},b=t==="phone"||t==="tel"?"tel":t==="email"?"email":t==="date"?"date":"text",v=u&&m||c&&n&&!e.trim(),w=u||(c&&n&&!e.trim()?"This field is required.":"");return o.jsxs("div",{className:"space-y-2",children:[a&&o.jsx($a,{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:a}),o.jsx(Ta,{id:a,type:b,value:e,onChange:y,onBlur:x,placeholder:r,disabled:d,className:`${i} ${v?"border-red-500 focus-visible:ring-red-500":""} ${d?"opacity-60 cursor-not-allowed":""}`}),v&&o.jsx("p",{className:"text-sm text-red-600",children:w})]})},op=({formData:t,updateFormData:e,validationErrors:s,onInputChange:r})=>{const n=c=>s.some(d=>d.toLowerCase().includes(c.toLowerCase())),i=c=>{e({gender:c}),c!=="Other"&&e({otherGenderText:""})},a=c=>{e({sameAsContactNumber:c}),e(c?{whatsappNumber:t.cellPhone||""}:{whatsappNumber:""})},l=c=>{e({cellPhone:c}),t.sameAsContactNumber&&e({whatsappNumber:c})};return o.jsxs("div",{className:"space-y-6 p-6",children:[o.jsx("h2",{className:"text-xl font-semibold text-[#ef4805] border-b pb-2",children:"1. Patient Details (Fields 1-12)"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(M,{type:"text",label:"1. Patient Name *",value:t.patientName||"",onChange:c=>e({patientName:c}),placeholder:"Enter full name",required:!0,hasError:n("patient name")}),o.jsx(M,{type:"text",label:"2. Age *",value:t.age||"",onChange:c=>e({age:c}),placeholder:"Enter age",required:!0,hasError:n("age")}),o.jsx(M,{type:"date",label:"3. Birth Date *",value:t.birthDate||"",onChange:c=>e({birthDate:c}),required:!0,hasError:n("birth date")}),o.jsx(M,{type:"text",label:"4. ID No. *",value:t.idNumber||"",onChange:c=>e({idNumber:c}),placeholder:"Enter ID number",required:!0,hasError:n("id number")}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"5. Marital Status"}),o.jsx("div",{className:"space-y-2",children:["Single","Married","Divorced","Widowed"].map(c=>o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"maritalStatus",value:c,checked:t.maritalStatus===c,onChange:d=>e({maritalStatus:d.target.value}),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:c})]},c))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"6. Gender *"}),o.jsx("div",{className:"space-y-2",children:["Male","Female","Prefer not to say","Other"].map(c=>o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"gender",value:c,checked:t.gender===c,onChange:d=>i(d.target.value),className:"mr-2",required:!0}),o.jsx("span",{className:"text-sm",children:c})]},c))}),t.gender==="Other"&&o.jsx(M,{type:"text",label:"",value:t.otherGenderText||"",onChange:c=>e({otherGenderText:c}),placeholder:"Please specify",className:"mt-2"}),n("gender")&&o.jsx("p",{className:"text-red-500 text-xs mt-1",children:"This field is required."})]}),o.jsx(M,{type:"text",label:"7. Employer/School",value:t.employerSchool||"",onChange:c=>e({employerSchool:c}),placeholder:"Enter employer or school name"}),o.jsx(M,{type:"text",label:"8. Occupation/Grade",value:t.occupationGrade||"",onChange:c=>e({occupationGrade:c}),placeholder:"Enter occupation or grade"}),o.jsx(M,{type:"tel",label:"9. Contact Number *",value:t.cellPhone||"",onChange:l,placeholder:"Enter contact number",required:!0,hasError:n("contact number")||n("cell phone")}),o.jsxs("div",{children:[o.jsx(M,{type:"tel",label:"9b. WhatsApp Number *",value:t.whatsappNumber||"",onChange:c=>e({whatsappNumber:c}),placeholder:"Enter WhatsApp number",required:!0,disabled:t.sameAsContactNumber,hasError:n("whatsapp number")}),o.jsxs("label",{className:"flex items-center mt-2",children:[o.jsx("input",{type:"checkbox",checked:t.sameAsContactNumber||!1,onChange:c=>a(c.target.checked),className:"mr-2"}),o.jsx("span",{className:"text-sm text-gray-600",children:"Same as Contact Number"})]})]}),o.jsx(M,{type:"email",label:"10. Personal Email (not work email) *",value:t.email||"",onChange:c=>e({email:c}),placeholder:"example@gmail.com, example@yahoo.com (personal only)",required:!0,hasError:n("email")||n("personal email")}),o.jsx("div",{className:"md:col-span-2",children:o.jsx(M,{type:"text",label:"11. Address *",value:t.address||"",onChange:c=>e({address:c}),placeholder:"Enter full address",required:!0,hasError:n("address")})}),o.jsx(M,{type:"text",label:"12. Address Postal Code",value:t.postalCode||"",onChange:c=>e({postalCode:c}),placeholder:"Enter postal code"})]})]})},ip=({formData:t,onInputChange:e,updateFormData:s=()=>{},validationErrors:r=[]})=>{const n=c=>{e("responsibleForPayment",c),c==="Myself"&&Object.entries({accountHolderName:"",accountHolderAge:"",accountHolderIdNumber:"",accountHolderMaritalStatus:"",accountHolderGender:"",accountHolderOtherGenderText:"",accountHolderEmployer:"",accountHolderOccupation:"",accountHolderCellPhone:"",accountHolderEmail:"",sameAddress:"",accountHolderAddress:"",accountHolderPostalCode:""}).forEach(([u,f])=>{e(u,f)})},i=c=>{e("accountHolderGender",c),c!=="Other"&&e("accountHolderOtherGenderText","")},a=c=>{e("sameAddress",c),c==="Yes"?(e("accountHolderAddress",t.address||""),e("accountHolderPostalCode",t.postalCode||"")):c==="No"&&(e("accountHolderAddress",""),e("accountHolderPostalCode",""))},l=t.responsibleForPayment==="Parent/Main member/Someone else";return o.jsxs("div",{className:"space-y-6 p-6",children:[o.jsx("h2",{className:"text-xl font-semibold text-[#ef4805] border-b pb-2",children:"2. Account Holder Details"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"13. Person Responsible for Account Payment *"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"responsibleForPayment",value:"Parent/Main member/Someone else",checked:t.responsibleForPayment==="Parent/Main member/Someone else",onChange:c=>n(c.target.value),className:"mr-2",required:!0}),o.jsx("span",{className:"text-sm",children:"Parent/Main member/Someone else"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"responsibleForPayment",value:"Myself",checked:t.responsibleForPayment==="Myself",onChange:c=>n(c.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Myself"})]})]})]}),l&&o.jsx("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:o.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[o.jsx(M,{type:"text",label:"14. Name and Surname",value:t.accountHolderName||"",onChange:c=>e("accountHolderName",c),placeholder:"Enter full name"}),o.jsx(M,{type:"text",label:"15. Age",value:t.accountHolderAge||"",onChange:c=>e("accountHolderAge",c),placeholder:"Enter age"}),o.jsx(M,{type:"text",label:"16. ID No.",value:t.accountHolderIdNumber||"",onChange:c=>e("accountHolderIdNumber",c),placeholder:"Enter ID number"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"17. Marital Status"}),o.jsx("div",{className:"space-y-2",children:["Single","Married","Divorced","Widowed"].map(c=>o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"accountHolderMaritalStatus",value:c,checked:t.accountHolderMaritalStatus===c,onChange:d=>e("accountHolderMaritalStatus",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:c})]},c))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"18. Gender"}),o.jsx("div",{className:"space-y-2",children:["Male","Female","Prefer not to say","Other"].map(c=>o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"accountHolderGender",value:c,checked:t.accountHolderGender===c,onChange:d=>i(d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:c})]},c))}),t.accountHolderGender==="Other"&&o.jsx(M,{type:"text",label:"",value:t.accountHolderOtherGenderText||"",onChange:c=>e("accountHolderOtherGenderText",c),placeholder:"Please specify",className:"mt-2"})]}),o.jsx(M,{type:"text",label:"19. Employer",value:t.accountHolderEmployer||"",onChange:c=>e("accountHolderEmployer",c),placeholder:"Enter employer"}),o.jsx(M,{type:"text",label:"20. Occupation",value:t.accountHolderOccupation||"",onChange:c=>e("accountHolderOccupation",c),placeholder:"Enter occupation"}),o.jsx(M,{type:"tel",label:"21. Cell Phone No.",value:t.accountHolderCellPhone||"",onChange:c=>e("accountHolderCellPhone",c),placeholder:"Enter cell phone number"}),o.jsx(M,{type:"email",label:"22. Email",value:t.accountHolderEmail||"",onChange:c=>e("accountHolderEmail",c),placeholder:"Enter email address"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"23. Same Address as Patient?"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"sameAddress",value:"Yes",checked:t.sameAddress==="Yes",onChange:c=>a(c.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Yes"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"sameAddress",value:"No",checked:t.sameAddress==="No",onChange:c=>a(c.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"No"})]})]})]}),o.jsx("div",{})," ",o.jsx("div",{className:"md:col-span-2",children:o.jsx(M,{type:"text",label:"23. Address",value:t.accountHolderAddress||"",onChange:c=>e("accountHolderAddress",c),placeholder:"Enter full address"})}),o.jsx(M,{type:"text",label:"24. Address Postal Code",value:t.accountHolderPostalCode||"",onChange:c=>e("accountHolderPostalCode",c),placeholder:"Enter postal code"})]})})]})},ap=({formData:t,onInputChange:e})=>{const s=n=>{e("paymentPreference",n),n!=="Medical Aid"&&["medicalAidName","medicalAidNo","medicalAidPlan","mainMember","dependantCode"].forEach(a=>e(a,""))},r=t.paymentPreference==="Medical Aid";return o.jsxs("div",{className:"space-y-6 p-6",children:[o.jsx("h2",{className:"text-xl font-semibold text-[#ef4805] border-b pb-2",children:"3. Payment and Emergency Contact"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"25. Payment Preference"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"paymentPreference",value:"Card/EFT/Snapcan",checked:t.paymentPreference==="Card/EFT/Snapcan",onChange:n=>s(n.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Card/EFT/Snapcan"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"paymentPreference",value:"Medical Aid",checked:t.paymentPreference==="Medical Aid",onChange:n=>s(n.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Medical Aid"})]})]})]}),r&&o.jsx("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:o.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[o.jsx(M,{type:"text",label:"26. Medical Aid Name *",value:t.medicalAidName||"",onChange:n=>e("medicalAidName",n),placeholder:"Enter medical aid name",required:!0}),o.jsx(M,{type:"text",label:"27. Medical Aid No. *",value:t.medicalAidNo||"",onChange:n=>e("medicalAidNo",n),placeholder:"Enter medical aid number",required:!0}),o.jsx(M,{type:"text",label:"28. Plan *",value:t.medicalAidPlan||"",onChange:n=>e("medicalAidPlan",n),placeholder:"Enter plan name",required:!0}),o.jsx(M,{type:"text",label:"29. Main Member *",value:t.mainMember||"",onChange:n=>e("mainMember",n),placeholder:"Enter main member name",required:!0}),o.jsx(M,{type:"text",label:"30. Dependant Code (if applicable)",value:t.dependantCode||"",onChange:n=>e("dependantCode",n),placeholder:"Enter dependant code"})]})}),o.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[o.jsx(M,{type:"text",label:"31. Emergency Contact Name and Surname *",value:t.emergencyName||"",onChange:n=>e("emergencyName",n),placeholder:"Enter emergency contact name",required:!0}),o.jsx(M,{type:"text",label:"32. Relationship *",value:t.emergencyRelationship||"",onChange:n=>e("emergencyRelationship",n),placeholder:"Enter relationship",required:!0}),o.jsx(M,{type:"tel",label:"33. Emergency WhatsApp Number *",value:t.emergencyPhone||"",onChange:n=>e("emergencyPhone",n),placeholder:"Enter WhatsApp number",required:!0})]})]})},lp=({formData:t,onInputChange:e,onCheckboxChange:s})=>{const r=(h,p)=>{p?e(h,"Nil"):e(h,"")},n=(h,p)=>{let y=[];t.chronicConditions&&(typeof t.chronicConditions=="string"?y=t.chronicConditions.split(", ").filter(x=>x.trim()):Array.isArray(t.chronicConditions)&&(y=[...t.chronicConditions])),p?h==="None"?e("chronicConditions","None"):(y=y.filter(x=>x!=="None"),y.includes(h)||y.push(h),e("chronicConditions",y.join(", "))):h==="None"?e("chronicConditions",""):(y=y.filter(x=>x!==h),e("chronicConditions",y.length>0?y.join(", "):""))},i=(h,p)=>{let y=[];t.habits&&(typeof t.habits=="string"?y=t.habits.split(", ").filter(x=>x.trim()):Array.isArray(t.habits)&&(y=[...t.habits])),p?h==="Nil"?e("habits","Nil"):(y=y.filter(x=>x!=="Nil"),y.includes(h)||y.push(h),e("habits",y.join(", "))):h==="Nil"?e("habits",""):(y=y.filter(x=>x!==h),e("habits",y.length>0?y.join(", "):""))},a=(h,p)=>{let y=[];t.femalePatients&&(typeof t.femalePatients=="string"?y=t.femalePatients.split(", ").filter(x=>x.trim()):Array.isArray(t.femalePatients)&&(y=[...t.femalePatients])),p?h==="N/A"?e("femalePatients","N/A"):(y=y.filter(x=>x!=="N/A"),y.includes(h)||y.push(h),e("femalePatients",y.join(", "))):h==="N/A"?e("femalePatients",""):(y=y.filter(x=>x!==h),e("femalePatients",y.length>0?y.join(", "):""))},l=["Alzheimers","Anaemia","Arthritis","Asthma/Lung Disease","Bleeding Disorders","On warfarin/Aspirin or anticoagulants","Cancer Treatment","Diabetes","Dizziness/Fainting Spells","Epilepsy","Rheumatic Fever","Heart Disease","High/low Blood Pressure","Hepatitis/Liver Disease","HIV/Aids","Sinusitis","Ulcers","Other"],c=["Smoking","Alcohol","Recreational Drugs","Other"],d=["Pregnant","Nursing","On Birth Control","On Hormone Replacement Therapy"],u=typeof t.chronicConditions=="string"?t.chronicConditions.split(", ").filter(h=>h):Array.isArray(t.chronicConditions)?t.chronicConditions:[],f=typeof t.habits=="string"?t.habits.split(", ").filter(h=>h):Array.isArray(t.habits)?t.habits:[],m=typeof t.femalePatients=="string"?t.femalePatients.split(", ").filter(h=>h):Array.isArray(t.femalePatients)?t.femalePatients:[];return o.jsxs("div",{className:"space-y-6 p-6",children:[o.jsx("h2",{className:"text-xl font-semibold text-[#ef4805] border-b pb-2",children:"4. Medical History"}),o.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[o.jsx(M,{type:"text",label:"34. GP's Name (optional)",value:t.gpName||"",onChange:h=>e("gpName",h),placeholder:"Enter GP's name"}),o.jsx(M,{type:"tel",label:"35. GP's Contact No. (optional)",value:t.gpContact||"",onChange:h=>e("gpContact",h),placeholder:"Enter GP's contact number"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"36. Chronic Conditions"}),o.jsx("div",{className:"grid md:grid-cols-2 gap-2 mb-2",children:l.map(h=>o.jsxs("label",{className:"flex items-center space-x-2",children:[o.jsx(ne,{id:`chronic-${h}`,checked:u.includes(h),onCheckedChange:p=>n(h,p===!0)}),o.jsx("span",{className:"text-sm",children:h})]},h))}),o.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[o.jsx(ne,{id:"noChronicConditions",checked:t.chronicConditions==="None",onCheckedChange:h=>n("None",h===!0)}),o.jsx("label",{htmlFor:"noChronicConditions",className:"text-sm text-gray-600",children:"No chronic conditions"})]})]}),o.jsxs("div",{children:[o.jsx(M,{type:"text",label:"37. Allergies *",value:t.allergies||"",onChange:h=>e("allergies",h),placeholder:"Please answer 'Nil' if you have no allergies",required:!0}),o.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[o.jsx(ne,{id:"nilAllergies",checked:t.allergies==="Nil",onCheckedChange:h=>r("allergies",h===!0)}),o.jsx("label",{htmlFor:"nilAllergies",className:"text-sm text-gray-600",children:"No allergies (Nil)"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"38. Habits/Substance Abuse *"}),o.jsx("div",{className:"grid md:grid-cols-2 gap-2 mb-2",children:c.map(h=>o.jsxs("label",{className:"flex items-center space-x-2",children:[o.jsx(ne,{id:`habit-${h}`,checked:f.includes(h),onCheckedChange:p=>i(h,p===!0)}),o.jsx("span",{className:"text-sm",children:h})]},h))}),o.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[o.jsx(ne,{id:"nilHabits",checked:t.habits==="Nil",onCheckedChange:h=>i("Nil",h===!0)}),o.jsx("label",{htmlFor:"nilHabits",className:"text-sm text-gray-600",children:"Nil"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"39. Under Specialist Care"}),o.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ef4805] focus:border-transparent",value:t.specialistCare||"",onChange:h=>e("specialistCare",h.target.value),placeholder:"If yes, please add a short description",rows:3})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"40. Hospitalised This Year"}),o.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ef4805] focus:border-transparent",value:t.hospitalised||"",onChange:h=>e("hospitalised",h.target.value),placeholder:"If yes, please add a short description",rows:3})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"41. Psychiatric History"}),o.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ef4805] focus:border-transparent",value:t.psychiatricHistory||"",onChange:h=>e("psychiatricHistory",h.target.value),placeholder:"Please provide details if applicable",rows:3})]}),o.jsxs("div",{children:[o.jsx(M,{type:"text",label:"42. Medication *",value:t.medication||"",onChange:h=>e("medication",h),placeholder:"Please answer 'Nil' if you are not on any medication",required:!0}),o.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[o.jsx(ne,{id:"nilMedication",checked:t.medication==="Nil",onCheckedChange:h=>r("medication",h===!0)}),o.jsx("label",{htmlFor:"nilMedication",className:"text-sm text-gray-600",children:"No medication (Nil)"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"43. Female Patients"}),o.jsx("div",{className:"grid md:grid-cols-2 gap-2 mb-2",children:d.map(h=>o.jsxs("label",{className:"flex items-center space-x-2",children:[o.jsx(ne,{id:`female-${h}`,checked:m.includes(h),onCheckedChange:p=>a(h,p===!0)}),o.jsx("span",{className:"text-sm",children:h})]},h))}),o.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[o.jsx(ne,{id:"naFemale",checked:t.femalePatients==="N/A",onCheckedChange:h=>a("N/A",h===!0)}),o.jsx("label",{htmlFor:"naFemale",className:"text-sm text-gray-600",children:"N/A"})]})]})]})},cp=({formData:t,onInputChange:e,updateFormData:s=()=>{},validationErrors:r})=>{const[n,i]=g.useState(!1),a=g.useRef(null);g.useEffect(()=>{const d=a.current;if(!d)return;const u=()=>{d.scrollTop+d.clientHeight>=d.scrollHeight-5&&i(!0)};return d.addEventListener("scroll",u),setTimeout(()=>{d.scrollHeight<=d.clientHeight+5&&i(!0)},200),()=>d.removeEventListener("scroll",u)},[]);const l=(d,u)=>{e&&e(d,u),d==="terms"&&u==="Agree"&&s({consentAgreement:!0})},c=r&&r.length>0;return o.jsxs("div",{className:"space-y-6 p-6",children:[o.jsx("h2",{className:"text-xl font-semibold text-[#ef4805] border-b pb-2",children:"5. Consent"}),c&&o.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[o.jsx("p",{className:"text-red-800 font-medium",children:"Please complete the following:"}),o.jsx("ul",{className:"list-disc list-inside text-red-700 text-sm mt-2",children:r==null?void 0:r.map((d,u)=>o.jsx("li",{children:d},u))})]}),o.jsxs("details",{className:"mb-4 border border-gray-300 rounded",children:[o.jsx("summary",{className:"cursor-pointer p-3 bg-gray-100 font-medium",children:"View MIA Consent Form"}),o.jsxs("div",{ref:a,className:"max-h-72 overflow-y-scroll p-4 border-t border-gray-300 text-sm space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-orange-600",children:"MIA Consent Form Contents"}),o.jsx("p",{children:"1. I, the undersigned, hereby give my voluntary consent for dental examination, diagnosis and treatment as deemed necessary by the dental professional in attendance."}),o.jsx("p",{children:"2. I understand that dental treatment may involve procedures such as cleaning, scaling, polishing, and the use of diagnostic tools including X-rays or photos."}),o.jsx("p",{children:"3. I understand the nature and purpose of the treatment and acknowledge that no guarantees or assurances have been made to me concerning the results of the procedure."}),o.jsx("p",{children:"4. I understand that there may be risks and complications associated with dental treatment, including but not limited to sensitivity, discomfort, and allergic reactions."}),o.jsx("p",{children:"5. I confirm that I have disclosed all relevant medical history and current medications."}),o.jsx("p",{children:"6. I understand that the dental provider may refer me for further treatment if necessary, and that this referral may incur additional costs not covered during the screening."}),o.jsx("p",{children:"7. I acknowledge that I have the right to ask questions and that I may withdraw my consent at any time before or during the treatment."}),o.jsx("p",{children:"8. I give consent for my dental records to be shared with other healthcare professionals if needed for further treatment or referral."}),o.jsx("p",{children:"9. I understand the confidentiality of my health information and consent to the collection and use of this information for medical and administrative purposes."}),o.jsx("p",{children:"10. I confirm that I have read and understood the information above, and that I am signing this consent voluntarily and without coercion."})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"44. I have read and agree with terms and conditions provided in the document"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"terms",value:"Agree",checked:(t==null?void 0:t.terms)==="Agree",onChange:d=>l("terms",d.target.value),className:"mr-2",disabled:!n}),o.jsx("span",{className:"text-sm",children:"Agree"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"terms",value:"Disagree",checked:(t==null?void 0:t.terms)==="Disagree",onChange:d=>l("terms",d.target.value),className:"mr-2",disabled:!n}),o.jsx("span",{className:"text-sm",children:"Disagree"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"45. My consent is provided of my own free will without any undue influence from any person whatsoever. I confirm that I have permission of my dependant(s) to give their consent, where such consent has been provided, and I indemnify the practice against this."}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"consentFreeWill",value:"Agree",checked:(t==null?void 0:t.consentFreeWill)==="Agree",onChange:d=>l("consentFreeWill",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Agree"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"consentFreeWill",value:"Disagree",checked:(t==null?void 0:t.consentFreeWill)==="Disagree",onChange:d=>l("consentFreeWill",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Disagree"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"46. I acknowledge that I have been informed that this practice does not charge the rates that the Department of Health has unilaterally determined for dentists"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"rates",value:"Agree",checked:(t==null?void 0:t.rates)==="Agree",onChange:d=>l("rates",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Agree"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"rates",value:"Disagree",checked:(t==null?void 0:t.rates)==="Disagree",onChange:d=>l("rates",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Disagree"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"47. I accept that I am fully responsible for the payment for services rendered and should I not pay timeously, understand that I will be liable for debt recovery cost on an attorney and own client scale."}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"paymentResponsibility",value:"Agree",checked:(t==null?void 0:t.paymentResponsibility)==="Agree",onChange:d=>l("paymentResponsibility",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Agree"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"paymentResponsibility",value:"Disagree",checked:(t==null?void 0:t.paymentResponsibility)==="Disagree",onChange:d=>l("paymentResponsibility",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Disagree"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"48. Do we have your permission to place our positive commentary and non-treatment related photographs on our website/social media? (Optional)"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"mediaPermission",value:"Yes",checked:(t==null?void 0:t.mediaPermission)==="Yes",onChange:d=>l("mediaPermission",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Yes"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"mediaPermission",value:"No",checked:(t==null?void 0:t.mediaPermission)==="No",onChange:d=>l("mediaPermission",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"No"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"49. Cancellation Policy Acknowledgment"}),o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Please note that Mia Healthcare charges a cancellation fee of R200.00 for appointments canceled less than 12 hours before the scheduled time. For cancellations made less than 2 hours before the appointment, the fee will be up to 50% of the consultation or service fee. Cancellations can be made by calling our offices or using the cancellation links provided in our communications. Late cancellations are reviewed according to ethical guidelines, and reasonable cancellations may be honored without charge."}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"cancellationPolicy",value:"Acknowledge cancellation policy",checked:(t==null?void 0:t.cancellationPolicy)==="Acknowledge cancellation policy",onChange:d=>l("cancellationPolicy",d.target.value),className:"mr-2"}),o.jsx("span",{className:"text-sm",children:"Acknowledge cancellation policy"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"50. Background Music Preference (Optional)"}),o.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ef4805] focus:border-transparent",value:(t==null?void 0:t.musicPreference)||"",onChange:d=>e&&e("musicPreference",d.target.value),placeholder:"Let us know your favourite artist/song or attach a link to your favourite playlist",rows:3})]}),o.jsx(M,{type:"text",label:"51. Please enter your full name and surname followed by the date",value:(t==null?void 0:t.signature)||"",onChange:d=>e&&e("signature",d),placeholder:"Enter your full name and date"})]}),!n&&o.jsx("p",{className:"text-red-500 text-sm mt-2",children:"Please scroll to the bottom of the consent form to enable the agreement options."}),(t==null?void 0:t.terms)==="Agree"&&n&&o.jsx("p",{className:"text-green-600 text-sm mt-2 font-medium",children:"✓ Consent terms accepted! Please complete all other required consent questions."})]})},nn=()=>({sections:g.useMemo(()=>[{id:"patientDetails",title:"1. Patient Details (Fields 1-12)",component:op},{id:"accountHolder",title:"2. Account Holder Details (Fields 13-24)",component:ip},{id:"paymentEmergency",title:"3. Payment and Emergency Contact (Fields 25-33)",component:ap},{id:"medicalHistory",title:"4. Medical History (Fields 34-43)",component:lp},{id:"consent",title:"5. Consent (Fields 44-51)",component:cp}],[])}),dp=({activeSection:t,formData:e,handleInputChange:s,handleCheckboxChange:r,validationErrors:n})=>{const{sections:i}=nn(),a=c=>{Object.keys(c).forEach(d=>{const u=c[d];typeof u=="string"&&s(d,u)})},l=()=>{const c=i.find(u=>u.id===t);if(!c)return null;const d=c.component;return c.id==="patientDetails"?o.jsx(d,{formData:e,updateFormData:a,validationErrors:n,onInputChange:s,onCheckboxChange:r}):o.jsx(d,{formData:e,updateFormData:a,validationErrors:n,onInputChange:s,onCheckboxChange:r})};return o.jsx(o.Fragment,{children:l()})},up=({activeSection:t,setActiveSection:e,formData:s,handleInputChange:r,handleCheckboxChange:n,validationErrors:i})=>{const{sections:a}=nn();return o.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:o.jsx("div",{className:"border-b border-gray-200",children:a.map(l=>o.jsx(ep,{id:l.id,title:l.title,isActive:t===l.id,onToggle:e,children:t===l.id&&o.jsx(dp,{activeSection:t,formData:s,handleInputChange:r,handleCheckboxChange:n,validationErrors:i})},l.id))})})},hp=({status:t,isSubmitting:e=!1})=>{if(e)return o.jsxs(Re,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-300",children:[o.jsx(lo,{className:"w-3 h-3 mr-1 animate-spin"}),"Submitting..."]});switch(t){case"draft":return o.jsxs(Re,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-300",children:[o.jsx(_s,{className:"w-3 h-3 mr-1"}),"Draft"]});case"pending":return o.jsxs(Re,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-300",children:[o.jsx(Ye,{className:"w-3 h-3 mr-1"}),"Pending Sync"]});case"submitted":return o.jsxs(Re,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300",children:[o.jsx(he,{className:"w-3 h-3 mr-1"}),"Submitted"]});case"synced":return o.jsxs(Re,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-300",children:[o.jsx(he,{className:"w-3 h-3 mr-1"}),"Synced"]});default:return null}},fp=({currentRegion:t,regionDetected:e,isResuming:s,activeSection:r,setActiveSection:n,formData:i,handleInputChange:a,handleCheckboxChange:l,isDirty:c,justSaved:d,onSave:u,onSubmit:f,onDiscard:m,onResetJustSaved:h,isOnline:p,lastSaved:y,formatLastSaved:x,dbInitialized:b,retryCount:v,showManualSelector:w,setRegionManually:_,isRegionFromDraft:j,isRegionDetected:S,validationErrors:C=[],showValidationErrors:k,submitting:N=!1,submissionStatus:E="draft",isFormComplete:O=!1})=>{const{sections:A}=nn();return o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx(Vm,{currentRegion:t,regionDetected:e,isResuming:s}),o.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[o.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[o.jsx(Xm,{isDirty:c,justSaved:d,formData:i,onSave:u,onDiscard:m,onResetJustSaved:h}),o.jsx(hp,{status:E,isSubmitting:N})]}),o.jsx(Qm,{onRegionSelect:_,currentRegion:t,isVisible:w}),o.jsx(Gm,{currentSection:r,sections:A||[]}),o.jsx(Wm,{isOnline:p,currentRegion:t,isDirty:c,lastSaved:y,formatLastSaved:x,onSave:u,dbInitialized:b,retryCount:v,onRegionSelect:_,isRegionFromDraft:j,isRegionDetected:S}),o.jsx(Zm,{errors:C||[],isVisible:k&&((C==null?void 0:C.length)||0)>0}),o.jsx(up,{activeSection:r,setActiveSection:n,formData:i,handleInputChange:a,handleCheckboxChange:l,validationErrors:C||[]}),o.jsx(Jm,{currentRegion:t,regionDetected:e,isResuming:s,children:o.jsx(Km,{sections:A||[],activeSection:r,setActiveSection:n,onSave:u,onSubmit:f,submitting:N,isFormComplete:O})})]})]})},mp=({show:t,message:e,duration:s=3e3,isOnline:r=!1})=>{const{toast:n}=He();if(g.useEffect(()=>{if(t){const d=()=>r?"Draft saved to cloud":"Draft saved locally",u=()=>r?"Your draft has been saved to the cloud database":"Your draft has been saved locally and will sync when online";n({title:d(),description:u(),duration:s})}},[t,e,s,r,n]),!t)return null;const i=()=>r?o.jsx(Cr,{className:"w-6 h-6 text-green-600"}):o.jsx(ao,{className:"w-6 h-6 text-blue-600"}),a=()=>r?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200",l=()=>r?"text-green-900":"text-blue-900",c=()=>r?"text-green-700":"text-blue-700";return o.jsx("div",{className:`fixed top-4 right-4 z-50 ${a()} rounded-lg p-4 shadow-lg border-2 animate-fade-in`,children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"flex-shrink-0",children:i()}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(he,{className:"w-5 h-5 text-green-500"}),o.jsx("p",{className:`font-semibold ${l()}`,children:"Draft Saved Successfully"})]}),o.jsx("p",{className:`text-sm mt-1 ${c()}`,children:r?"Saved to cloud database":"Saved locally - will sync when online"})]})]})})},pp=({isOpen:t,onClose:e,formData:s})=>o.jsx(Ts,{open:t,onOpenChange:e,children:o.jsxs(qt,{className:"sm:max-w-md",children:[o.jsx(Vt,{children:o.jsxs(Gt,{className:"flex items-center gap-2 text-green-600",children:[o.jsx(he,{className:"w-6 h-6"}),"Form Captured Successfully"]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"text-center space-y-2",children:[o.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[o.jsx(lo,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),o.jsx("p",{className:"text-sm text-green-800 font-medium",children:"Your consent form has been saved locally"})]}),(s==null?void 0:s.patientName)&&o.jsxs("p",{className:"text-sm text-gray-600",children:["Patient: ",o.jsx("span",{className:"font-medium",children:s.patientName})]}),(s==null?void 0:s.submissionId)&&o.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.submissionId]})]}),o.jsxs("div",{className:"border-t pt-4 space-y-3",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600",children:[o.jsx(co,{className:"w-4 h-4"}),o.jsx("span",{children:"Currently offline"})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:[o.jsx("p",{className:"font-medium mb-1",children:"What happens next:"}),o.jsxs("ul",{className:"space-y-1 text-xs",children:[o.jsx("li",{children:"• Form is safely stored on this device"}),o.jsx("li",{children:"• Will automatically upload when internet connection is restored"}),o.jsx("li",{children:"• You can continue working with other forms"}),o.jsx("li",{children:'• Check "Pending Upload" section for sync status'})]})]})]}),o.jsx(D,{onClick:e,className:"w-full",children:"Continue"})]})]})}),gp=({isOpen:t,onClose:e,formData:s})=>{const r=gt(),n=()=>{console.log("OnlineSuccessDialog: Closing and navigating to home"),e(),r("/")};return o.jsx(Ts,{open:t,onOpenChange:n,children:o.jsxs(qt,{className:"sm:max-w-md",children:[o.jsx(Vt,{children:o.jsxs(Gt,{className:"flex items-center gap-2 text-green-600",children:[o.jsx(he,{className:"w-6 h-6"}),"Form Successfully Uploaded to Cloud"]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"text-center space-y-2",children:[o.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[o.jsx(Cr,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),o.jsx("p",{className:"text-sm text-green-800 font-medium",children:"Your consent form has been successfully uploaded to the cloud database"})]}),(s==null?void 0:s.patientName)&&o.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:["Patient: ",s.patientName]}),(s==null?void 0:s.submissionId)&&o.jsxs("p",{className:"text-sm text-gray-600",children:["Submission ID: ",s.submissionId]})]}),o.jsx("div",{className:"border-t pt-4 space-y-3",children:o.jsxs("div",{className:"text-sm text-gray-600",children:[o.jsx("p",{className:"font-medium mb-1",children:"What happened:"}),o.jsxs("ul",{className:"space-y-1 text-xs",children:[o.jsx("li",{children:"• Form submitted and saved to cloud database"}),o.jsx("li",{children:"• Data is securely stored and accessible from any device"}),o.jsx("li",{children:"• Form has been removed from local drafts"})]})]})}),o.jsx(D,{onClick:n,className:"w-full bg-green-600 hover:bg-green-700",children:"Return to Start"})]})]})})},yp=({isOpen:t,onClose:e,currentForm:s,pendingForms:r})=>{const n=gt(),i=()=>{console.log("OfflineSummaryDialog: Closing and navigating to home"),e(),n("/")};return o.jsx(Ts,{open:t,onOpenChange:i,children:o.jsxs(qt,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[o.jsx(Vt,{children:o.jsxs(Gt,{className:"flex items-center gap-2 text-amber-600",children:[o.jsx(he,{className:"w-6 h-6"}),"Form Captured - Offline Mode"]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"text-center space-y-2",children:[o.jsxs("div",{className:"p-4 bg-amber-50 rounded-lg",children:[o.jsx(io,{className:"w-8 h-8 text-amber-600 mx-auto mb-2"}),o.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"Your consent form has been saved locally and will upload when online"})]}),(s==null?void 0:s.patientName)&&o.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:["Latest: ",s.patientName]})]}),o.jsxs("div",{className:"border-t pt-4 space-y-3",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600",children:[o.jsx(Ye,{className:"w-4 h-4"}),o.jsxs("span",{children:["All Pending Offline Submissions (",r.length,")"]})]}),o.jsx("div",{className:"bg-gray-50 rounded-lg p-3 max-h-48 overflow-y-auto",children:r.length>0?o.jsx("ul",{className:"space-y-2",children:r.map((a,l)=>o.jsxs("li",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"font-medium",children:a.patientName||"Unknown Patient"}),o.jsx("span",{className:"text-gray-500 text-xs",children:a.timestamp?new Date(a.timestamp).toLocaleString():"Unknown time"})]},a.id||l))}):o.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No pending submissions"})}),o.jsxs("div",{className:"text-sm text-gray-600",children:[o.jsx("p",{className:"font-medium mb-1",children:"What happens next:"}),o.jsxs("ul",{className:"space-y-1 text-xs",children:[o.jsx("li",{children:"• All forms are safely stored on this device"}),o.jsx("li",{children:"• Will automatically upload when internet connection is restored"}),o.jsx("li",{children:"• You can continue working with new forms"})]})]})]}),o.jsx(D,{onClick:i,className:"w-full",children:"Return to Start"})]})]})})},xp=({showSaveConfirmation:t,saveMessage:e,isOnline:s,showOfflineDialog:r,setShowOfflineDialog:n,showOnlineSuccessDialog:i,setShowOnlineSuccessDialog:a,showOfflineSummaryDialog:l,setShowOfflineSummaryDialog:c,offlineFormData:d,onlineFormData:u,pendingForms:f})=>o.jsxs(o.Fragment,{children:[o.jsx(mp,{show:t,message:e,isOnline:s}),o.jsx(pp,{isOpen:r,onClose:()=>n(!1),formData:d}),o.jsx(gp,{isOpen:i,onClose:()=>a(!1),formData:u}),o.jsx(yp,{isOpen:l,onClose:()=>c(!1),currentForm:d,pendingForms:f})]}),bp=()=>{const t=qm();return o.jsxs(o.Fragment,{children:[o.jsx(fp,{currentRegion:t.currentRegion,regionDetected:t.regionDetected,isResuming:t.isResuming,activeSection:t.activeSection,setActiveSection:t.setActiveSection,formData:t.formData,handleInputChange:t.handleInputChange,handleCheckboxChange:t.handleCheckboxChange,isDirty:t.isDirty,justSaved:t.justSaved,onSave:t.handleSave,onSubmit:t.handleSubmit,onDiscard:t.handleDiscard,onResetJustSaved:t.resetJustSaved,isOnline:t.isOnline,lastSaved:t.lastSaved,formatLastSaved:t.formatLastSaved,dbInitialized:t.dbInitialized,retryCount:t.retryCount,showManualSelector:t.showManualSelector,setRegionManually:t.setRegionManually,isRegionFromDraft:t.isRegionFromDraft,isRegionDetected:t.isRegionDetected,validationErrors:t.validationErrors,showValidationErrors:t.showValidationErrors,submitting:t.submitting,submissionStatus:t.submissionStatus,isFormComplete:t.isFormComplete}),o.jsx(xp,{showSaveConfirmation:t.showSaveConfirmation,saveMessage:t.saveMessage,isOnline:t.isOnline,showOfflineDialog:t.showOfflineDialog,setShowOfflineDialog:t.setShowOfflineDialog,showOnlineSuccessDialog:t.showOnlineSuccessDialog,setShowOnlineSuccessDialog:t.setShowOnlineSuccessDialog,showOfflineSummaryDialog:t.showOfflineSummaryDialog,setShowOfflineSummaryDialog:t.setShowOfflineSummaryDialog,offlineFormData:t.offlineFormData,onlineFormData:t.onlineFormData,pendingForms:t.pendingForms})]})},Fa=()=>o.jsx(bp,{}),Kn=()=>o.jsx(Fa,{}),vp=()=>o.jsx(Fa,{}),wp=()=>{const t=JSON.parse(localStorage.getItem("drafts")||"[]");return o.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[o.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Resume Drafts"}),t.length===0?o.jsx("p",{children:"No drafts available"}):o.jsx("ul",{className:"list-disc pl-5",children:t.map(e=>o.jsx("li",{children:o.jsxs(ns,{to:`/edit/${e.id}`,className:"text-blue-600 underline",children:["Draft ",e.id]})},e.id))})]})},_p=()=>{const{id:t}=ro(),[e,s]=g.useState(null);if(g.useEffect(()=>{const i=JSON.parse(localStorage.getItem("drafts")||"[]").find(a=>a.id===t);s((i==null?void 0:i.data)||null)},[t]),!e)return o.jsx("p",{className:"p-4 text-center",children:"❌ Draft not found"});const r=()=>{const i=JSON.parse(localStorage.getItem("drafts")||"[]").map(a=>a.id===t?{id:t,data:e}:a);localStorage.setItem("drafts",JSON.stringify(i)),alert("✅ Draft saved!")};return o.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[o.jsxs("h2",{className:"text-2xl font-semibold mb-4",children:["Edit Draft ",t]}),o.jsx("textarea",{value:JSON.stringify(e,null,2),onChange:n=>s(JSON.parse(n.target.value)),className:"w-full h-64 p-2 border rounded"}),o.jsx("button",{onClick:r,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded",children:"Save Draft"})]})},jp=()=>{const t=Qa();return g.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),o.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:o.jsxs(ve,{className:"w-full max-w-md",children:[o.jsxs(we,{className:"text-center",children:[o.jsx(_e,{className:"text-2xl",children:"Page Not Found"}),o.jsx(us,{children:"The page you're looking for doesn't exist."})]}),o.jsx(je,{className:"space-y-4",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-muted-foreground mb-4",children:"You might want to check the URL or return to the home page."}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(ns,{to:"/",className:"block",children:o.jsx(D,{className:"w-full",children:"Back to Home"})}),o.jsx(ns,{to:"/consent-form",className:"block",children:o.jsx(D,{variant:"outline",className:"w-full",children:"Start New Consent Form"})}),o.jsx(ns,{to:"/drafts",className:"block",children:o.jsx(D,{variant:"outline",className:"w-full",children:"View Draft Forms"})})]})]})})]})})},Sp=()=>o.jsx(Za,{basename:"/mia-consent-offline-form",children:o.jsxs(el,{children:[o.jsx(qe,{path:"/",element:o.jsx(Nm,{})}),o.jsx(qe,{path:"/consent-form",element:o.jsx(Kn,{})}),o.jsx(qe,{path:"/consent-form/:draftId",element:o.jsx(Kn,{})}),o.jsx(qe,{path:"/form",element:o.jsx(vp,{})}),o.jsx(qe,{path:"/drafts",element:o.jsx(wp,{})}),o.jsx(qe,{path:"/drafts/:id",element:o.jsx(_p,{})}),o.jsx(qe,{path:"*",element:o.jsx(jp,{})})]})});class Np extends xe.Component{constructor(){super(...arguments);St(this,"state",{hasError:!1,error:null,info:null})}static getDerivedStateFromError(s){return console.error("ErrorBoundary: getDerivedStateFromError",s),{hasError:!0,error:s,info:null}}componentDidCatch(s,r){console.error("❌ ErrorBoundary caught an error:",s,r),console.error("Error stack:",s==null?void 0:s.stack),console.error("Component stack:",r==null?void 0:r.componentStack),this.setState({hasError:!0,error:s,info:r})}render(){var s,r,n;return this.state.hasError?o.jsxs("div",{style:{padding:24,fontFamily:"monospace",backgroundColor:"#fff0f0",color:"#990000",minHeight:"100vh",overflow:"auto"},children:[o.jsx("h2",{children:"🚨 Something went wrong."}),o.jsxs("p",{children:[o.jsx("strong",{children:"Message:"})," ",((s=this.state.error)==null?void 0:s.message)||String(this.state.error)]}),o.jsxs("details",{style:{marginTop:16},children:[o.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),o.jsxs("div",{style:{marginTop:8},children:[o.jsx("p",{children:o.jsx("strong",{children:"Stack:"})}),o.jsx("pre",{style:{whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5",padding:8,fontSize:"12px",maxHeight:"200px",overflow:"auto"},children:((r=this.state.error)==null?void 0:r.stack)||"(no stack trace)"}),((n=this.state.info)==null?void 0:n.componentStack)&&o.jsxs(o.Fragment,{children:[o.jsx("p",{children:o.jsx("strong",{children:"Component Stack:"})}),o.jsx("pre",{style:{whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5",padding:8,fontSize:"12px",maxHeight:"200px",overflow:"auto"},children:this.state.info.componentStack})]})]})]}),o.jsxs("div",{style:{marginTop:24},children:[o.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",backgroundColor:"#ef4805",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload Page"}),o.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},style:{padding:"8px 16px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginLeft:"8px"},children:"Clear Storage & Reload"})]})]}):this.props.children}}class Cp extends xe.Component{componentDidMount(){console.log("SafeAppWrapper: App mounted successfully")}componentDidCatch(e,s){console.error("SafeAppWrapper: Caught error in app",e,s)}render(){return o.jsx(Np,{children:o.jsx("div",{id:"app-wrapper",children:this.props.children})})}}const Yn=document.getElementById("root");Yn?(no(Yn).render(o.jsx(Cp,{children:o.jsx(Sp,{})})),console.log("✅ App rendered successfully with error boundary")):console.error("❌ Root container not found");
//# sourceMappingURL=index-ChJbSNIV.js.map
